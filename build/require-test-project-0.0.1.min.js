/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.8 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/**
 * @license
 * Pixi.JS - v1.2.0
 * Copyright (c) 2012, Mat Groves
 * http://goodboydigital.com/
 *
 * Compiled: 2013-06-19
 *
 * Pixi.JS is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */

/* Copyright (c) 2012, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

//     keymaster.js
//     (c) 2011-2012 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.

var requirejs,require,define;!function(global){function isFunction(t){return"[object Function]"===ostring.call(t)}function isArray(t){return"[object Array]"===ostring.call(t)}function each(t,e){if(t){var r;for(r=0;r<t.length&&(!t[r]||!e(t[r],r,t));r+=1);}}function eachReverse(t,e){if(t){var r;for(r=t.length-1;r>-1&&(!t[r]||!e(t[r],r,t));r-=1);}}function hasProp(t,e){return hasOwn.call(t,e)}function getOwn(t,e){return hasProp(t,e)&&t[e]}function eachProp(t,e){var r;for(r in t)if(hasProp(t,r)&&e(t[r],r))break}function mixin(t,e,r,n){return e&&eachProp(e,function(e,i){(r||!hasProp(t,i))&&(n&&"string"!=typeof e?(t[i]||(t[i]={}),mixin(t[i],e,r,n)):t[i]=e)}),t}function bind(t,e){return function(){return e.apply(t,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(t){throw t}function getGlobal(t){if(!t)return t;var e=global;return each(t.split("."),function(t){e=e[t]}),e}function makeError(t,e,r,n){var i=new Error(e+"\nhttp://requirejs.org/docs/errors.html#"+t);return i.requireType=t,i.requireModules=n,r&&(i.originalError=r),i}function newContext(t){function e(t){var e,r;for(e=0;t[e];e+=1)if(r=t[e],"."===r)t.splice(e,1),e-=1;else if(".."===r){if(1===e&&(".."===t[2]||".."===t[0]))break;e>0&&(t.splice(e-1,2),e-=2)}}function r(t,r,n){var i,o,a,s,h,u,c,l,d,f,p,m=r&&r.split("/"),v=m,g=_.map,b=g&&g["*"];if(t&&"."===t.charAt(0)&&(r?(v=getOwn(_.pkgs,r)?m=[r]:m.slice(0,m.length-1),t=v.concat(t.split("/")),e(t),o=getOwn(_.pkgs,i=t[0]),t=t.join("/"),o&&t===i+"/"+o.main&&(t=i)):0===t.indexOf("./")&&(t=t.substring(2))),n&&g&&(m||b)){for(s=t.split("/"),h=s.length;h>0;h-=1){if(c=s.slice(0,h).join("/"),m)for(u=m.length;u>0;u-=1)if(a=getOwn(g,m.slice(0,u).join("/")),a&&(a=getOwn(a,c))){l=a,d=h;break}if(l)break;!f&&b&&getOwn(b,c)&&(f=getOwn(b,c),p=h)}!l&&f&&(l=f,d=p),l&&(s.splice(0,d,l),t=s.join("/"))}return t}function n(t){isBrowser&&each(scripts(),function(e){return e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===y.contextName?(e.parentNode.removeChild(e),!0):void 0})}function i(t){var e=getOwn(_.paths,t);return e&&isArray(e)&&e.length>1?(n(t),e.shift(),y.require.undef(t),y.require([t]),!0):void 0}function o(t){var e,r=t?t.indexOf("!"):-1;return r>-1&&(e=t.substring(0,r),t=t.substring(r+1,t.length)),[e,t]}function a(t,e,n,i){var a,s,h,u,c=null,l=e?e.name:null,d=t,f=!0,p="";return t||(f=!1,t="_@r"+(F+=1)),u=o(t),c=u[0],t=u[1],c&&(c=r(c,l,i),s=getOwn(C,c)),t&&(c?p=s&&s.normalize?s.normalize(t,function(t){return r(t,l,i)}):r(t,l,i):(p=r(t,l,i),u=o(p),c=u[0],p=u[1],n=!0,a=y.nameToUrl(p))),h=!c||s||n?"":"_unnormalized"+(M+=1),{prefix:c,name:p,parentMap:e,unnormalized:!!h,url:a,originalName:d,isDefine:f,id:(c?c+"!"+p:p)+h}}function s(t){var e=t.id,r=getOwn(A,e);return r||(r=A[e]=new y.Module(t)),r}function h(t,e,r){var n=t.id,i=getOwn(A,n);!hasProp(C,n)||i&&!i.defineEmitComplete?(i=s(t),i.error&&"error"===e?r(i.error):i.on(e,r)):"defined"===e&&r(C[n])}function u(t,e){var r=t.requireModules,n=!1;e?e(t):(each(r,function(e){var r=getOwn(A,e);r&&(r.error=t,r.events.error&&(n=!0,r.emit("error",t)))}),n||req.onError(t))}function c(){globalDefQueue.length&&(apsp.apply(E,[E.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function l(t){delete A[t],delete R[t]}function d(t,e,r){var n=t.map.id;t.error?t.emit("error",t.error):(e[n]=!0,each(t.depMaps,function(n,i){var o=n.id,a=getOwn(A,o);!a||t.depMatched[i]||r[o]||(getOwn(e,o)?(t.defineDep(i,C[o]),t.check()):d(a,e,r))}),r[n]=!0)}function f(){var t,e,r,o,a=1e3*_.waitSeconds,s=a&&y.startTime+a<(new Date).getTime(),h=[],c=[],l=!1,p=!0;if(!b){if(b=!0,eachProp(R,function(r){if(t=r.map,e=t.id,r.enabled&&(t.isDefine||c.push(r),!r.error))if(!r.inited&&s)i(e)?(o=!0,l=!0):(h.push(e),n(e));else if(!r.inited&&r.fetched&&t.isDefine&&(l=!0,!t.prefix))return p=!1}),s&&h.length)return r=makeError("timeout","Load timeout for modules: "+h,null,h),r.contextName=y.contextName,u(r);p&&each(c,function(t){d(t,{},{})}),s&&!o||!l||!isBrowser&&!isWebWorker||T||(T=setTimeout(function(){T=0,f()},50)),b=!1}}function p(t){hasProp(C,t[0])||s(a(t[0],null,!0)).init(t[1],t[2])}function m(t,e,r,n){t.detachEvent&&!isOpera?n&&t.detachEvent(n,e):t.removeEventListener(r,e,!1)}function v(t){var e=t.currentTarget||t.srcElement;return m(e,y.onScriptLoad,"load","onreadystatechange"),m(e,y.onScriptError,"error"),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function g(){var t;for(c();E.length;){if(t=E.shift(),null===t[0])return u(makeError("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));p(t)}}var b,x,y,w,T,_={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},A={},R={},S={},E=[],C={},L={},F=1,M=1;return w={require:function(t){return t.require?t.require:t.require=y.makeRequire(t.map)},exports:function(t){return t.usingExports=!0,t.map.isDefine?t.exports?t.exports:t.exports=C[t.map.id]={}:void 0},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){var e,r=getOwn(_.pkgs,t.map.id);return e=r?getOwn(_.config,t.map.id+"/"+r.main):getOwn(_.config,t.map.id),e||{}},exports:C[t.map.id]}}},x=function(t){this.events=getOwn(S,t.id)||{},this.map=t,this.shim=getOwn(_.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},x.prototype={init:function(t,e,r,n){n=n||{},this.inited||(this.factory=e,r?this.on("error",r):this.events.error&&(r=bind(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=r,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,e){this.depMatched[t]||(this.depMatched[t]=!0,this.depCount-=1,this.depExports[t]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,y.startTime=(new Date).getTime();var t=this.map;return this.shim?(y.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return t.prefix?this.callPlugin():this.load()})),void 0):t.prefix?this.callPlugin():this.load()}},load:function(){var t=this.map.url;L[t]||(L[t]=!0,y.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var t,e,r=this.map.id,n=this.depExports,i=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{i=y.execCb(r,o,n,i)}catch(a){t=a}else i=y.execCb(r,o,n,i);if(this.map.isDefine&&(e=this.module,e&&void 0!==e.exports&&e.exports!==this.exports?i=e.exports:void 0===i&&this.usingExports&&(i=this.exports)),t)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",u(this.error=t)}else i=o;this.exports=i,this.map.isDefine&&!this.ignore&&(C[r]=i,req.onResourceLoad&&req.onResourceLoad(y,this.map,this.depMaps)),l(r),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var t=this.map,e=t.id,n=a(t.prefix);this.depMaps.push(n),h(n,"defined",bind(this,function(n){var i,o,c,d=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null,p=y.makeRequire(t.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(d=n.normalize(d,function(t){return r(t,f,!0)})||""),o=a(t.prefix+"!"+d,this.map.parentMap),h(o,"defined",bind(this,function(t){this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),c=getOwn(A,o.id),c&&(this.depMaps.push(o),this.events.error&&c.on("error",bind(this,function(t){this.emit("error",t)})),c.enable()),void 0):(i=bind(this,function(t){this.init([],function(){return t},null,{enabled:!0})}),i.error=bind(this,function(t){this.inited=!0,this.error=t,t.requireModules=[e],eachProp(A,function(t){0===t.map.id.indexOf(e+"_unnormalized")&&l(t.map.id)}),u(t)}),i.fromText=bind(this,function(r,n){var o=t.name,h=a(o),c=useInteractive;n&&(r=n),c&&(useInteractive=!1),s(h),hasProp(_.config,e)&&(_.config[o]=_.config[e]);try{req.exec(r)}catch(l){return u(makeError("fromtexteval","fromText eval for "+e+" failed: "+l,l,[e]))}c&&(useInteractive=!0),this.depMaps.push(h),y.completeLoad(o),p([o],i)}),n.load(t.name,p,i,_),void 0)})),y.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){R[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(t,e){var r,n,i;if("string"==typeof t){if(t=a(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[e]=t,i=getOwn(w,t.id))return this.depExports[e]=i(this),void 0;this.depCount+=1,h(t,"defined",bind(this,function(t){this.defineDep(e,t),this.check()})),this.errback&&h(t,"error",bind(this,this.errback))}r=t.id,n=A[r],hasProp(w,r)||!n||n.enabled||y.enable(t,this)})),eachProp(this.pluginMaps,bind(this,function(t){var e=getOwn(A,t.id);e&&!e.enabled&&y.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,e){var r=this.events[t];r||(r=this.events[t]=[]),r.push(e)},emit:function(t,e){each(this.events[t],function(t){t(e)}),"error"===t&&delete this.events[t]}},y={config:_,contextName:t,registry:A,defined:C,urlFetched:L,defQueue:E,Module:x,makeModuleMap:a,nextTick:req.nextTick,onError:u,configure:function(t){t.baseUrl&&"/"!==t.baseUrl.charAt(t.baseUrl.length-1)&&(t.baseUrl+="/");var e=_.pkgs,r=_.shim,n={paths:!0,config:!0,map:!0};eachProp(t,function(t,e){n[e]?"map"===e?(_.map||(_.map={}),mixin(_[e],t,!0,!0)):mixin(_[e],t,!0):_[e]=t}),t.shim&&(eachProp(t.shim,function(t,e){isArray(t)&&(t={deps:t}),!t.exports&&!t.init||t.exportsFn||(t.exportsFn=y.makeShimExports(t)),r[e]=t}),_.shim=r),t.packages&&(each(t.packages,function(t){var r;t="string"==typeof t?{name:t}:t,r=t.location,e[t.name]={name:t.name,location:r||t.name,main:(t.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),_.pkgs=e),eachProp(A,function(t,e){t.inited||t.map.unnormalized||(t.map=a(e))}),(t.deps||t.callback)&&y.require(t.deps||[],t.callback)},makeShimExports:function(t){function e(){var e;return t.init&&(e=t.init.apply(global,arguments)),e||t.exports&&getGlobal(t.exports)}return e},makeRequire:function(e,n){function i(r,o,h){var c,l,d;return n.enableBuildCallback&&o&&isFunction(o)&&(o.__requireJsBuild=!0),"string"==typeof r?isFunction(o)?u(makeError("requireargs","Invalid require call"),h):e&&hasProp(w,r)?w[r](A[e.id]):req.get?req.get(y,r,e,i):(l=a(r,e,!1,!0),c=l.id,hasProp(C,c)?C[c]:u(makeError("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+t+(e?"":". Use require([])")))):(g(),y.nextTick(function(){g(),d=s(a(null,e)),d.skipMap=n.skipMap,d.init(r,o,h,{enabled:!0}),f()}),i)}return n=n||{},mixin(i,{isBrowser:isBrowser,toUrl:function(t){var n,i=t.lastIndexOf("."),o=t.split("/")[0],a="."===o||".."===o;return-1!==i&&(!a||i>1)&&(n=t.substring(i,t.length),t=t.substring(0,i)),y.nameToUrl(r(t,e&&e.id,!0),n,!0)},defined:function(t){return hasProp(C,a(t,e,!1,!0).id)},specified:function(t){return t=a(t,e,!1,!0).id,hasProp(C,t)||hasProp(A,t)}}),e||(i.undef=function(t){c();var r=a(t,e,!0),n=getOwn(A,t);delete C[t],delete L[r.url],delete S[t],n&&(n.events.defined&&(S[t]=n.events),l(t))}),i},enable:function(t){var e=getOwn(A,t.id);e&&s(t).enable()},completeLoad:function(t){var e,r,n,o=getOwn(_.shim,t)||{},a=o.exports;for(c();E.length;){if(r=E.shift(),null===r[0]){if(r[0]=t,e)break;e=!0}else r[0]===t&&(e=!0);p(r)}if(n=getOwn(A,t),!e&&!hasProp(C,t)&&n&&!n.inited){if(!(!_.enforceDefine||a&&getGlobal(a)))return i(t)?void 0:u(makeError("nodefine","No define call for "+t,null,[t]));p([t,o.deps||[],o.exportsFn])}f()},nameToUrl:function(t,e,r){var n,i,o,a,s,h,u,c,l;if(req.jsExtRegExp.test(t))c=t+(e||"");else{for(n=_.paths,i=_.pkgs,s=t.split("/"),h=s.length;h>0;h-=1){if(u=s.slice(0,h).join("/"),o=getOwn(i,u),l=getOwn(n,u)){isArray(l)&&(l=l[0]),s.splice(0,h,l);break}if(o){a=t===o.name?o.location+"/"+o.main:o.location,s.splice(0,h,a);break}}c=s.join("/"),c+=e||(/\?/.test(c)||r?"":".js"),c=("/"===c.charAt(0)||c.match(/^[\w\+\.\-]+:/)?"":_.baseUrl)+c}return _.urlArgs?c+((-1===c.indexOf("?")?"?":"&")+_.urlArgs):c},load:function(t,e){req.load(y,t,e)},execCb:function(t,e,r,n){return e.apply(n,r)},onScriptLoad:function(t){if("load"===t.type||readyRegExp.test((t.currentTarget||t.srcElement).readyState)){interactiveScript=null;var e=v(t);y.completeLoad(e.id)}},onScriptError:function(t){var e=v(t);return i(e.id)?void 0:u(makeError("scripterror","Script error for: "+e.id,t,[e.id]))}},y.require=y.makeRequire(),y}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(t){return"interactive"===t.readyState?interactiveScript=t:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.8",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||!navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(t,e,r,n){var i,o,a=defContextName;return isArray(t)||"string"==typeof t||(o=t,isArray(e)?(t=e,e=r,r=n):t=[]),o&&o.context&&(a=o.context),i=getOwn(contexts,a),i||(i=contexts[a]=req.s.newContext(a)),o&&i.configure(o),i.require(t,e,r)},req.config=function(t){return req(t)},req.nextTick="undefined"!=typeof setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(t){req[t]=function(){var e=contexts[defContextName];return e.require[t].apply(e,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(t){var e=t.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return e.type=t.scriptType||"text/javascript",e.charset="utf-8",e.async=!0,e},req.load=function(t,e,r){var n,i=t&&t.config||{};if(isBrowser)return n=req.createNode(i,e,r),n.setAttribute("data-requirecontext",t.contextName),n.setAttribute("data-requiremodule",e),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",t.onScriptLoad,!1),n.addEventListener("error",t.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",t.onScriptLoad)),n.src=r,currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{importScripts(r),t.completeLoad(e)}catch(o){t.onError(makeError("importscripts","importScripts failed for "+e+" at "+r,o,[e]))}},isBrowser&&eachReverse(scripts(),function(t){return head||(head=t.parentNode),dataMain=t.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(t,e,r){var n,i;"string"!=typeof t&&(r=e,e=t,t=null),isArray(e)||(r=e,e=null),!e&&isFunction(r)&&(e=[],r.length&&(r.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(t,r){e.push(r)}),e=(1===r.length?["require"]:["require","exports","module"]).concat(e))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript(),n&&(t||(t=n.getAttribute("data-requiremodule")),i=contexts[n.getAttribute("data-requirecontext")])),(i?i.defQueue:globalDefQueue).push([t,e,r])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),!function(){function t(t){return[(255&t>>16)/255,(255&t>>8)/255,(255&t)/255]}function e(){return i.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,i.Matrix}var n=this,i=i||{};i.Point=function(t,e){this.x=t||0,this.y=e||0},i.Point.prototype.clone=function(){return new i.Point(this.x,this.y)},i.Point.constructor=i.Point,i.Rectangle=function(t,e,r,n){this.x=t||0,this.y=e||0,this.width=r||0,this.height=n||0},i.Rectangle.prototype.clone=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Rectangle.constructor=i.Rectangle,i.Polygon=function(t){this.points=t},i.Polygon.clone=function(){for(var t=[],e=0;e<this.points.length;e++)t.push(this.points[e].clone());return new i.Polygon(t)},i.Polygon.constructor=i.Polygon,i.DisplayObject=function(){this.position=new i.Point,this.scale=new i.Point(1,1),this.pivot=new i.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.worldVisible=!1,this.parent=null,this.stage=null,this.hitArea=null,this.worldAlpha=1,this.color=[],this.worldTransform=i.mat3.create(),this.localTransform=i.mat3.create(),this.dynamic=!0,this._sr=0,this._cr=1,this.childIndex=0,this.renderable=!1,this.interactive=!1,this.buttonMode=!1},i.DisplayObject.constructor=i.DisplayObject,i.DisplayObject.prototype.setInteractive=function(t){this.interactive=t,this.stage&&(this.stage.dirty=!0)},i.DisplayObject.prototype.updateTransform=function(){this.rotation!=this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var t=this.localTransform,e=this.parent.worldTransform,r=this.worldTransform;t[0]=this._cr*this.scale.x,t[1]=-this._sr*this.scale.y,t[3]=this._sr*this.scale.x,t[4]=this._cr*this.scale.y;var n=this.pivot.x,i=this.pivot.y;t[2]=this.position.x-t[0]*n-i*t[1],t[5]=this.position.y-t[4]*i-n*t[3];var o=t[0],a=t[1],s=t[2],h=t[3],u=t[4],c=t[5],l=e[0],d=e[1],f=e[2],p=e[3],m=e[4],v=e[5];r[0]=l*o+d*h,r[1]=l*a+d*u,r[2]=l*s+d*c+f,r[3]=p*o+m*h,r[4]=p*a+m*u,r[5]=p*s+m*c+v,this.worldAlpha=this.alpha*this.parent.worldAlpha},i.DisplayObjectContainer=function(){i.DisplayObject.call(this),this.children=[],this.renderable=!1},i.DisplayObjectContainer.constructor=i.DisplayObjectContainer,i.DisplayObjectContainer.prototype=Object.create(i.DisplayObject.prototype),i.DisplayObjectContainer.prototype.addChild=function(t){void 0!=t.parent&&t.parent.removeChild(t),t.parent=this,t.childIndex=this.children.length,this.children.push(t),this.stage&&this.stage.__addChild(t),this.__renderGroup&&(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),this.__renderGroup.addDisplayObjectAndChildren(t))},i.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(!(e>=0&&e<=this.children.length))throw new Error(t+" The index "+e+" supplied is out of bounds "+this.children.length);void 0!=t.parent&&t.parent.removeChild(t),e==this.children.length?this.children.push(t):this.children.splice(e,0,t),t.parent=this,t.childIndex=e;for(var r=this.children.length,n=e;r>n;n++)this.children[n].childIndex=n;this.stage&&this.stage.__addChild(t),this.__renderGroup&&(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),this.__renderGroup.addDisplayObjectAndChildren(t))},i.DisplayObjectContainer.prototype.swapChildren=function(t,e){var r=this.children.indexOf(t),n=this.children.indexOf(e);if(-1===r||-1===n)throw new Error(t+" Both the supplied DisplayObjects must be a child of the caller "+this);this.stage&&(this.stage.__removeChild(t),this.stage.__removeChild(e),this.stage.__addChild(t),this.stage.__addChild(e)),t.childIndex=n,e.childIndex=r,this.children[r]=e,this.children[n]=t},i.DisplayObjectContainer.prototype.getChildAt=function(t){if(t>=0&&t<this.children.length)return this.children[t];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},i.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error(t+" The supplied DisplayObject must be a child of the caller "+this);this.stage&&this.stage.__removeChild(t),t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),t.parent=void 0,this.children.splice(e,1);for(var r=e,n=this.children.length;n>r;r++)this.children[r].childIndex-=1},i.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){i.DisplayObject.prototype.updateTransform.call(this);for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform()}},i.blendModes={},i.blendModes.NORMAL=0,i.blendModes.SCREEN=1,i.Sprite=function(t){i.DisplayObjectContainer.call(this),this.anchor=new i.Point,this.texture=t,this.blendMode=i.blendModes.NORMAL,this._width=0,this._height=0,t.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Sprite.constructor=i.Sprite,i.Sprite.prototype=Object.create(i.DisplayObjectContainer.prototype),Object.defineProperty(i.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(i.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),i.Sprite.prototype.setTexture=function(t){this.texture.baseTexture!=t.baseTexture&&(this.textureChange=!0),this.texture=t,this.updateFrame=!0},i.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},i.Sprite.fromFrame=function(t){var e=i.TextureCache[t];if(!e)throw new Error("The frameId '"+t+"' does not exist in the texture cache"+this);return new i.Sprite(e)},i.Sprite.fromImage=function(t){var e=i.Texture.fromImage(t);return new i.Sprite(e)},i.MovieClip=function(t){i.Sprite.call(this,t[0]),this.textures=t,this.currentFrame=0,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.playing},i.MovieClip.constructor=i.MovieClip,i.MovieClip.prototype=Object.create(i.Sprite.prototype),i.MovieClip.prototype.stop=function(){this.playing=!1},i.MovieClip.prototype.play=function(){this.playing=!0},i.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1,this.currentFrame=t;var e=0|this.currentFrame+.5;this.setTexture(this.textures[e%this.textures.length])},i.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t,this.playing=!0},i.MovieClip.prototype.updateTransform=function(){if(i.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var t=0|this.currentFrame+.5;this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},i.Text=function(t,e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),i.Sprite.call(this,i.Texture.fromCanvas(this.canvas)),this.setText(t),this.setStyle(e),this.updateText(),this.dirty=!1},i.Text.constructor=i.Text,i.Text.prototype=Object.create(i.Sprite.prototype),i.Text.prototype.setStyle=function(t){t=t||{},t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,this.style=t,this.dirty=!0},i.Sprite.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},i.Text.prototype.updateText=function(){this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),r=[],n=0,o=0;o<e.length;o++){var a=this.context.measureText(e[o]).width;r[o]=a,n=Math.max(n,a)}this.canvas.width=n+this.style.strokeThickness;var s=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=s*e.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",o=0;o<e.length;o++){var h=new i.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+o*s);"right"==this.style.align?h.x+=n-r[o]:"center"==this.style.align&&(h.x+=(n-r[o])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[o],h.x,h.y),this.style.fill&&this.context.fillText(e[o],h.x,h.y)}this.updateTexture()},i.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,i.texturesToUpdate.push(this.texture.baseTexture)},i.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),i.Sprite.prototype.updateTransform.call(this)},i.Text.prototype.determineFontHeight=function(t){var e=i.Text.heightCache[t];if(!e){var r=document.getElementsByTagName("body")[0],n=document.createElement("div"),o=document.createTextNode("M");n.appendChild(o),n.setAttribute("style",t+";position:absolute;top:0;left:0"),r.appendChild(n),e=n.offsetHeight,i.Text.heightCache[t]=e,r.removeChild(n)}return e},i.Text.prototype.wordWrap=function(t){for(var e=function(t,e,r,n,i){var o=Math.floor((n-r)/2)+r;return o==r?1:t.measureText(e.substring(0,o)).width<=i?t.measureText(e.substring(0,o+1)).width>i?o:arguments.callee(t,e,o,n,i):arguments.callee(t,e,r,o,i)},r=function(t,r,n){if(t.measureText(r).width<=n||r.length<1)return r;var i=e(t,r,0,r.length,n);return r.substring(0,i)+"\n"+arguments.callee(t,r.substring(i),n)},n="",i=t.split("\n"),o=0;o<i.length;o++)n+=r(this.context,i[o],this.style.wordWrapWidth)+"\n";return n},i.Text.prototype.destroy=function(t){t&&this.texture.destroy()},i.Text.heightCache={},i.BitmapText=function(t,e){i.DisplayObjectContainer.call(this),this.setText(t),this.setStyle(e),this.updateText(),this.dirty=!1},i.BitmapText.constructor=i.BitmapText,i.BitmapText.prototype=Object.create(i.DisplayObjectContainer.prototype),i.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},i.BitmapText.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",this.style=t;var e=t.font.split(" ");this.fontName=e[e.length-1],this.fontSize=e.length>=2?parseInt(e[e.length-2],10):i.BitmapText.fonts[this.fontName].size,this.dirty=!0},i.BitmapText.prototype.updateText=function(){for(var t=i.BitmapText.fonts[this.fontName],e=new i.Point,r=null,n=[],o=0,a=[],s=0,h=this.fontSize/t.size,u=0;u<this.text.length;u++){var c=this.text.charCodeAt(u);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(u)))a.push(e.x),o=Math.max(o,e.x),s++,e.x=0,e.y+=t.lineHeight,r=null;else{var l=t.chars[c];l&&(r&&l[r]&&(e.x+=l.kerning[r]),n.push({texture:l.texture,line:s,charCode:c,position:new i.Point(e.x+l.xOffset,e.y+l.yOffset)}),e.x+=l.xAdvance,r=c)}}a.push(e.x),o=Math.max(o,e.x);var d=[];for(u=0;s>=u;u++){var f=0;"right"==this.style.align?f=o-a[u]:"center"==this.style.align&&(f=(o-a[u])/2),d.push(f)}for(u=0;u<n.length;u++){var p=new i.Sprite(n[u].texture);p.position.x=(n[u].position.x+d[n[u].line])*h,p.position.y=n[u].position.y*h,p.scale.x=p.scale.y=h,this.addChild(p)}this.width=e.x*h,this.height=(e.y+t.lineHeight)*h},i.BitmapText.prototype.updateTransform=function(){if(this.dirty){for(;this.children.length>0;)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.BitmapText.fonts={},i.InteractionManager=function(t){this.stage=t,this.tempPoint=new i.Point,this.mouseoverEnabled=!0,this.mouse=new i.InteractionData,this.touchs={},this.pool=[],this.interactiveItems=[],this.last=0},i.InteractionManager.constructor=i.InteractionManager,i.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var r=t.children,n=r.length,i=n-1;i>=0;i--){var o=r[i];o.visible&&(o.interactive?(e.interactiveChildren=!0,this.interactiveItems.push(o),o.children.length>0&&this.collectInteractiveSprite(o,o)):(o.__iParent=null,o.children.length>0&&this.collectInteractiveSprite(o,e)))}},i.InteractionManager.prototype.setTarget=function(t){window.navigator.msPointerEnabled&&(t.view.style["-ms-content-zooming"]="none",t.view.style["-ms-touch-action"]="none"),this.target=t,t.view.addEventListener("mousemove",this.onMouseMove.bind(this),!0),t.view.addEventListener("mousedown",this.onMouseDown.bind(this),!0),document.body.addEventListener("mouseup",this.onMouseUp.bind(this),!0),t.view.addEventListener("mouseout",this.onMouseUp.bind(this),!0),t.view.addEventListener("touchstart",this.onTouchStart.bind(this),!0),t.view.addEventListener("touchend",this.onTouchEnd.bind(this),!0),t.view.addEventListener("touchmove",this.onTouchMove.bind(this),!0)},i.InteractionManager.prototype.update=function(){if(this.target){var t=Date.now(),e=t-this.last;if(e=30*e/1e3,!(1>e)){if(this.last=t,this.dirty){this.dirty=!1,this.interactiveItems.length;for(var r=0;r<this.interactiveItems.length;r++)this.interactiveItems[r].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var n=this.interactiveItems.length;this.target.view.style.cursor="default";for(var r=0;n>r;r++){var i=this.interactiveItems[r];i.visible&&(i.mouseover||i.mouseout||i.buttonMode)&&(i.__hit=this.hitTest(i,this.mouse),i.__hit?(i.buttonMode&&(this.target.view.style.cursor="pointer"),i.__isOver||(i.mouseover&&i.mouseover(this.mouse),i.__isOver=!0)):i.__isOver&&(i.mouseout&&i.mouseout(this.mouse),i.__isOver=!1))}}}},i.InteractionManager.prototype.onMouseMove=function(t){var e=this.target.view.getBoundingClientRect();this.mouse.global.x=(t.clientX-e.left)*(this.target.width/e.width),this.mouse.global.y=(t.clientY-e.top)*(this.target.height/e.height);var r=this.interactiveItems.length;this.mouse.global;for(var n=0;r>n;n++){var i=this.interactiveItems[n];i.mousemove&&i.mousemove(this.mouse)}},i.InteractionManager.prototype.onMouseDown=function(t){t.preventDefault();var e=this.interactiveItems.length;this.mouse.global,this.stage;for(var r=0;e>r;r++){var n=this.interactiveItems[r];if((n.mousedown||n.click)&&(n.__mouseIsDown=!0,n.__hit=this.hitTest(n,this.mouse),n.__hit&&(n.mousedown&&n.mousedown(this.mouse),n.__isDown=!0,!n.interactiveChildren)))break}},i.InteractionManager.prototype.onMouseUp=function(){this.mouse.global;for(var t=this.interactiveItems.length,e=!1,r=0;t>r;r++){var n=this.interactiveItems[r];(n.mouseup||n.mouseupoutside||n.click)&&(n.__hit=this.hitTest(n,this.mouse),n.__hit&&!e?(n.mouseup&&n.mouseup(this.mouse),n.__isDown&&n.click&&n.click(this.mouse),n.interactiveChildren||(e=!0)):n.__isDown&&n.mouseupoutside&&n.mouseupoutside(this.mouse),n.__isDown=!1)}},i.InteractionManager.prototype.hitTest=function(t,e){var r=e.global;if(!t.visible)return!1;var n=t instanceof i.Sprite,o=t.worldTransform,a=o[0],s=o[1],h=o[2],u=o[3],c=o[4],l=o[5],d=1/(a*c+s*-u),f=c*d*r.x+-s*d*r.y+(l*s-h*c)*d,p=a*d*r.y+-u*d*r.x+(-l*a+h*u)*d;if(t.hitArea){var m=t.hitArea;if(t.hitArea instanceof i.Polygon){for(var v=!1,g=0,b=t.hitArea.points.length-1;g<t.hitArea.points.length;b=g++){var x=t.hitArea.points[g].x,y=t.hitArea.points[g].y,w=t.hitArea.points[b].x,T=t.hitArea.points[b].y,_=y>p!=T>p&&(w-x)*(p-y)/(T-y)+x>f;
_&&(v=!v)}if(v)return n&&(e.target=t),!0}else{var A=m.x;if(f>A&&f<A+m.width){var R=m.y;if(p>R&&p<R+m.height)return n&&(e.target=t),!0}}}else if(n){var R,S=t.texture.frame.width,E=t.texture.frame.height,A=-S*t.anchor.x;if(f>A&&A+S>f&&(R=-E*t.anchor.y,p>R&&R+E>p))return e.target=t,!0}for(var C=t.children.length,g=0;C>g;g++){var L=t.children[g],F=this.hitTest(L,e);if(F)return!0}return!1},i.InteractionManager.prototype.onTouchMove=function(t){for(var e=this.target.view.getBoundingClientRect(),r=t.changedTouches,n=0;n<r.length;n++){var i=r[n],o=this.touchs[i.identifier];o.global.x=(i.clientX-e.left)*(this.target.width/e.width),o.global.y=(i.clientY-e.top)*(this.target.height/e.height)}for(var a=this.interactiveItems.length,n=0;a>n;n++){var s=this.interactiveItems[n];s.touchmove&&s.touchmove(o)}},i.InteractionManager.prototype.onTouchStart=function(t){t.preventDefault();for(var e=this.target.view.getBoundingClientRect(),r=t.changedTouches,n=0;n<r.length;n++){var o=r[n],a=this.pool.pop();a||(a=new i.InteractionData),this.touchs[o.identifier]=a,a.global.x=(o.clientX-e.left)*(this.target.width/e.width),a.global.y=(o.clientY-e.top)*(this.target.height/e.height);for(var s=this.interactiveItems.length,h=0;s>h;h++){var u=this.interactiveItems[h];if((u.touchstart||u.tap)&&(u.__hit=this.hitTest(u,a),u.__hit&&(u.touchstart&&u.touchstart(a),u.__isDown=!0,u.__touchData=a,!u.interactiveChildren)))break}}},i.InteractionManager.prototype.onTouchEnd=function(t){for(var e=this.target.view.getBoundingClientRect(),r=t.changedTouches,n=0;n<r.length;n++){var i=r[n],o=this.touchs[i.identifier],a=!1;o.global.x=(i.clientX-e.left)*(this.target.width/e.width),o.global.y=(i.clientY-e.top)*(this.target.height/e.height);for(var s=this.interactiveItems.length,h=0;s>h;h++){var u=this.interactiveItems[h],c=u.__touchData;u.__hit=this.hitTest(u,o),c==o&&((u.touchend||u.tap)&&(u.__hit&&!a?(u.touchend&&u.touchend(o),u.__isDown&&u.tap&&u.tap(o),u.interactiveChildren||(a=!0)):u.__isDown&&u.touchendoutside&&u.touchendoutside(o),u.__isDown=!1),u.__touchData=null)}this.pool.push(o),this.touchs[i.identifier]=null}},i.InteractionData=function(){this.global=new i.Point,this.local=new i.Point,this.target},i.InteractionData.prototype.getLocalPosition=function(t){var e=t.worldTransform,r=this.global,n=e[0],o=e[1],a=e[2],s=e[3],h=e[4],u=e[5],c=1/(n*h+o*-s);return new i.Point(h*c*r.x+-o*c*r.y+(u*o-a*h)*c,n*c*r.y+-s*c*r.x+(-u*n+a*s)*c)},i.InteractionData.constructor=i.InteractionData,i.Stage=function(t,e){i.DisplayObjectContainer.call(this),this.worldTransform=i.mat3.create(),this.__childrenAdded=[],this.__childrenRemoved=[],this.childIndex=0,this.stage=this,this.stage.hitArea=new i.Rectangle(0,0,1e5,1e5),this.interactive=!!e,this.interactionManager=new i.InteractionManager(this),this.setBackgroundColor(t),this.worldVisible=!0,this.stage.dirty=!0},i.Stage.constructor=i.Stage,i.Stage.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},i.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t(this.backgroundColor);var r=this.backgroundColor.toString(16);r="000000".substr(0,6-r.length)+r,this.backgroundColorString="#"+r},i.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},i.Stage.prototype.__addChild=function(t){if(t.interactive&&(this.dirty=!0),t.stage=this,t.children)for(var e=0;e<t.children.length;e++)this.__addChild(t.children[e])},i.Stage.prototype.__removeChild=function(t){if(t.interactive&&(this.dirty=!0),t.stage=void 0,t.children)for(var e=0,r=t.children.length;r>e;e++)this.__removeChild(t.children[e])};for(var o=0,s=["ms","moz","webkit","o"],h=0;h<s.length&&!window.requestAnimationFrame;++h)window.requestAnimationFrame=window[s[h]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[s[h]+"CancelAnimationFrame"]||window[s[h]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var e=(new Date).getTime(),r=Math.max(0,16-(e-o)),n=window.setTimeout(function(){t(e+r)},r);return o=e+r,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.requestAnimFrame=window.requestAnimationFrame,"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var t=Array.prototype.slice;return function(e){function r(){var o=i.concat(t.call(arguments));n.apply(this instanceof r?this:e,o)}var n=this,i=t.call(arguments,1);if("function"!=typeof n)throw new TypeError;return r.prototype=function o(t){return t&&(o.prototype=t),this instanceof o?void 0:new o}(n.prototype),r}}());var u=i.AjaxRequest=function(){var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:!1;for(var e=0;e<t.length;e++)try{return new ActiveXObject(t[e])}catch(r){}};i.EventTarget=function(){var t={};this.addEventListener=this.on=function(e,r){void 0===t[e]&&(t[e]=[]),-1===t[e].indexOf(r)&&t[e].push(r)},this.dispatchEvent=this.emit=function(e){for(var r in t[e.type])t[e.type][r](e)},this.removeEventListener=this.off=function(e,r){var n=t[e].indexOf(r);-1!==n&&t[e].splice(n,1)}},e(),i.mat3={},i.mat3.create=function(){var t=new i.Matrix(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.mat4={},i.mat4.create=function(){var t=new i.Matrix(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.mat3.multiply=function(t,e,r){r||(r=t);var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=e[0],f=e[1],p=e[2],m=e[3],v=e[4],g=e[5],b=e[6],x=e[7],y=e[8];return r[0]=d*n+f*a+p*u,r[1]=d*i+f*s+p*c,r[2]=d*o+f*h+p*l,r[3]=m*n+v*a+g*u,r[4]=m*i+v*s+g*c,r[5]=m*o+v*h+g*l,r[6]=b*n+x*a+y*u,r[7]=b*i+x*s+y*c,r[8]=b*o+x*h+y*l,r},i.mat3.toMat4=function(t,e){return e||(e=i.mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},i.mat4.create=function(){var t=new i.Matrix(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.mat4.transpose=function(t,e){if(!e||t===e){var r=t[1],n=t[2],i=t[3],o=t[6],a=t[7],s=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=r,t[6]=t[9],t[7]=t[13],t[8]=n,t[9]=o,t[11]=t[14],t[12]=i,t[13]=a,t[14]=s,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},i.mat4.multiply=function(t,e,r){r||(r=t);var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],p=t[11],m=t[12],v=t[13],g=t[14],b=t[15],x=e[0],y=e[1],w=e[2],T=e[3];return r[0]=x*n+y*s+w*l+T*m,r[1]=x*i+y*h+w*d+T*v,r[2]=x*o+y*u+w*f+T*g,r[3]=x*a+y*c+w*p+T*b,x=e[4],y=e[5],w=e[6],T=e[7],r[4]=x*n+y*s+w*l+T*m,r[5]=x*i+y*h+w*d+T*v,r[6]=x*o+y*u+w*f+T*g,r[7]=x*a+y*c+w*p+T*b,x=e[8],y=e[9],w=e[10],T=e[11],r[8]=x*n+y*s+w*l+T*m,r[9]=x*i+y*h+w*d+T*v,r[10]=x*o+y*u+w*f+T*g,r[11]=x*a+y*c+w*p+T*b,x=e[12],y=e[13],w=e[14],T=e[15],r[12]=x*n+y*s+w*l+T*m,r[13]=x*i+y*h+w*d+T*v,r[14]=x*o+y*u+w*f+T*g,r[15]=x*a+y*c+w*p+T*b,r},i.autoDetectRenderer=function(t,e,r,n){t||(t=800),e||(e=600);var o=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(t){return!1}}();return o?new i.WebGLRenderer(t,e,r,n):new i.CanvasRenderer(t,e,r,n)},i.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],i.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat4 uMVMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = uMVMatrix * vec4(aVertexPosition, 1.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.CompileVertexShader=function(t,e){return i._CompileShader(t,e,t.VERTEX_SHADER)},i.CompileFragmentShader=function(t,e){return i._CompileShader(t,e,t.FRAGMENT_SHADER)},i._CompileShader=function(t,e,r){var n=e.join("\n"),i=t.createShader(r);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(alert(t.getShaderInfoLog(i)),null)},i._defaultFrame=new i.Rectangle(0,0,1,1),i.gl,i.WebGLRenderer=function(t,e,r,n){this.transparent=!!n,this.width=t||800,this.height=e||600,this.view=r||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var o=this;this.view.addEventListener("webglcontextlost",function(t){o.handleContextLost(t)},!1),this.view.addEventListener("webglcontextrestored",function(t){o.handleContextRestored(t)},!1),this.batchs=[];try{i.gl=this.gl=this.view.getContext("experimental-webgl",{alpha:this.transparent,antialias:!1,premultipliedAlpha:!1})}catch(a){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}this.initShaders();var s=this.gl;i.WebGLRenderer.gl=s,this.batch=new i.WebGLBatch(s),s.disable(s.DEPTH_TEST),s.disable(s.CULL_FACE),s.enable(s.BLEND),s.colorMask(!0,!0,!0,this.transparent),this.projectionMatrix=i.mat4.create(),this.resize(this.width,this.height),this.contextLost=!1,this.stageRenderGroup=new i.WebGLRenderGroup(this.gl)},i.WebGLRenderer.constructor=i.WebGLRenderer,i.WebGLRenderer.getBatch=function(){return 0==i._batchs.length?new i.WebGLBatch(i.WebGLRenderer.gl):i._batchs.pop()},i.WebGLRenderer.returnBatch=function(t){t.clean(),i._batchs.push(t)},i.WebGLRenderer.prototype.initShaders=function(){var t=this.gl,e=i.CompileFragmentShader(t,i.shaderFragmentSrc),r=i.CompileVertexShader(t,i.shaderVertexSrc);i.shaderProgram=t.createProgram();var n=i.shaderProgram;t.attachShader(n,r),t.attachShader(n,e),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||alert("Could not initialise shaders"),t.useProgram(n),n.vertexPositionAttribute=t.getAttribLocation(n,"aVertexPosition"),t.enableVertexAttribArray(n.vertexPositionAttribute),n.textureCoordAttribute=t.getAttribLocation(n,"aTextureCoord"),t.enableVertexAttribArray(n.textureCoordAttribute),n.colorAttribute=t.getAttribLocation(n,"aColor"),t.enableVertexAttribArray(n.colorAttribute),n.mvMatrixUniform=t.getUniformLocation(n,"uMVMatrix"),n.samplerUniform=t.getUniformLocation(n,"uSampler")},i.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(this.__stage=t,this.stageRenderGroup.setRenderable(t)),i.WebGLRenderer.updateTextures(),t.updateTransform();var e=this.gl;if(e.colorMask(!0,!0,!0,this.transparent),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],!this.transparent),e.clear(e.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=t.backgroundColorSplit,this.stageRenderGroup.render(this.projectionMatrix),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0){for(var r=0;r<i.Texture.frameUpdates.length;r++)i.Texture.frameUpdates[r].updateFrame=!1;i.Texture.frameUpdates=[]}}},i.WebGLRenderer.updateTextures=function(){for(var t=0;t<i.texturesToUpdate.length;t++)this.updateTexture(i.texturesToUpdate[t]);for(var t=0;t<i.texturesToDestroy.length;t++)this.destroyTexture(i.texturesToDestroy[t]);i.texturesToUpdate=[],i.texturesToDestroy=[]},i.WebGLRenderer.updateTexture=function(t){var e=i.gl;t._glTexture||(t._glTexture=e.createTexture()),t.hasLoaded&&(e.bindTexture(e.TEXTURE_2D,t._glTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),e.bindTexture(e.TEXTURE_2D,null))},i.WebGLRenderer.prototype.destroyTexture=function(t){var e=this.gl;t._glTexture&&(t._glTexture=e.createTexture(),e.deleteTexture(e.TEXTURE_2D,t._glTexture))},i.WebGLRenderer.prototype.resize=function(t,e){this.width=t,this.height=e,this.view.width=t,this.view.height=e,this.gl.viewport(0,0,this.width,this.height);var r=this.projectionMatrix;r[0]=2/this.width,r[5]=-2/this.height,r[12]=-1,r[13]=1},i.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},i.WebGLRenderer.prototype.handleContextRestored=function(){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var t in i.TextureCache){var e=i.TextureCache[t].baseTexture;e._glTexture=null,i.WebGLRenderer.updateTexture(e)}for(var r=0;r<this.batchs.length;r++)this.batchs[r].restoreLostContext(this.gl),this.batchs[r].dirty=!0;i._restoreBatchs(this.gl),this.contextLost=!1},i._batchs=[],i._getBatch=function(t){return 0==i._batchs.length?new i.WebGLBatch(t):i._batchs.pop()},i._returnBatch=function(t){t.clean(),i._batchs.push(t)},i._restoreBatchs=function(t){for(var e=0;e<i._batchs.length;e++)i._batchs[e].restoreLostContext(t)},i.WebGLBatch=function(t){this.gl=t,this.size=0,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.blendMode=i.blendModes.NORMAL,this.dynamicSize=1},i.WebGLBatch.constructor=i.WebGLBatch,i.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},i.WebGLBatch.prototype.restoreLostContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer()},i.WebGLBatch.prototype.init=function(t){t.batch=this,this.dirty=!0,this.blendMode=t.blendMode,this.texture=t.texture.baseTexture,this.head=t,this.tail=t,this.size=1,this.growBatch()},i.WebGLBatch.prototype.insertBefore=function(t,e){this.size++,t.batch=this,this.dirty=!0;var r=e.__prev;e.__prev=t,t.__next=e,r?(t.__prev=r,r.__next=t):this.head=t},i.WebGLBatch.prototype.insertAfter=function(t,e){this.size++,t.batch=this,this.dirty=!0;var r=e.__next;e.__next=t,t.__prev=e,r?(t.__next=r,r.__prev=t):this.tail=t},i.WebGLBatch.prototype.remove=function(t){return this.size--,0==this.size?(t.batch=null,t.__prev=null,t.__next=null,void 0):(t.__prev?t.__prev.__next=t.__next:(this.head=t.__next,this.head.__prev=null),t.__next?t.__next.__prev=t.__prev:(this.tail=t.__prev,this.tail.__next=null),t.batch=null,t.__next=null,t.__prev=null,this.dirty=!0,void 0)},i.WebGLBatch.prototype.split=function(t){this.dirty=!0;var e=new i.WebGLBatch(this.gl);e.init(t),e.texture=this.texture,e.tail=this.tail,this.tail=t.__prev,this.tail.__next=null,t.__prev=null;for(var r=0;t;)r++,t.batch=e,t=t.__next;return e.size=r,this.size-=r,e},i.WebGLBatch.prototype.merge=function(t){this.dirty=!0,this.tail.__next=t.head,t.head.__prev=this.tail,this.size+=t.size,this.tail=t.tail;for(var e=t.head;e;)e.batch=this,e=e.__next},i.WebGLBatch.prototype.growBatch=function(){var t=this.gl;this.dynamicSize=1==this.size?1:1.5*this.size,this.verticies=new Float32Array(8*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticies,t.DYNAMIC_DRAW),this.uvs=new Float32Array(8*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(4*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(6*this.dynamicSize);for(var e=this.indices.length/6,r=0;e>r;r++){var n=6*r,i=4*r;this.indices[n+0]=i+0,this.indices[n+1]=i+1,this.indices[n+2]=i+2,this.indices[n+3]=i+0,this.indices[n+4]=i+2,this.indices[n+5]=i+3}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},i.WebGLBatch.prototype.refresh=function(){this.gl,this.dynamicSize<this.size&&this.growBatch();for(var t,e=0,r=this.head;r;){t=8*e;var n=r.texture,i=n.frame,o=n.baseTexture.width,a=n.baseTexture.height;this.uvs[t+0]=i.x/o,this.uvs[t+1]=i.y/a,this.uvs[t+2]=(i.x+i.width)/o,this.uvs[t+3]=i.y/a,this.uvs[t+4]=(i.x+i.width)/o,this.uvs[t+5]=(i.y+i.height)/a,this.uvs[t+6]=i.x/o,this.uvs[t+7]=(i.y+i.height)/a,r.updateFrame=!1,colorIndex=4*e,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=r.worldAlpha,r=r.__next,e++}this.dirtyUVS=!0,this.dirtyColors=!0},i.WebGLBatch.prototype.update=function(){this.gl;for(var t,e,r,n,i,o,a,s,h,u,c,l,d,f,p,m,v=0,g=this.head;g;){if(g.worldVisible){if(e=g.texture.frame.width,r=g.texture.frame.height,n=g.anchor.x,i=g.anchor.y,o=e*(1-n),a=e*-n,s=r*(1-i),h=r*-i,u=8*v,t=g.worldTransform,c=t[0],l=t[3],d=t[1],f=t[4],p=t[2],m=t[5],this.verticies[u+0]=c*a+d*h+p,this.verticies[u+1]=f*h+l*a+m,this.verticies[u+2]=c*o+d*h+p,this.verticies[u+3]=f*h+l*o+m,this.verticies[u+4]=c*o+d*s+p,this.verticies[u+5]=f*s+l*o+m,this.verticies[u+6]=c*a+d*s+p,this.verticies[u+7]=f*s+l*a+m,g.updateFrame||g.texture.updateFrame){this.dirtyUVS=!0;var b=g.texture,x=b.frame,y=b.baseTexture.width,w=b.baseTexture.height;this.uvs[u+0]=x.x/y,this.uvs[u+1]=x.y/w,this.uvs[u+2]=(x.x+x.width)/y,this.uvs[u+3]=x.y/w,this.uvs[u+4]=(x.x+x.width)/y,this.uvs[u+5]=(x.y+x.height)/w,this.uvs[u+6]=x.x/y,this.uvs[u+7]=(x.y+x.height)/w,g.updateFrame=!1}if(g.cacheAlpha!=g.worldAlpha){g.cacheAlpha=g.worldAlpha;var T=4*v;this.colors[T]=this.colors[T+1]=this.colors[T+2]=this.colors[T+3]=g.worldAlpha,this.dirtyColors=!0}}else u=8*v,this.verticies[u+0]=0,this.verticies[u+1]=0,this.verticies[u+2]=0,this.verticies[u+3]=0,this.verticies[u+4]=0,this.verticies[u+5]=0,this.verticies[u+6]=0,this.verticies[u+7]=0;v++,g=g.__next}},i.WebGLBatch.prototype.render=function(t,e){if(t=t||0,void 0==e&&(e=this.size),this.dirty&&(this.refresh(),this.dirty=!1),0!=this.size){this.update();var r=this.gl;r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);var n=i.shaderProgram;r.useProgram(n),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.verticies),r.vertexAttribPointer(n.vertexPositionAttribute,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,r.bufferSubData(r.ARRAY_BUFFER,0,this.uvs)),r.vertexAttribPointer(n.textureCoordAttribute,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.texture._glTexture),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,r.bufferSubData(r.ARRAY_BUFFER,0,this.colors)),r.vertexAttribPointer(n.colorAttribute,1,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var o=e-t;r.drawElements(r.TRIANGLES,6*o,r.UNSIGNED_SHORT,12*t)}},i.WebGLRenderGroup=function(t){this.gl=t,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},i.WebGLRenderGroup.constructor=i.WebGLRenderGroup,i.WebGLRenderGroup.prototype.setRenderable=function(t){this.root&&this.removeDisplayObjectAndChildren(this.root),t.worldVisible=t.visible,this.root=t,this.addDisplayObjectAndChildren(t)},i.WebGLRenderGroup.prototype.render=function(t){i.WebGLRenderer.updateTextures();var e=this.gl;e.uniformMatrix4fv(i.shaderProgram.mvMatrixUniform,!1,t),this.checkVisibility(this.root,this.root.visible);for(var r,n=0;n<this.batchs.length;n++)r=this.batchs[n],r instanceof i.WebGLBatch?this.batchs[n].render():r instanceof i.TilingSprite?r.visible&&this.renderTilingSprite(r,t):r instanceof i.Strip&&r.visible&&this.renderStrip(r,t)},i.WebGLRenderGroup.prototype.renderSpecific=function(t,e){i.WebGLRenderer.updateTextures();var r=this.gl;this.checkVisibility(t,t.visible),r.uniformMatrix4fv(i.shaderProgram.mvMatrixUniform,!1,e);var n,o,a,s,h=t.renderable?t:this.getNextRenderable(t),u=h.batch;if(h instanceof i.Sprite){u=h.batch;var c=u.head;if(c==h)n=0;else for(n=1;c.__next!=h;)n++,c=c.__next}else u=h;for(var l,d=t,f=t;f.children.length>0;)f=f.children[f.children.length-1],f.renderable&&(d=f);if(d instanceof i.Sprite){l=d.batch;var c=l.head;if(c==d)a=0;else for(a=1;c.__next!=d;)a++,c=c.__next}else l=d;if(u==l)return u instanceof i.WebGLBatch?u.render(n,a+1):u instanceof i.TilingSprite?u.visible&&this.renderTilingSprite(u,e):u instanceof i.Strip?u.visible&&this.renderStrip(u,e):u instanceof i.CustomRenderable&&u.visible&&u.renderWebGL(this,e),void 0;o=this.batchs.indexOf(u),s=this.batchs.indexOf(l),u instanceof i.WebGLBatch?u.render(n):u instanceof i.TilingSprite?u.visible&&this.renderTilingSprite(u,e):u instanceof i.Strip?u.visible&&this.renderStrip(u,e):u instanceof i.CustomRenderable&&u.visible&&u.renderWebGL(this,e);for(var p=o+1;s>p;p++)renderable=this.batchs[p],renderable instanceof i.WebGLBatch?this.batchs[p].render():renderable instanceof i.TilingSprite?renderable.visible&&this.renderTilingSprite(renderable,e):renderable instanceof i.Strip?renderable.visible&&this.renderStrip(renderable,e):renderable instanceof i.CustomRenderable&&renderable.visible&&renderable.renderWebGL(this,e);l instanceof i.WebGLBatch?l.render(0,a+1):l instanceof i.TilingSprite?l.visible&&this.renderTilingSprite(l):l instanceof i.Strip?l.visible&&this.renderStrip(l):l instanceof i.CustomRenderable&&l.visible&&l.renderWebGL(this,e)},i.WebGLRenderGroup.prototype.checkVisibility=function(t,e){for(var r=t.children,n=0;n<r.length;n++){var i=r[n];i.worldVisible=i.visible&&e,i.textureChange&&(i.textureChange=!1,i.worldVisible&&(this.removeDisplayObject(i),this.addDisplayObject(i))),i.children.length>0&&this.checkVisibility(i,i.worldVisible)}},i.WebGLRenderGroup.prototype.updateTexture=function(t){if(1==t.batch.length)return t.batch.texture=t.texture.baseTexture,void 0;if(t.batch.texture!=t.texture.baseTexture)if(t.batch.head==t){var e=t.batch,r=this.batchs.indexOf(e),n=this.batchs[r-1];if(e.remove(t),n)if(n.texture==t.texture.baseTexture&&n.blendMode==t.blendMode)n.insertAfter(t,n.tail);else{var o=i.WebGLRenderer.getBatch();o.init(t),this.batchs.splice(r-1,0,o)}else{var o=i.WebGLRenderer.getBatch();o.init(t),this.batchs.splice(0,0,o)}}else if(t.batch.tail==t){var e=t.batch,r=this.batchs.indexOf(e),a=this.batchs[r+1];if(e.remove(t),a){if(a.texture==t.texture.baseTexture&&a.blendMode==t.blendMode)return a.insertBefore(t,a.head),void 0;var o=i.WebGLRenderer.getBatch();o.init(t),this.batchs.splice(r+1,0,o)}else{var o=i.WebGLRenderer.getBatch();o.init(t),this.batchs.push(o)}}else{var e=t.batch,s=e.split(t);s.remove(t);var o=i.WebGLRenderer.getBatch(),r=this.batchs.indexOf(e);o.init(t),this.batchs.splice(r+1,0,o,s)}},i.WebGLRenderGroup.prototype.addDisplayObject=function(t){if(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),t.__renderGroup=this,t.renderable){var e=this.getPreviousRenderable(t),r=this.getNextRenderable(t);if(t instanceof i.Sprite){var n,o;if(e instanceof i.Sprite){if(n=e.batch,n&&n.texture==t.texture.baseTexture&&n.blendMode==t.blendMode)return n.insertAfter(t,e),void 0}else n=e;if(r)if(r instanceof i.Sprite){if(o=r.batch){if(o.texture==t.texture.baseTexture&&o.blendMode==t.blendMode)return o.insertBefore(t,r),void 0;if(o==n){var a=n.split(r),s=i.WebGLRenderer.getBatch(),h=this.batchs.indexOf(n);return s.init(t),this.batchs.splice(h+1,0,s,a),void 0}}}else o=r;var s=i.WebGLRenderer.getBatch();if(s.init(t),n){var h=this.batchs.indexOf(n);this.batchs.splice(h+1,0,s)}else this.batchs.push(s)}else t instanceof i.TilingSprite?(this.initTilingSprite(t),this.batchs.push(t)):t instanceof i.Strip&&(this.initStrip(t),this.batchs.push(t));this.batchUpdate=!0}},i.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(t){this.addDisplayObject(t);for(var e=t.children,r=0;r<e.length;r++)this.addDisplayObjectAndChildren(e[r])},i.WebGLRenderGroup.prototype.removeDisplayObject=function(t){if(t.__renderGroup=null,t.renderable){var e;if(t instanceof i.Sprite){var r=t.batch;if(!r)return;r.remove(t),0==r.size&&(e=r)}else e=t;if(e){var n=this.batchs.indexOf(e);if(-1==n)return;if(0==n||n==this.batchs.length-1)return this.batchs.splice(n,1),e instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(e),void 0;if(this.batchs[n-1]instanceof i.WebGLBatch&&this.batchs[n+1]instanceof i.WebGLBatch&&this.batchs[n-1].texture==this.batchs[n+1].texture&&this.batchs[n-1].blendMode==this.batchs[n+1].blendMode)return this.batchs[n-1].merge(this.batchs[n+1]),e instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(e),i.WebGLRenderer.returnBatch(this.batchs[n+1]),this.batchs.splice(n,2),void 0;this.batchs.splice(n,1),e instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(e)}}},i.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(t){if(t.__renderGroup==this){this.removeDisplayObject(t);for(var e=t.children,r=0;r<e.length;r++)this.removeDisplayObjectAndChildren(e[r])}},i.WebGLRenderGroup.prototype.getNextRenderable=function(t){var e=t;do{if(0==e.children.length){if(!e.parent)return null;for(;e.childIndex==e.parent.children.length-1;)if(e=e.parent,e==this.root||!e.parent){e=null;break}e&&(e=e.parent.children[e.childIndex+1])}else e=e.children[0];if(!e)break}while(!e.renderable||!e.__renderGroup);return e},i.WebGLRenderGroup.prototype.getPreviousRenderable=function(t){var e=t;do{if(0==e.childIndex){if(e=e.parent,!e)return null}else for(e=e.parent.children[e.childIndex-1];0!=e.children.length;)e=e.children[e.children.length-1];if(e==this.root)break}while(!e.renderable||!e.__renderGroup);return e},i.WebGLRenderGroup.prototype.initTilingSprite=function(t){var e=this.gl;t.verticies=new Float32Array([0,0,t.width,0,t.width,t.height,0,t.height]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.colors=new Float32Array([1,1,1,1]),t.indices=new Uint16Array([0,1,3,2]),t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.verticies,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW),t.texture.baseTexture._glTexture?(e.bindTexture(e.TEXTURE_2D,t.texture.baseTexture._glTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),t.texture.baseTexture._powerOf2=!0):t.texture.baseTexture._powerOf2=!0},i.WebGLRenderGroup.prototype.renderStrip=function(t,e){var r=this.gl,n=i.shaderProgram,o=i.mat3.toMat4(t.worldTransform);i.mat4.transpose(o),i.mat4.multiply(e,o,o),r.uniformMatrix4fv(n.mvMatrixUniform,!1,o),t.blendMode==i.blendModes.NORMAL?r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA):r.blendFunc(r.ONE,r.ONE_MINUS_SRC_COLOR),t.dirty?(t.dirty=!1,r.bindBuffer(r.ARRAY_BUFFER,t._vertexBuffer),r.bufferData(r.ARRAY_BUFFER,t.verticies,r.STATIC_DRAW),r.vertexAttribPointer(n.vertexPositionAttribute,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,t._uvBuffer),r.bufferData(r.ARRAY_BUFFER,t.uvs,r.STATIC_DRAW),r.vertexAttribPointer(n.textureCoordAttribute,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t.texture.baseTexture._glTexture),r.bindBuffer(r.ARRAY_BUFFER,t._colorBuffer),r.bufferData(r.ARRAY_BUFFER,t.colors,r.STATIC_DRAW),r.vertexAttribPointer(n.colorAttribute,1,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t._indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.indices,r.STATIC_DRAW)):(r.bindBuffer(r.ARRAY_BUFFER,t._vertexBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,t.verticies),r.vertexAttribPointer(n.vertexPositionAttribute,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,t._uvBuffer),r.vertexAttribPointer(n.textureCoordAttribute,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t.texture.baseTexture._glTexture),r.bindBuffer(r.ARRAY_BUFFER,t._colorBuffer),r.vertexAttribPointer(n.colorAttribute,1,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t._indexBuffer)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),r.uniformMatrix4fv(n.mvMatrixUniform,!1,e)},i.WebGLRenderGroup.prototype.renderTilingSprite=function(t,e){var r=this.gl;i.shaderProgram;var n=t.tilePosition,o=t.tileScale,a=n.x/t.texture.baseTexture.width,s=n.y/t.texture.baseTexture.height,h=t.width/t.texture.baseTexture.width/o.x,u=t.height/t.texture.baseTexture.height/o.y;t.uvs[0]=0-a,t.uvs[1]=0-s,t.uvs[2]=1*h-a,t.uvs[3]=0-s,t.uvs[4]=1*h-a,t.uvs[5]=1*u-s,t.uvs[6]=0-a,t.uvs[7]=1*u-s,r.bindBuffer(r.ARRAY_BUFFER,t._uvBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,t.uvs),this.renderStrip(t,e)},i.WebGLRenderGroup.prototype.initStrip=function(t){var e=this.gl;this.shaderProgram,t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.verticies,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW)},i.CanvasRenderer=function(t,e,r,n){this.transparent=n,this.width=t||800,this.height=e||600,this.refresh=!0,this.view=r||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.count=0,this.context=this.view.getContext("2d")},i.CanvasRenderer.constructor=i.CanvasRenderer,i.CanvasRenderer.prototype.render=function(t){i.texturesToUpdate=[],i.texturesToDestroy=[],t.updateTransform(),this.view.style.backgroundColor==t.backgroundColorString||this.transparent||(this.view.style.backgroundColor=t.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(t),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0&&(i.Texture.frameUpdates=[])},i.CanvasRenderer.prototype.resize=function(t,e){this.width=t,this.height=e,this.view.width=t,this.view.height=e},i.CanvasRenderer.prototype.renderDisplayObject=function(t){var e=t.worldTransform,r=this.context;if(t.visible){if(t instanceof i.Sprite){var n=t.texture.frame;n&&(r.globalAlpha=t.worldAlpha,r.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),r.drawImage(t.texture.baseTexture.source,n.x,n.y,n.width,n.height,t.anchor.x*-n.width,t.anchor.y*-n.height,n.width,n.height))}else t instanceof i.Strip?(r.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this.renderStrip(t)):t instanceof i.TilingSprite?(r.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this.renderTilingSprite(t)):t instanceof i.CustomRenderable&&t.renderCanvas(this);if(t.children)for(var o=0;o<t.children.length;o++)this.renderDisplayObject(t.children[o]);this.context.setTransform(1,0,0,1,0,0)}},i.CanvasRenderer.prototype.renderStripFlat=function(t){var e=this.context,r=t.verticies;t.uvs;var n=r.length/2;this.count++,e.beginPath();for(var i=1;n-2>i;i++){var o=2*i,a=r[o],s=r[o+2],h=r[o+4],u=r[o+1],c=r[o+3],l=r[o+5];e.moveTo(a,u),e.lineTo(s,c),e.lineTo(h,l)}e.fillStyle="#FF0000",e.fill(),e.closePath()},i.CanvasRenderer.prototype.renderTilingSprite=function(t){var e=this.context;t.__tilePattern||(t.__tilePattern=e.createPattern(t.texture.baseTexture.source,"repeat")),e.beginPath();
var r=t.tilePosition,n=t.tileScale;e.scale(n.x,n.y),e.translate(r.x,r.y),e.fillStyle=t.__tilePattern,e.fillRect(-r.x,-r.y,t.width/n.x,t.height/n.y),e.scale(1/n.x,1/n.y),e.translate(-r.x,-r.y),e.closePath()},i.CanvasRenderer.prototype.renderStrip=function(t){var e=this.context,r=t.verticies,n=t.uvs,i=r.length/2;this.count++;for(var o=1;i-2>o;o++){var a=2*o,s=r[a],h=r[a+2],u=r[a+4],c=r[a+1],l=r[a+3],d=r[a+5],f=n[a]*t.texture.width,p=n[a+2]*t.texture.width,m=n[a+4]*t.texture.width,v=n[a+1]*t.texture.height,g=n[a+3]*t.texture.height,b=n[a+5]*t.texture.height;e.save(),e.beginPath(),e.moveTo(s,c),e.lineTo(h,l),e.lineTo(u,d),e.closePath(),e.clip();var x=f*g+v*m+p*b-g*m-v*p-f*b,y=s*g+v*u+h*b-g*u-v*h-s*b,w=f*h+s*m+p*u-h*m-s*p-f*u,T=f*g*u+v*h*m+s*p*b-s*g*m-v*p*u-f*h*b,_=c*g+v*d+l*b-g*d-v*l-c*b,A=f*l+c*m+p*d-l*m-c*p-f*d,R=f*g*d+v*l*m+c*p*b-c*g*m-v*p*d-f*l*b;e.transform(y/x,_/x,w/x,A/x,T/x,R/x),e.drawImage(t.texture.baseTexture.source,0,0),e.restore()}},i.Strip=function(t,e,r){i.DisplayObjectContainer.call(this),this.texture=t,this.blendMode=i.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(n){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=e,this.height=r,t.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Strip.constructor=i.Strip,i.Strip.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Strip.prototype.setTexture=function(t){this.texture=t,this.width=t.frame.width,this.height=t.frame.height,this.updateFrame=!0},i.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Rope=function(t,e){i.Strip.call(this,t),this.points=e;try{this.verticies=new Float32Array(4*e.length),this.uvs=new Float32Array(4*e.length),this.colors=new Float32Array(2*e.length),this.indices=new Uint16Array(2*e.length)}catch(r){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},i.Rope.constructor=i.Rope,i.Rope.prototype=Object.create(i.Strip.prototype),i.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,r=this.indices,n=this.colors,i=t[0],o=t[0];this.count-=.2,e[0]=0,e[1]=1,e[2]=0,e[3]=1,n[0]=1,n[1]=1,r[0]=0,r[1]=1;for(var a=t.length,s=1;a>s;s++){var o=t[s],h=4*s,u=s/(a-1);s%2?(e[h]=u,e[h+1]=0,e[h+2]=u,e[h+3]=1):(e[h]=u,e[h+1]=0,e[h+2]=u,e[h+3]=1),h=2*s,n[h]=1,n[h+1]=1,h=2*s,r[h]=h,r[h+1]=h+1,i=o}}},i.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var e,r=this.verticies,n=t[0],o={x:0,y:0},a=t[0];this.count-=.2,r[0]=a.x+o.x,r[1]=a.y+o.y,r[2]=a.x-o.x,r[3]=a.y-o.y;for(var s=t.length,h=1;s>h;h++){var a=t[h],u=4*h;e=h<t.length-1?t[h+1]:a,o.y=-(e.x-n.x),o.x=e.y-n.y;var c=10*(1-h/(s-1));c>1&&(c=1);var l=Math.sqrt(o.x*o.x+o.y*o.y),d=this.texture.height/2;o.x/=l,o.y/=l,o.x*=d,o.y*=d,r[u]=a.x+o.x,r[u+1]=a.y+o.y,r[u+2]=a.x-o.x,r[u+3]=a.y-o.y,n=a}i.DisplayObjectContainer.prototype.updateTransform.call(this)}},i.Rope.prototype.setTexture=function(t){this.texture=t,this.updateFrame=!0},i.TilingSprite=function(t,e,r){i.DisplayObjectContainer.call(this),this.texture=t,this.width=e,this.height=r,this.renderable=!0,this.tileScale=new i.Point(1,1),this.tilePosition=new i.Point(0,0),this.blendMode=i.blendModes.NORMAL},i.TilingSprite.constructor=i.TilingSprite,i.TilingSprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.TilingSprite.prototype.setTexture=function(t){this.texture=t,this.updateFrame=!0},i.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Spine=function(t){if(i.DisplayObjectContainer.call(this),this.spineData=i.AnimCache[t],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+t);this.count=0,this.sprites=[],this.skeleton=new c.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new c.AnimationStateData(this.spineData),this.state=new c.AnimationState(this.stateData);for(var e=0;e<this.skeleton.drawOrder.length;e++){var r=this.skeleton.drawOrder[e].data.attachmentName;i.TextureCache[r]||(r+=".png");var n=new i.Sprite(i.Texture.fromFrame(r));n.anchor.x=n.anchor.y=.5,this.addChild(n),this.sprites.push(n)}},i.Spine.constructor=i.Spine,i.Spine.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Spine.prototype.updateTransform=function(){this.state.update(1/60),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var t=0;t<this.skeleton.drawOrder.length;t++){var e=this.skeleton.drawOrder[t],r=e.bone.worldX+e.attachment.x*e.bone.m00+e.attachment.y*e.bone.m01+.5*e.attachment.width,n=e.bone.worldY+e.attachment.x*e.bone.m10+e.attachment.y*e.bone.m11+.5*e.attachment.height;if(e.cacheName!=e.attachment.name){var o=e.attachment.name;i.TextureCache[o]||(o+=".png"),this.sprites[t].setTexture(i.TextureCache[o]),e.cacheName=e.attachment.name}r+=-(e.attachment.width*(e.bone.worldScaleX+e.attachment.scaleX-1)>>1),n+=-(e.attachment.height*(e.bone.worldScaleY+e.attachment.scaleY-1)>>1),this.sprites[t].position.x=r,this.sprites[t].position.y=n,this.sprites[t].rotation=-(e.bone.worldRotation+e.attachment.rotation)*(Math.PI/180)}i.DisplayObjectContainer.prototype.updateTransform.call(this)};var c={};c.BoneData=function(t,e){this.name=t,this.parent=e},c.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},c.SlotData=function(t,e){this.name=t,this.boneData=e},c.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},c.Bone=function(t,e){this.data=t,this.parent=e,this.setToSetupPose()},c.Bone.yDown=!1,c.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(t,e){var r=this.parent;null!=r?(this.worldX=this.x*r.m00+this.y*r.m01+r.worldX,this.worldY=this.x*r.m10+this.y*r.m11+r.worldY,this.worldScaleX=r.worldScaleX*this.scaleX,this.worldScaleY=r.worldScaleY*this.scaleY,this.worldRotation=r.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var n=this.worldRotation*Math.PI/180,i=Math.cos(n),o=Math.sin(n);this.m00=i*this.worldScaleX,this.m10=o*this.worldScaleX,this.m01=-o*this.worldScaleY,this.m11=i*this.worldScaleY,t&&(this.m00=-this.m00,this.m01=-this.m01),e&&(this.m10=-this.m10,this.m11=-this.m11),c.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY}},c.Slot=function(t,e,r){this.data=t,this.skeleton=e,this.bone=r,this.setToSetupPose()},c.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(t){this.attachment=t,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(t){this._attachmentTime=this.skeleton.time-t},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.skeleton.data.slots,r=0,n=e.length;n>r;r++)if(e[r]==t){this.setAttachment(t.attachmentName?this.skeleton.getAttachmentBySlotIndex(r,t.attachmentName):null);break}}},c.Skin=function(t){this.name=t,this.attachments={}},c.Skin.prototype={addAttachment:function(t,e,r){this.attachments[t+":"+e]=r},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var r in e.attachments){var n=r.indexOf(":"),i=parseInt(r.substring(0,n)),o=r.substring(n+1),a=t.slots[i];if(a.attachment&&a.attachment.name==o){var s=this.getAttachment(i,o);s&&a.setAttachment(s)}}}},c.Animation=function(t,e,r){this.name=t,this.timelines=e,this.duration=r},c.Animation.prototype={apply:function(t,e,r){r&&0!=this.duration&&(e%=this.duration);for(var n=this.timelines,i=0,o=n.length;o>i;i++)n[i].apply(t,e,1)},mix:function(t,e,r,n){r&&0!=this.duration&&(e%=this.duration);for(var i=this.timelines,o=0,a=i.length;a>o;o++)i[o].apply(t,e,n)}},c.binarySearch=function(t,e,r){var n=0,i=Math.floor(t.length/r)-2;if(0==i)return r;for(var o=i>>>1;;){if(t[(o+1)*r]<=e?n=o+1:i=o,n==i)return(n+1)*r;o=n+i>>>1}},c.linearSearch=function(t,e,r){for(var n=0,i=t.length-r;i>=n;n+=r)if(t[n]>e)return n;return-1},c.Curves=function(t){this.curves=[],this.curves.length=6*(t-1)},c.Curves.prototype={setLinear:function(t){this.curves[6*t]=0},setStepped:function(t){this.curves[6*t]=-1},setCurve:function(t,e,r,n,i){var o=.1,a=o*o,s=a*o,h=3*o,u=3*a,c=6*a,l=6*s,d=2*-e+n,f=2*-r+i,p=3*(e-n)+1,m=3*(r-i)+1,v=6*t,g=this.curves;g[v]=e*h+d*u+p*s,g[v+1]=r*h+f*u+m*s,g[v+2]=d*c+p*l,g[v+3]=f*c+m*l,g[v+4]=p*l,g[v+5]=m*l},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var r=6*t,n=this.curves,i=n[r];if(!i)return e;if(-1==i)return 0;for(var o=n[r+1],a=n[r+2],s=n[r+3],h=n[r+4],u=n[r+5],c=i,l=o,d=8;;){if(c>=e){var f=c-i,p=l-o;return p+(l-p)*(e-f)/(c-f)}if(0==d)break;d--,i+=a,o+=s,a+=h,s+=u,c+=i,l+=o}return l+(1-l)*(e-c)/(1-c)}},c.RotateTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=2*t},c.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,r){t*=2,this.frames[t]=e,this.frames[t+1]=r},apply:function(t,e,r){var n=this.frames;if(!(e<n[0])){var i=t.bones[this.boneIndex];if(e>=n[n.length-2]){for(var o=i.data.rotation+n[n.length-1]-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;return i.rotation+=o*r,void 0}var a=c.binarySearch(n,e,2),s=n[a-1],h=n[a],u=1-(e-h)/(n[a-2]-h);u=this.curves.getCurvePercent(a/2-1,u);for(var o=n[a+1]-s;o>180;)o-=360;for(;-180>o;)o+=360;for(o=i.data.rotation+(s+o*u)-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;i.rotation+=o*r}}},c.TranslateTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=3*t},c.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,r,n){t*=3,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n},apply:function(t,e,r){var n=this.frames;if(!(e<n[0])){var i=t.bones[this.boneIndex];if(e>=n[n.length-3])return i.x+=(i.data.x+n[n.length-2]-i.x)*r,i.y+=(i.data.y+n[n.length-1]-i.y)*r,void 0;var o=c.binarySearch(n,e,3),a=n[o-2],s=n[o-1],h=n[o],u=1-(e-h)/(n[o+-3]-h);u=this.curves.getCurvePercent(o/3-1,u),i.x+=(i.data.x+a+(n[o+1]-a)*u-i.x)*r,i.y+=(i.data.y+s+(n[o+2]-s)*u-i.y)*r}}},c.ScaleTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=3*t},c.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,r,n){t*=3,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n},apply:function(t,e,r){var n=this.frames;if(!(e<n[0])){var i=t.bones[this.boneIndex];if(e>=n[n.length-3])return i.scaleX+=(i.data.scaleX-1+n[n.length-2]-i.scaleX)*r,i.scaleY+=(i.data.scaleY-1+n[n.length-1]-i.scaleY)*r,void 0;var o=c.binarySearch(n,e,3),a=n[o-2],s=n[o-1],h=n[o],u=1-(e-h)/(n[o+-3]-h);u=this.curves.getCurvePercent(o/3-1,u),i.scaleX+=(i.data.scaleX-1+a+(n[o+1]-a)*u-i.scaleX)*r,i.scaleY+=(i.data.scaleY-1+s+(n[o+2]-s)*u-i.scaleY)*r}}},c.ColorTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=5*t},c.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e){t*=5,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=g,this.frames[t+3]=b,this.frames[t+4]=a},apply:function(t,e,r){var n=this.frames;if(!(e<n[0])){var i=t.slots[this.slotIndex];if(e>=n[n.length-5]){var o=n.length-1;return i.r=n[o-3],i.g=n[o-2],i.b=n[o-1],i.a=n[o],void 0}var a=c.binarySearch(n,e,5),s=n[a-4],h=n[a-3],u=n[a-2],l=n[a-1],d=n[a],f=1-(e-d)/(n[a-5]-d);f=this.curves.getCurvePercent(a/5-1,f);var p=s+(n[a+1]-s)*f,m=h+(n[a+2]-h)*f,v=u+(n[a+3]-u)*f,g=l+(n[a+4]-l)*f;1>r?(i.r+=(p-i.r)*r,i.g+=(m-i.g)*r,i.b+=(v-i.b)*r,i.a+=(g-i.a)*r):(i.r=p,i.g=m,i.b=v,i.a=g)}}},c.AttachmentTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},c.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,r){this.frames[t]=e,this.attachmentNames[t]=r},apply:function(t,e){var r=this.frames;if(!(e<r[0])){var n;n=e>=r[r.length-1]?r.length-1:c.binarySearch(r,e,1)-1;var i=this.attachmentNames[n];t.slots[this.slotIndex].setAttachment(i?t.getAttachmentBySlotIndex(this.slotIndex,i):null)}}},c.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},c.SkeletonData.prototype={defaultSkin:null,findBone:function(t){for(var e=this.bones,r=0,n=e.length;n>r;r++)if(e[r].name==t)return e[r];return null},findBoneIndex:function(t){for(var e=this.bones,r=0,n=e.length;n>r;r++)if(e[r].name==t)return r;return-1},findSlot:function(t){for(var e=this.slots,r=0,n=e.length;n>r;r++)if(e[r].name==t)return slot[r];return null},findSlotIndex:function(t){for(var e=this.slots,r=0,n=e.length;n>r;r++)if(e[r].name==t)return r;return-1},findSkin:function(t){for(var e=this.skins,r=0,n=e.length;n>r;r++)if(e[r].name==t)return e[r];return null},findAnimation:function(t){for(var e=this.animations,r=0,n=e.length;n>r;r++)if(e[r].name==t)return e[r];return null}},c.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,r=t.bones.length;r>e;e++){var n=t.bones[e],i=n.parent?this.bones[t.bones.indexOf(n.parent)]:null;this.bones.push(new c.Bone(n,i))}this.slots=[],this.drawOrder=[];for(var e=0,r=t.slots.length;r>e;e++){var o=t.slots[e],a=this.bones[t.bones.indexOf(o.boneData)],s=new c.Slot(o,this,a);this.slots.push(s),this.drawOrder.push(s)}},c.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var t=this.flipX,e=this.flipY,r=this.bones,n=0,i=r.length;i>n;n++)r[n].updateWorldTransform(t,e)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,r=t.length;r>e;e++)t[e].setToSetupPose()},setSlotsToSetupPose:function(){for(var t=this.slots,e=0,r=t.length;r>e;e++)t[e].setToSetupPose(e)},getRootBone:function(){return 0==this.bones.length?null:this.bones[0]},findBone:function(t){for(var e=this.bones,r=0,n=e.length;n>r;r++)if(e[r].data.name==t)return e[r];return null},findBoneIndex:function(t){for(var e=this.bones,r=0,n=e.length;n>r;r++)if(e[r].data.name==t)return r;return-1},findSlot:function(t){for(var e=this.slots,r=0,n=e.length;n>r;r++)if(e[r].data.name==t)return e[r];return null},findSlotIndex:function(t){for(var e=this.slots,r=0,n=e.length;n>r;r++)if(e[r].data.name==t)return r;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){this.skin&&t&&t._attachAll(this,this.skin),this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var r=this.skin.getAttachment(t,e);if(r)return r}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var r=this.slots,n=0,i=r.size;i>n;n++){var o=r[n];if(o.data.name==t){var a=null;if(e&&(a=this.getAttachment(n,e),null==a))throw"Attachment not found: "+e+", for slot: "+t;return o.setAttachment(a),void 0}}throw"Slot not found: "+t},update:function(t){time+=t}},c.AttachmentType={region:0},c.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},c.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,r,n,i){var o=this.uvs;i?(o[2]=t,o[3]=n,o[4]=t,o[5]=e,o[6]=r,o[7]=e,o[0]=r,o[1]=n):(o[0]=t,o[1]=n,o[2]=t,o[3]=e,o[4]=r,o[5]=e,o[6]=r,o[7]=n)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.regionOffsetX*t,n=-this.height/2*this.scaleY+this.regionOffsetY*e,i=r+this.regionWidth*t,o=n+this.regionHeight*e,a=this.rotation*Math.PI/180,s=Math.cos(a),h=Math.sin(a),u=r*s+this.x,c=r*h,l=n*s+this.y,d=n*h,f=i*s+this.x,p=i*h,m=o*s+this.y,v=o*h,g=this.offset;g[0]=u-d,g[1]=l+c,g[2]=u-v,g[3]=m+c,g[4]=f-v,g[5]=m+p,g[6]=f-d,g[7]=l+p},computeVertices:function(t,e,r,n){t+=r.worldX,e+=r.worldY;var i=r.m00,o=r.m01,a=r.m10,s=r.m11,h=this.offset;n[0]=h[0]*i+h[1]*o+t,n[1]=h[0]*a+h[1]*s+e,n[2]=h[2]*i+h[3]*o+t,n[3]=h[2]*a+h[3]*s+e,n[4]=h[4]*i+h[5]*o+t,n[5]=h[4]*a+h[5]*s+e,n[6]=h[6]*i+h[7]*o+t,n[7]=h[6]*a+h[7]*s+e}},c.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},c.AnimationStateData.prototype={setMixByName:function(t,e,r){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;var i=this.skeletonData.findAnimation(e);if(!i)throw"Animation not found: "+e;this.setMix(n,i,r)},setMix:function(t,e,r){this.animationToMixTime[t.name+":"+e.name]=r},getMix:function(t,e){var r=this.animationToMixTime[t.name+":"+e.name];return r?r:0}},c.AnimationState=function(t){this.data=t,this.queue=[]},c.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(t){if(this.currentTime+=t,this.previousTime+=t,this.mixTime+=t,this.queue.length>0){var e=this.queue[0];this.currentTime>=e.delay&&(this._setAnimation(e.animation,e.loop),this.queue.shift())}},apply:function(t){if(this.current)if(this.previous){this.previous.apply(t,this.previousTime,this.previousLoop);var e=this.mixTime/this.mixDuration;e>=1&&(e=1,this.previous=null),this.current.mix(t,this.currentTime,this.currentLoop,e)}else this.current.apply(t,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(t,e){this.previous=null,t&&this.current&&(this.mixDuration=this.data.getMix(this.current,t),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=t,this.currentLoop=e,this.currentTime=0},setAnimationByName:function(t,e){var r=this.data.skeletonData.findAnimation(t);if(!r)throw"Animation not found: "+t;this.setAnimation(r,e)},setAnimation:function(t,e){this.queue.length=0,this._setAnimation(t,e)},addAnimationByName:function(t,e,r){var n=this.data.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;this.addAnimation(n,e,r)},addAnimation:function(t,e,r){var n={};if(n.animation=t,n.loop=e,!r||0>=r){var i=0==this.queue.length?this.current:this.queue[this.queue.length-1].animation;r=null!=i?i.duration-this.data.getMix(i,t)+(r||0):0}n.delay=r,this.queue.push(n)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},c.SkeletonJson=function(t){this.attachmentLoader=t},c.SkeletonJson.prototype={scale:1,readSkeletonData:function(t){for(var e=new c.SkeletonData,r=t.bones,n=0,i=r.length;i>n;n++){var o=r[n],a=null;if(o.parent&&(a=e.findBone(o.parent),!a))throw"Parent bone not found: "+o.parent;var s=new c.BoneData(o.name,a);s.length=(o.length||0)*this.scale,s.x=(o.x||0)*this.scale,s.y=(o.y||0)*this.scale,s.rotation=o.rotation||0,s.scaleX=o.scaleX||1,s.scaleY=o.scaleY||1,e.bones.push(s)}for(var h=t.slots,n=0,i=h.length;i>n;n++){var u=h[n],s=e.findBone(u.bone);if(!s)throw"Slot bone not found: "+u.bone;var l=new c.SlotData(u.name,s),d=u.color;d&&(l.r=c.SkeletonJson.toColor(d,0),l.g=c.SkeletonJson.toColor(d,1),l.b=c.SkeletonJson.toColor(d,2),l.a=c.SkeletonJson.toColor(d,3)),l.attachmentName=u.attachment,e.slots.push(l)}var f=t.skins;for(var p in f)if(f.hasOwnProperty(p)){var m=f[p],v=new c.Skin(p);for(var g in m)if(m.hasOwnProperty(g)){var b=e.findSlotIndex(g),x=m[g];for(var y in x)if(x.hasOwnProperty(y)){var w=this.readAttachment(v,y,x[y]);null!=w&&v.addAttachment(b,y,w)}}e.skins.push(v),"default"==v.name&&(e.defaultSkin=v)}var T=t.animations;for(var _ in T)T.hasOwnProperty(_)&&this.readAnimation(_,T[_],e);return e},readAttachment:function(t,e,r){e=r.name||e;var n=c.AttachmentType[r.type||"region"],i=new c.RegionAttachment;return i.name=e,n==c.AttachmentType.region&&(i.x=(r.x||0)*this.scale,i.y=(r.y||0)*this.scale,i.scaleX=r.scaleX||1,i.scaleY=r.scaleY||1,i.rotation=r.rotation||0,i.width=(r.width||32)*this.scale,i.height=(r.height||32)*this.scale,i.updateOffset()),i},readAnimation:function(t,e,r){var n=[],i=0,o=e.bones;for(var a in o)if(o.hasOwnProperty(a)){var s=r.findBoneIndex(a);if(-1==s)throw"Bone not found: "+a;var h=o[a];for(var u in h)if(h.hasOwnProperty(u)){var l=h[u];if("rotate"==u){var d=new c.RotateTimeline(l.length);d.boneIndex=s;for(var f=0,p=0,m=l.length;m>p;p++){var v=l[p];d.setFrame(f,v.time,v.angle),c.SkeletonJson.readCurve(d,f,v),f++}n.push(d),i=Math.max(i,d.frames[2*d.getFrameCount()-2])}else{if("translate"!=u&&"scale"!=u)throw"Invalid timeline type for a bone: "+u+" ("+a+")";var d,g=1;"scale"==u?d=new c.ScaleTimeline(l.length):(d=new c.TranslateTimeline(l.length),g=this.scale),d.boneIndex=s;for(var f=0,p=0,m=l.length;m>p;p++){var v=l[p],b=(v.x||0)*g,x=(v.y||0)*g;d.setFrame(f,v.time,b,x),c.SkeletonJson.readCurve(d,f,v),f++}n.push(d),i=Math.max(i,d.frames[3*d.getFrameCount()-3])}}}var y=e.slots;for(var w in y)if(y.hasOwnProperty(w)){var T=y[w],_=r.findSlotIndex(w);for(var u in T)if(T.hasOwnProperty(u)){var l=T[u];if("color"==u){var d=new c.ColorTimeline(l.length);d.slotIndex=_;for(var f=0,p=0,m=l.length;m>p;p++){var v=l[p],A=v.color,R=c.SkeletonJson.toColor(A,0),S=c.SkeletonJson.toColor(A,1),E=c.SkeletonJson.toColor(A,2),C=c.SkeletonJson.toColor(A,3);d.setFrame(f,v.time,R,S,E,C),c.SkeletonJson.readCurve(d,f,v),f++}n.push(d),i=Math.max(i,d.frames[5*d.getFrameCount()-5])}else{if("attachment"!=u)throw"Invalid timeline type for a slot: "+u+" ("+w+")";var d=new c.AttachmentTimeline(l.length);d.slotIndex=_;for(var f=0,p=0,m=l.length;m>p;p++){var v=l[p];d.setFrame(f++,v.time,v.name)}n.push(d),i=Math.max(i,d.frames[Math.floor(d.getFrameCount())-1])}}}r.animations.push(new c.Animation(t,n,i))}},c.SkeletonJson.readCurve=function(t,e,r){var n=r.curve;n&&("stepped"==n?t.curves.setStepped(e):n instanceof Array&&t.curves.setCurve(e,n[0],n[1],n[2],n[3]))},c.SkeletonJson.toColor=function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2),16)/255},c.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var r=new c.AtlasReader(t),n=[];n.length=4;for(var i=null;;){var o=r.readLine();if(null==o)break;if(o=r.trim(o),0==o.length)i=null;else if(i){var a=new c.AtlasRegion;a.name=o,a.page=i,a.rotate="true"==r.readValue(),r.readTuple(n);var s=parseInt(n[0]),h=parseInt(n[1]);r.readTuple(n);var u=parseInt(n[0]),l=parseInt(n[1]);a.u=s/i.width,a.v=h/i.height,a.rotate?(a.u2=(s+l)/i.width,a.v2=(h+u)/i.height):(a.u2=(s+u)/i.width,a.v2=(h+l)/i.height),a.x=s,a.y=h,a.width=Math.abs(u),a.height=Math.abs(l),4==r.readTuple(n)&&(a.splits=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],4==r.readTuple(n)&&(a.pads=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],r.readTuple(n))),a.originalWidth=parseInt(n[0]),a.originalHeight=parseInt(n[1]),r.readTuple(n),a.offsetX=parseInt(n[0]),a.offsetY=parseInt(n[1]),a.index=parseInt(r.readValue()),this.regions.push(a)}else{i=new c.AtlasPage,i.name=o,i.format=c.Atlas.Format[r.readValue()],r.readTuple(n),i.minFilter=c.Atlas.TextureFilter[n[0]],i.magFilter=c.Atlas.TextureFilter[n[1]];var d=r.readValue();i.uWrap=c.Atlas.TextureWrap.clampToEdge,i.vWrap=c.Atlas.TextureWrap.clampToEdge,"x"==d?i.uWrap=c.Atlas.TextureWrap.repeat:"y"==d?i.vWrap=c.Atlas.TextureWrap.repeat:"xy"==d&&(i.uWrap=i.vWrap=c.Atlas.TextureWrap.repeat),e.load(i,o),this.pages.push(i)}}},c.Atlas.prototype={findRegion:function(t){for(var e=this.regions,r=0,n=e.length;n>r;r++)if(e[r].name==t)return e[r];return null},dispose:function(){for(var t=this.pages,e=0,r=t.length;r>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,r=0,n=e.length;n>r;r++){var i=e[r];i.page==t&&(i.u=i.x/t.width,i.v=i.y/t.height,i.rotate?(i.u2=(i.x+i.height)/t.width,i.v2=(i.y+i.width)/t.height):(i.u2=(i.x+i.width)/t.width,i.v2=(i.y+i.height)/t.height))}}},c.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},c.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},c.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},c.AtlasPage=function(){},c.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},c.AtlasRegion=function(){},c.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},c.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},c.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),r=e.indexOf(":");if(-1==r)throw"Invalid line: "+e;for(var n=0,i=r+1;3>n;n++){var o=e.indexOf(",",i);if(-1==o){if(0==n)throw"Invalid line: "+e;break}t[n]=this.trim(e.substr(i,o-i)),i=o+1}return t[n]=this.trim(e.substring(i)),n+1}},c.AtlasAttachmentLoader=function(t){this.atlas=t},c.AtlasAttachmentLoader.prototype={newAttachment:function(t,e,r){switch(e){case c.AttachmentType.region:var n=this.atlas.findRegion(r);if(!n)throw"Region not found in atlas: "+r+" ("+e+")";var i=new c.RegionAttachment(r);return i.rendererObject=n,i.setUVs(n.u,n.v,n.u2,n.v2,n.rotate),i.regionOffsetX=n.offsetX,i.regionOffsetY=n.offsetY,i.regionWidth=n.width,i.regionHeight=n.height,i.regionOriginalWidth=n.originalWidth,i.regionOriginalHeight=n.originalHeight,i}throw"Unknown attachment type: "+e}},i.AnimCache={},c.Bone.yDown=!0,i.CustomRenderable=function(){i.DisplayObject.call(this)},i.CustomRenderable.constructor=i.CustomRenderable,i.CustomRenderable.prototype=Object.create(i.DisplayObject.prototype),i.CustomRenderable.prototype.renderCanvas=function(){},i.CustomRenderable.prototype.initWebGL=function(){},i.CustomRenderable.prototype.renderWebGL=function(){},i.BaseTextureCache={},i.texturesToUpdate=[],i.texturesToDestroy=[],i.BaseTexture=function(t){if(i.EventTarget.call(this),this.width=100,this.height=100,this.source=t,t){if(this.source instanceof Image)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);else{var e=this;this.source.onload=function(){e.hasLoaded=!0,e.width=e.source.width,e.height=e.source.height,i.texturesToUpdate.push(e),e.dispatchEvent({type:"loaded",content:e})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);this._powerOf2=!1}},i.BaseTexture.constructor=i.BaseTexture,i.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,i.texturesToDestroy.push(this)},i.BaseTexture.fromImage=function(t,e){var r=i.BaseTextureCache[t];if(!r){var n=new Image;e&&(n.crossOrigin=""),n.src=t,r=new i.BaseTexture(n),i.BaseTextureCache[t]=r}return r},i.TextureCache={},i.FrameCache={},i.Texture=function(t,e){if(i.EventTarget.call(this),e||(this.noFrame=!0,e=new i.Rectangle(0,0,1,1)),this.trim=new i.Point,t instanceof i.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=e,this.scope=this,t.hasLoaded)this.noFrame&&(e=new i.Rectangle(0,0,t.width,t.height)),this.setFrame(e);else{var r=this;t.addEventListener("loaded",function(){r.onBaseTextureLoaded()})}},i.Texture.constructor=i.Texture,i.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new i.Rectangle(0,0,t.width,t.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},i.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy()},i.Texture.prototype.setFrame=function(t){if(this.frame=t,this.width=t.width,this.height=t.height,t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,i.Texture.frameUpdates.push(this)},i.Texture.fromImage=function(t,e){var r=i.TextureCache[t];return r||(r=new i.Texture(i.BaseTexture.fromImage(t,e)),i.TextureCache[t]=r),r},i.Texture.fromFrame=function(t){var e=i.TextureCache[t];if(!e)throw new Error("The frameId '"+t+"' does not exist in the texture cache "+this);return e},i.Texture.fromCanvas=function(t){var e=new i.BaseTexture(t);return new i.Texture(e)},i.Texture.addTextureToCache=function(t,e){i.TextureCache[e]=t},i.Texture.removeTextureFromCache=function(t){var e=i.TextureCache[t];return i.TextureCache[t]=null,e},i.Texture.frameUpdates=[],i.RenderTexture=function(t,e){i.EventTarget.call(this),this.width=t||100,this.height=e||100,this.indetityMatrix=i.mat3.create(),this.frame=new i.Rectangle(0,0,this.width,this.height),i.gl?this.initWebGL():this.initCanvas()},i.RenderTexture.constructor=i.RenderTexture,i.RenderTexture.prototype=Object.create(i.Texture.prototype),i.RenderTexture.prototype.initWebGL=function(){var t=i.gl;this.glFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new i.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.baseTexture._glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,t.bindFramebuffer(t.FRAMEBUFFER,this.glFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.baseTexture._glTexture,0),this.projectionMatrix=i.mat4.create(),this.projectionMatrix[5]=2/this.height,this.projectionMatrix[13]=-1,this.projectionMatrix[0]=2/this.width,this.projectionMatrix[12]=-1,this.render=this.renderWebGL},i.RenderTexture.prototype.initCanvas=function(){this.renderer=new i.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new i.BaseTexture(this.renderer.view),this.frame=new i.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},i.RenderTexture.prototype.renderWebGL=function(t,e){var r=i.gl;r.colorMask(!0,!0,!0,!0),r.viewport(0,0,this.width,this.height),r.bindFramebuffer(r.FRAMEBUFFER,this.glFramebuffer),e&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT));var n=t.children;t.worldTransform=i.mat3.create();for(var o=0,a=n.length;a>o;o++)n[o].updateTransform();var s=t.__renderGroup;s?t==s.root?s.render(this.projectionMatrix):s.renderSpecific(t,this.projectionMatrix):(this.renderGroup||(this.renderGroup=new i.WebGLRenderGroup(r)),this.renderGroup.setRenderable(t),this.renderGroup.render(this.projectionMatrix))},i.RenderTexture.prototype.renderCanvas=function(t,e){var r=t.children;t.worldTransform=i.mat3.create();for(var n=0,o=r.length;o>n;n++)r[n].updateTransform();
e&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(t),i.texturesToUpdate.push(this.baseTexture)},i.AssetLoader=function(t){i.EventTarget.call(this),this.assetURLs=t,this.crossorigin=!1,this.loadersByType={jpg:i.ImageLoader,jpeg:i.ImageLoader,png:i.ImageLoader,gif:i.ImageLoader,json:i.JsonLoader,anim:i.SpineLoader,xml:i.BitmapFontLoader,fnt:i.BitmapFontLoader}},i.AssetLoader.constructor=i.AssetLoader,i.AssetLoader.prototype.load=function(){var t=this;this.loadCount=this.assetURLs.length;for(var e=0;e<this.assetURLs.length;e++){var r=this.assetURLs[e],n=r.split(".").pop().toLowerCase(),i=this.loadersByType[n];if(!i)throw new Error(n+" is an unsupported file type");var o=new i(r,this.crossorigin);o.addEventListener("loaded",function(){t.onAssetLoaded()}),o.load()}},i.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},i.JsonLoader=function(t,e){i.EventTarget.call(this),this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.crossorigin=e,this.loaded=!1},i.JsonLoader.constructor=i.JsonLoader,i.JsonLoader.prototype.load=function(){this.ajaxRequest=new u;var t=this;this.ajaxRequest.onreadystatechange=function(){t.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},i.JsonLoader.prototype.onJSONLoaded=function(){if(4==this.ajaxRequest.readyState)if(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var t=this,e=this.baseUrl+this.json.meta.image,r=new i.ImageLoader(e,this.crossorigin),n=this.json.frames;this.texture=r.texture.baseTexture,r.addEventListener("loaded",function(){t.onLoaded()});for(var o in n){var a=n[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),n[o].trimmed&&(i.TextureCache[o].realSize=n[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}r.load()}else if(this.json.bones){var s=new c.SkeletonJson,h=s.readSkeletonData(this.json);i.AnimCache[this.url]=h,this.onLoaded()}else this.onLoaded();else this.onError()},i.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},i.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},i.SpriteSheetLoader=function(t,e){i.EventTarget.call(this),this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={},this.crossorigin=e},i.SpriteSheetLoader.constructor=i.SpriteSheetLoader,i.SpriteSheetLoader.prototype.load=function(){var t=this,e=new i.JsonLoader(this.url,this.crossorigin);e.addEventListener("loaded",function(e){t.json=e.content.json,t.onJSONLoaded()}),e.load()},i.SpriteSheetLoader.prototype.onJSONLoaded=function(){var t=this,e=this.baseUrl+this.json.meta.image,r=new i.ImageLoader(e,this.crossorigin),n=this.json.frames;this.texture=r.texture.baseTexture,r.addEventListener("loaded",function(){t.onLoaded()});for(var o in n){var a=n[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),n[o].trimmed&&(i.TextureCache[o].realSize=n[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}r.load()},i.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.ImageLoader=function(t,e){i.EventTarget.call(this),this.texture=i.Texture.fromImage(t,e)},i.ImageLoader.constructor=i.ImageLoader,i.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var t=this;this.texture.baseTexture.addEventListener("loaded",function(){t.onLoaded()})}},i.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.BitmapFontLoader=function(t,e){i.EventTarget.call(this),this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.crossorigin=e},i.BitmapFontLoader.constructor=i.BitmapFontLoader,i.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var t=this;this.ajaxRequest.onreadystatechange=function(){t.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},i.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))){var t=this.baseUrl+this.ajaxRequest.responseXML.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue,e=new i.ImageLoader(t,this.crossorigin);this.texture=e.texture.baseTexture;var r={},n=this.ajaxRequest.responseXML.getElementsByTagName("info")[0],o=this.ajaxRequest.responseXML.getElementsByTagName("common")[0];r.font=n.attributes.getNamedItem("face").nodeValue,r.size=parseInt(n.attributes.getNamedItem("size").nodeValue,10),r.lineHeight=parseInt(o.attributes.getNamedItem("lineHeight").nodeValue,10),r.chars={};for(var a=this.ajaxRequest.responseXML.getElementsByTagName("char"),s=0;s<a.length;s++){var h=parseInt(a[s].attributes.getNamedItem("id").nodeValue,10),u={x:parseInt(a[s].attributes.getNamedItem("x").nodeValue,10),y:parseInt(a[s].attributes.getNamedItem("y").nodeValue,10),width:parseInt(a[s].attributes.getNamedItem("width").nodeValue,10),height:parseInt(a[s].attributes.getNamedItem("height").nodeValue,10)};i.TextureCache[h]=new i.Texture(this.texture,u),r.chars[h]={xOffset:parseInt(a[s].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(a[s].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(a[s].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new i.Texture(this.texture,u)}}var c=this.ajaxRequest.responseXML.getElementsByTagName("kerning");for(s=0;s<c.length;s++){var l=parseInt(c[s].attributes.getNamedItem("first").nodeValue,10),d=parseInt(c[s].attributes.getNamedItem("second").nodeValue,10),f=parseInt(c[s].attributes.getNamedItem("amount").nodeValue,10);r.chars[d].kerning[l]=f}i.BitmapText.fonts[r.font]=r;var p=this;e.addEventListener("loaded",function(){p.onLoaded()}),e.load()}},i.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.SpineLoader=function(t,e){i.EventTarget.call(this),this.url=t,this.crossorigin=e,this.loaded=!1},i.SpineLoader.constructor=i.SpineLoader,i.SpineLoader.prototype.load=function(){new i.JsonLoader(this.url,this.crossorigin),jsonLoader.addEventListener("loaded",function(t){scope.json=t.content.json,scope.onJSONLoaded()}),jsonLoader.load()},i.SpineLoader.prototype.load=function(){var t=this,e=new i.JsonLoader(this.url,this.crossorigin);e.addEventListener("loaded",function(e){t.json=e.content.json,t.onJSONLoaded()}),e.load()},i.SpineLoader.prototype.onJSONLoaded=function(){var t=new c.SkeletonJson,e=t.readSkeletonData(this.json);i.AnimCache[this.url]=e,this.onLoaded()},i.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.PIXI=i):n.PIXI=i}.call(this),define("PIXI",function(t){return function(){var e;return e||t.PIXI}}(this)),define("displayConfig",[],function(){return{width:800,height:600,interactive:!0,background:0,renderTarget:document.body}}),define("utils/eventPublisher",[],function(){return function(t){function e(t){var e=0,n=r.length;for(e;n>e;e+=1)if(t===r[e])return!0;return!1}var r=[];if("[object Array]"!==Object.prototype.toString.apply(t))throw new Error("EventType argument isn't an array.");return r=t,{subscribers:{any:[]},on:function(t,r,n){if(t=t||"any"){if(!e(t))throw new Error("Encountered unexpected eventtype: "+t+". Needs predefinition in publisher object.");t=t}else t="any";r="function"==typeof r?r:n[r],"undefined"==typeof this.subscribers[t]&&(this.subscribers[t]=[]),this.subscribers[t].push({fn:r,context:n||this})},remove:function(t,e,r){this.visitSubscribers("unsubscribe",t,e,r)},fire:function(t,e){this.visitSubscribers("publish",t,e)},visitSubscribers:function(t,e,r,n){var i,o=e||"any",a=this.subscribers[o],s=a?a.length:0,h=n?n:this;for(i=0;s>i;i+=1)"publish"===t?a[i].fn.call(a[i].targetContext,r):a[i].fn===r&&a[i].context===h&&a.splice(i,1)}}}}),define("displayController",["PIXI","displayConfig","utils/eventPublisher"],function(t,e,r){function n(){requestAnimFrame(n),h.fire("renderFrame"),o.render(i),s+=1}var i=new t.Stage(e.background,e.interactive),o=t.autoDetectRenderer(e.width,e.height),a=e.renderTarget,s=0,h=r(["renderFrame","debugInfo"]);return function(){console.log("display: init"),a.appendChild(o.view),requestAnimFrame(n)}(),setInterval(function(){var t=s/2,e="display: received "+s+" frames @ "+t+"fps.";h.fire("debugInfo",e),s=0},2e3),{stage:i,events:h}}),function(t,e,r){function n(r,o){if(!e[r]){if(!t[r]){var a="function"==typeof require&&require;if(!o&&a)return a(r,!0);if(i)return i(r,!0);throw new Error("Cannot find module '"+r+"'")}var s=e[r]={exports:{}};t[r][0].call(s.exports,function(e){var i=t[r][1][e];return n(i?i:e)},s,s.exports)}return e[r].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e){var r=t("./protocol").chooseProtocol,n=t("events").EventEmitter,i=t("underscore"),o=e.exports=function(t){this.opts=i.defaults(t||{},{host:"127.0.0.1",enableGestures:!1,port:6437,enableHeartbeat:!0,heartbeatInterval:100,requestProtocolVersion:3}),this.host=this.opts.host,this.port=this.opts.port,this.on("ready",function(){this.enableGestures(this.opts.enableGestures),this.opts.enableHeartbeat&&this.startHeartbeat()}),this.on("disconnect",function(){this.opts.enableHeartbeat&&this.stopHeartbeat()}),this.heartbeatTimer=null};o.prototype.getUrl=function(){return"ws://"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"},o.prototype.sendHeartbeat=function(){this.protocol&&(this.setHeartbeatState(!0),this.protocol.sendHeartbeat(this))},o.prototype.handleOpen=function(){this.emit("connect")},o.prototype.enableGestures=function(t){this.gesturesEnabled=t?!0:!1,this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))},o.prototype.handleClose=function(){this.disconnect(),this.startReconnection()},o.prototype.startReconnection=function(){var t=this;setTimeout(function(){t.connect()},1e3)},o.prototype.disconnect=function(){this.socket&&(this.socket.close(),delete this.socket,delete this.protocol,this.emit("disconnect"))},o.prototype.handleData=function(t){var e,n=JSON.parse(t);void 0===this.protocol?(e=this.protocol=r(n),this.emit("ready")):e=this.protocol(n),this.emit(e.type,e)},o.prototype.connect=function(){return this.socket?void 0:(this.socket=this.setupSocket(),!0)},o.prototype.send=function(t){this.socket.send(t)},o.prototype.stopHeartbeat=function(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),delete this.heartbeatTimer,this.setHeartbeatState(!1))},o.prototype.setHeartbeatState=function(t){this.heartbeatState!==t&&(this.heartbeatState=t,this.emit(this.heartbeatState?"focus":"blur"))},i.extend(o.prototype,n.prototype)},{"./protocol":12,events:17,underscore:20}],2:[function(t,e){var r=e.exports=function(t){this.pos=0,this._buf=[],this.size=t};r.prototype.get=function(t){return void 0==t&&(t=0),t>=this.size?void 0:t>=this._buf.length?void 0:this._buf[(this.pos-t-1)%this.size]},r.prototype.push=function(t){return this._buf[this.pos%this.size]=t,this.pos++}},{}],3:[function(t,e){var r=e.exports=t("./base_connection");r.prototype.setupSocket=function(){var t=this,e=new WebSocket(this.getUrl());return e.onopen=function(){t.handleOpen()},e.onmessage=function(e){t.handleData(e.data)},e.onclose=function(){t.handleClose()},e},r.prototype.startHeartbeat=function(){if(this.protocol.sendHeartbeat&&!this.heartbeatTimer){var t=this,e=null;e="undefined"!=typeof document.hidden?"hidden":"undefined"!=typeof document.mozHidden?"mozHidden":"undefined"!=typeof document.msHidden?"msHidden":"undefined"!=typeof document.webkitHidden?"webkitHidden":void 0;var r=!0,n=window.addEventListener("focus",function(){r=!0}),i=window.addEventListener("blur",function(){r=!1});this.on("disconnect",function(){t.heartbeatTimer&&(clearTimeout(t.heartbeatTimer),delete t.heartbeatTimer),window.removeEventListener(n),window.removeEventListener(i)}),this.heartbeatTimer=setInterval(function(){var n=void 0===e?!0:document[e]===!1;n&&r?t.sendHeartbeat():t.setHeartbeatState(!1)},this.opts.heartbeatInterval)}}},{"./base_connection":1}],4:[function(t,e){!function(r){var n=t("./frame"),i=t("./circular_buffer"),o=t("./pipeline"),a=t("events").EventEmitter,s=t("./gesture").gestureListener,h=t("underscore"),u=e.exports=function(e){var o="undefined"!=typeof r&&"node"===r.title;e=h.defaults(e||{},{inNode:o}),this.inNode=e.inNode,e=h.defaults(e||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",supressAnimationLoop:!1}),this.supressAnimationLoop=e.supressAnimationLoop,this.frameEventName=e.frameEventName,this.history=new i(200),this.lastFrame=n.Invalid,this.lastValidFrame=n.Invalid,this.lastConnectionFrame=n.Invalid,this.accumulatedGestures=[],this.connectionType=void 0===e.connectionType?this.inBrowser()?t("./connection"):t("./node_connection"):e.connectionType,this.connection=new this.connectionType(e),this.setupConnectionEvents()};u.prototype.gesture=function(t,e){var r=s(this,t);return void 0!==e&&r.stop(e),r},u.prototype.inBrowser=function(){return!this.inNode},u.prototype.useAnimationLoop=function(){return this.inBrowser()&&"undefined"==typeof chrome},u.prototype.connect=function(){var t=this;if(this.connection.connect()&&this.inBrowser()&&!t.supressAnimationLoop){var e=function(){t.emit("animationFrame",t.lastConnectionFrame),window.requestAnimFrame(e)};window.requestAnimFrame(e)}},u.prototype.disconnect=function(){this.connection.disconnect()},u.prototype.frame=function(t){return this.history.get(t)||n.Invalid},u.prototype.loop=function(t){switch(t.length){case 1:this.on(this.frameEventName,t);break;case 2:var e=this,r=function(n){t(n,function(){e.lastFrame!=n?r(e.lastFrame):e.once(e.frameEventName,r)})};this.once(this.frameEventName,r)}this.connect()},u.prototype.addStep=function(t){this.pipeline||(this.pipeline=new o(this)),this.pipeline.addStep(t)},u.prototype.processFrame=function(t){t.gestures&&(this.accumulatedGestures=this.accumulatedGestures.concat(t.gestures)),this.pipeline&&(t=this.pipeline.run(t),t||(t=n.Invalid)),this.lastConnectionFrame=t,this.emit("deviceFrame",t)},u.prototype.processFinishedFrame=function(t){if(this.lastFrame=t,t.valid&&(this.lastValidFrame=t),t.controller=this,t.historyIdx=this.history.push(t),t.gestures){t.gestures=this.accumulatedGestures,this.accumulatedGestures=[];for(var e=0;e!=t.gestures.length;e++)this.emit("gesture",t.gestures[e],t)}this.emit("frame",t)},u.prototype.setupConnectionEvents=function(){var t=this;this.connection.on("frame",function(e){t.processFrame(e)}),this.on(this.frameEventName,function(e){t.processFinishedFrame(e)}),this.connection.on("disconnect",function(){t.emit("disconnect")}),this.connection.on("ready",function(){t.emit("ready")}),this.connection.on("connect",function(){t.emit("connect")}),this.connection.on("focus",function(){t.emit("focus")}),this.connection.on("blur",function(){t.emit("blur")}),this.connection.on("protocol",function(e){t.emit("protocol",e)}),this.connection.on("deviceConnect",function(e){t.emit(e.state?"deviceConnected":"deviceDisconnected")})},h.extend(u.prototype,a.prototype)}(t("__browserify_process"))},{"./circular_buffer":2,"./connection":3,"./frame":5,"./gesture":6,"./node_connection":16,"./pipeline":10,__browserify_process:18,events:17,underscore:20}],5:[function(t,e){var r=t("./hand"),n=t("./pointable"),i=t("./gesture").createGesture,o=t("gl-matrix"),a=o.mat3,s=o.vec3,h=t("./interaction_box"),u=t("underscore"),c=e.exports=function(t){this.valid=!0,this.id=t.id,this.timestamp=t.timestamp,this.hands=[],this.handsMap={},this.pointables=[],this.tools=[],this.fingers=[],t.interactionBox&&(this.interactionBox=new h(t.interactionBox)),this.gestures=[],this.pointablesMap={},this._translation=t.t,this._rotation=u.flatten(t.r),this._scaleFactor=t.s,this.data=t,this.type="frame",this.currentFrameRate=t.currentFrameRate;for(var e={},o=0,a=t.hands.length;o!=a;o++){var s=new r(t.hands[o]);s.frame=this,this.hands.push(s),this.handsMap[s.id]=s,e[s.id]=o}for(var c=0,l=t.pointables.length;c!=l;c++){var d=new n(t.pointables[c]);if(d.frame=this,this.pointables.push(d),this.pointablesMap[d.id]=d,(d.tool?this.tools:this.fingers).push(d),void 0!==d.handId&&e.hasOwnProperty(d.handId)){var s=this.hands[e[d.handId]];s.pointables.push(d),(d.tool?s.tools:s.fingers).push(d)}}if(t.gestures)for(var f=0,p=t.gestures.length;f!=p;f++)this.gestures.push(i(t.gestures[f]))};c.prototype.tool=function(t){var e=this.pointable(t);return e.tool?e:n.Invalid},c.prototype.pointable=function(t){return this.pointablesMap[t]||n.Invalid},c.prototype.finger=function(t){var e=this.pointable(t);return e.tool?n.Invalid:e},c.prototype.hand=function(t){return this.handsMap[t]||r.Invalid},c.prototype.rotationAngle=function(t,e){if(!this.valid||!t.valid)return 0;var r=this.rotationMatrix(t),n=.5*(r[0]+r[4]+r[8]-1),i=Math.acos(n);if(i=isNaN(i)?0:i,void 0!==e){var o=this.rotationAxis(t);i*=s.dot(o,s.normalize(s.create(),e))}return i},c.prototype.rotationAxis=function(t){return this.valid&&t.valid?s.normalize(s.create(),[this._rotation[7]-t._rotation[5],this._rotation[2]-t._rotation[6],this._rotation[3]-t._rotation[1]]):s.create()},c.prototype.rotationMatrix=function(t){if(!this.valid||!t.valid)return a.create();var e=a.transpose(a.create(),this._rotation);return a.multiply(a.create(),t._rotation,e)},c.prototype.scaleFactor=function(t){return this.valid&&t.valid?Math.exp(this._scaleFactor-t._scaleFactor):1},c.prototype.translation=function(t){return this.valid&&t.valid?s.subtract(s.create(),this._translation,t._translation):s.create()},c.prototype.toString=function(){var t="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";return this.gestures&&(t+=" | Gesture count:("+this.gestures.length+")"),t+=" ]"},c.prototype.dump=function(){var t="";t+="Frame Info:<br/>",t+=this.toString(),t+="<br/><br/>Hands:<br/>";for(var e=0,r=this.hands.length;e!=r;e++)t+="  "+this.hands[e].toString()+"<br/>";t+="<br/><br/>Pointables:<br/>";for(var n=0,i=this.pointables.length;n!=i;n++)t+="  "+this.pointables[n].toString()+"<br/>";if(this.gestures){t+="<br/><br/>Gestures:<br/>";for(var o=0,a=this.gestures.length;o!=a;o++)t+="  "+this.gestures[o].toString()+"<br/>"}return t+="<br/><br/>Raw JSON:<br/>",t+=JSON.stringify(this.data)},c.Invalid={valid:!1,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return n.Invalid},finger:function(){return n.Invalid},hand:function(){return r.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return a.create()},rotationAxis:function(){return s.create()},scaleFactor:function(){return 1},translation:function(){return s.create()}}},{"./gesture":6,"./hand":7,"./interaction_box":9,"./pointable":11,"gl-matrix":19,underscore:20}],6:[function(t,e,r){var n=t("gl-matrix"),i=(n.vec3,t("events").EventEmitter),o=t("underscore");r.createGesture=function(t){var e;switch(t.type){case"circle":e=new s(t);break;case"swipe":e=new h(t);break;case"screenTap":e=new u(t);break;case"keyTap":e=new c(t);break;default:throw"unkown gesture type"}return e.id=t.id,e.handIds=t.handIds,e.pointableIds=t.pointableIds,e.duration=t.duration,e.state=t.state,e.type=t.type,e},r.gestureListener=function(t,e){var r={},n={};t.on("gesture",function(t,i){if(t.type==e){if(("start"==t.state||"stop"==t.state)&&void 0===n[t.id]){var s=new a(t,i);n[t.id]=s,o.each(r,function(t,e){s.on(e,t)})}n[t.id].update(t,i),"stop"==t.state&&delete n[t.id]}});var i={start:function(t){return r.start=t,i},stop:function(t){return r.stop=t,i},complete:function(t){return r.stop=t,i},update:function(t){return r.update=t,i}};return i};var a=r.Gesture=function(t,e){this.gestures=[t],this.frames=[e]};a.prototype.update=function(t,e){this.gestures.push(t),this.frames.push(e),this.emit(t.state,this)},o.extend(a.prototype,i.prototype);var s=function(t){this.center=t.center,this.normal=t.normal,this.progress=t.progress,this.radius=t.radius};s.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var h=function(t){this.startPosition=t.startPosition,this.position=t.position,this.direction=t.direction,this.speed=t.speed};h.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var u=function(t){this.position=t.position,this.direction=t.direction,this.progress=t.progress};u.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var c=function(t){this.position=t.position,this.direction=t.direction,this.progress=t.progress};c.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+"]"}},{events:17,"gl-matrix":19,underscore:20}],7:[function(t,e){var r=t("./pointable"),n=t("gl-matrix"),i=n.mat3,o=n.vec3,a=t("underscore"),s=e.exports=function(t){this.id=t.id,this.palmPosition=t.palmPosition,this.direction=t.direction,this.palmVelocity=t.palmVelocity,this.palmNormal=t.palmNormal,this.sphereCenter=t.sphereCenter,this.sphereRadius=t.sphereRadius,this.valid=!0,this.pointables=[],this.fingers=[],this.tools=[],this._translation=t.t,this._rotation=a.flatten(t.r),this._scaleFactor=t.s,this.timeVisible=t.timeVisible,this.stabilizedPalmPosition=t.stabilizedPalmPosition};s.prototype.finger=function(t){var e=this.frame.finger(t);return e&&e.handId==this.id?e:r.Invalid},s.prototype.rotationAngle=function(t,e){if(!this.valid||!t.valid)return 0;var r=t.hand(this.id);if(!r.valid)return 0;var n=this.rotationMatrix(t),i=.5*(n[0]+n[4]+n[8]-1),a=Math.acos(i);if(a=isNaN(a)?0:a,void 0!==e){var s=this.rotationAxis(t);a*=o.dot(s,o.normalize(o.create(),e))}return a},s.prototype.rotationAxis=function(t){if(!this.valid||!t.valid)return o.create();var e=t.hand(this.id);return e.valid?o.normalize(o.create(),[this._rotation[7]-e._rotation[5],this._rotation[2]-e._rotation[6],this._rotation[3]-e._rotation[1]]):o.create()},s.prototype.rotationMatrix=function(t){if(!this.valid||!t.valid)return i.create();var e=t.hand(this.id);if(!e.valid)return i.create();var r=i.transpose(i.create(),this._rotation),n=i.multiply(i.create(),e._rotation,r);return n},s.prototype.scaleFactor=function(t){if(!this.valid||!t.valid)return 1;var e=t.hand(this.id);return e.valid?Math.exp(this._scaleFactor-e._scaleFactor):1},s.prototype.translation=function(t){if(!this.valid||!t.valid)return o.create();var e=t.hand(this.id);return e.valid?[this._translation[0]-e._translation[0],this._translation[1]-e._translation[1],this._translation[2]-e._translation[2]]:o.create()},s.prototype.toString=function(){return"Hand [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "},s.Invalid={valid:!1,fingers:[],tools:[],pointables:[],pointable:function(){return r.Invalid},finger:function(){return r.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return i.create()},rotationAxis:function(){return o.create()},scaleFactor:function(){return 1},translation:function(){return o.create()}}},{"./pointable":11,"gl-matrix":19,underscore:20}],8:[function(t,e){!function(){e.exports={Controller:t("./controller"),Frame:t("./frame"),Gesture:t("./gesture"),Hand:t("./hand"),Pointable:t("./pointable"),InteractionBox:t("./interaction_box"),Connection:t("./connection"),CircularBuffer:t("./circular_buffer"),UI:t("./ui"),glMatrix:t("gl-matrix"),mat3:t("gl-matrix").mat3,vec3:t("gl-matrix").vec3,loopController:void 0,loop:function(t,e){void 0===e&&(e=t,t={}),this.loopController||(this.loopController=new this.Controller(t)),this.loopController.loop(e)}}}()},{"./circular_buffer":2,"./connection":3,"./controller":4,"./frame":5,"./gesture":6,"./hand":7,"./interaction_box":9,"./pointable":11,"./ui":13,"gl-matrix":19}],9:[function(t,e){var r=t("gl-matrix"),n=r.vec3,i=e.exports=function(t){this.valid=!0,this.center=t.center,this.size=t.size,this.width=t.size[0],this.height=t.size[1],this.depth=t.size[2]};i.prototype.denormalizePoint=function(t){return n.fromValues((t[0]-.5)*this.size[0]+this.center[0],(t[1]-.5)*this.size[1]+this.center[1],(t[2]-.5)*this.size[2]+this.center[2])},i.prototype.normalizePoint=function(t,e){var r=n.fromValues((t[0]-this.center[0])/this.size[0]+.5,(t[1]-this.center[1])/this.size[1]+.5,(t[2]-this.center[2])/this.size[2]+.5);return e&&(r[0]=Math.min(Math.max(r[0],0),1),r[1]=Math.min(Math.max(r[1],0),1),r[2]=Math.min(Math.max(r[2],0),1)),r},i.prototype.toString=function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"},i.Invalid={valid:!1}},{"gl-matrix":19}],10:[function(t,e){var r=e.exports=function(){this.steps=[]};r.prototype.addStep=function(t){this.steps.push(t)},r.prototype.run=function(t){for(var e=this.steps.length,r=0;r!=e&&t;r++)t=this.steps[r](t);return t}},{}],11:[function(t,e){var r=t("gl-matrix");r.vec3;var n=e.exports=function(t){this.valid=!0,this.id=t.id,this.handId=t.handId,this.length=t.length,this.tool=t.tool,this.width=t.width,this.direction=t.direction,this.stabilizedTipPosition=t.stabilizedTipPosition,this.tipPosition=t.tipPosition,this.tipVelocity=t.tipVelocity,this.touchZone=t.touchZone,this.touchDistance=t.touchDistance,this.timeVisible=t.timeVisible};n.prototype.toString=function(){return 1==this.tool?"Pointable [ id:"+this.id+" "+this.length+"mmx | with:"+this.width+"mm | direction:"+this.direction+" ]":"Pointable [ id:"+this.id+" "+this.length+"mmx | direction: "+this.direction+" ]"},n.Invalid={valid:!1}},{"gl-matrix":19}],12:[function(t,e,r){var n=t("./frame"),i=function(t){this.type=t.type,this.state=t.state};r.chooseProtocol=function(t){var e;switch(t.version){case 1:e=o(1,function(t){return new n(t)});break;case 2:e=o(2,function(t){return new n(t)}),e.sendHeartbeat=function(t){t.send(e.encode({heartbeat:!0}))};break;case 3:e=o(3,function(t){return t.event?new i(t.event):new n(t)}),e.sendHeartbeat=function(t){t.send(e.encode({heartbeat:!0}))};break;default:throw"unrecognized version"}return e};var o=function(t,e){var r=e;return r.encode=function(t){return JSON.stringify(t)},r.version=t,r.versionLong="Version "+t,r.type="protocol",r}},{"./frame":5}],13:[function(t,e,r){r.UI={Region:t("./ui/region"),Cursor:t("./ui/cursor")}},{"./ui/cursor":14,"./ui/region":15}],14:[function(t,e){e.exports=function(){return function(t){var e=t.pointables.sort(function(t,e){return t.z-e.z})[0];return e&&e.valid&&(t.cursorPosition=e.tipPosition),t}}},{}],15:[function(t,e){var r=t("events").EventEmitter,n=t("underscore"),i=e.exports=function(t,e){this.start=new Vector(t),this.end=new Vector(e),this.enteredFrame=null};i.prototype.hasPointables=function(t){for(var e=0;e!=t.pointables.length;e++){var r=t.pointables[e].tipPosition;if(r.x>=this.start.x&&r.x<=this.end.x&&r.y>=this.start.y&&r.y<=this.end.y&&r.z>=this.start.z&&r.z<=this.end.z)return!0}return!1},i.prototype.listener=function(t){var e=this;return t&&t.nearThreshold&&this.setupNearRegion(t.nearThreshold),function(t){return e.updatePosition(t)}},i.prototype.clipper=function(){var t=this;return function(e){return t.updatePosition(e),t.enteredFrame?e:null}},i.prototype.setupNearRegion=function(t){var e=this.nearRegion=new i([this.start.x-t,this.start.y-t,this.start.z-t],[this.end.x+t,this.end.y+t,this.end.z+t]),r=this;e.on("enter",function(t){r.emit("near",t)}),e.on("exit",function(t){r.emit("far",t)}),r.on("exit",function(t){r.emit("near",t)})},i.prototype.updatePosition=function(t){return this.nearRegion&&this.nearRegion.updatePosition(t),this.hasPointables(t)&&null==this.enteredFrame?(this.enteredFrame=t,this.emit("enter",this.enteredFrame)):this.hasPointables(t)||null==this.enteredFrame||(this.enteredFrame=null,this.emit("exit",this.enteredFrame)),t},i.prototype.normalize=function(t){return new Vector([(t.x-this.start.x)/(this.end.x-this.start.x),(t.y-this.start.y)/(this.end.y-this.start.y),(t.z-this.start.z)/(this.end.z-this.start.z)])},i.prototype.mapToXY=function(t,e,r){var n=this.normalize(t),i=n.x,o=n.y;return i>1?i=1:-1>i&&(i=-1),o>1?o=1:-1>o&&(o=-1),[(i+1)/2*e,(1-o)/2*r,n.z]},n.extend(i.prototype,r.prototype)},{events:17,underscore:20}],16:[function(){},{}],17:[function(t,e,r){!function(t){function e(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0;r<t.length;r++)if(e===t[r])return r;return-1}t.EventEmitter||(t.EventEmitter=function(){});var n=r.EventEmitter=t.EventEmitter,i="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=10;n.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},n.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||i(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"==typeof e){switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var r=Array.prototype.slice.call(arguments,1);e.apply(this,r)}return!0}if(i(e)){for(var r=Array.prototype.slice.call(arguments,1),n=e.slice(),o=0,a=n.length;a>o;o++)n[o].apply(this,r);return!0}return!1},n.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t])if(i(this._events[t])){if(!this._events[t].warned){var r;r=void 0!==this._events.maxListeners?this._events.maxListeners:o,r&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}this._events[t].push(e)}else this._events[t]=[this._events[t],e];else this._events[t]=e;return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){var r=this;return r.on(t,function n(){r.removeListener(t,n),e.apply(this,arguments)}),this},n.prototype.removeListener=function(t,r){if("function"!=typeof r)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var n=this._events[t];if(i(n)){var o=e(n,r);if(0>o)return this;n.splice(o,1),0==n.length&&delete this._events[t]}else this._events[t]===r&&delete this._events[t];return this},n.prototype.removeAllListeners=function(t){return 0===arguments.length?(this._events={},this):(t&&this._events&&this._events[t]&&(this._events[t]=null),this)},n.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),i(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}(t("__browserify_process"))},{__browserify_process:18}],18:[function(t,e){var r=e.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var r=[];return window.addEventListener("message",function(t){if(t.source===window&&"process-tick"===t.data&&(t.stopPropagation(),r.length>0)){var e=r.shift();e()}},!0),function(t){r.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)
}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")}},{}],19:[function(t,e,r){!function(){!function(){var t={};"undefined"==typeof r?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define("Leap",[],function(){return t.exports})):t.exports=window:t.exports=r,function(t){var e={};if(!r)var r=1e-6;e.create=function(){return new Float32Array(2)},e.clone=function(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var r=new Float32Array(2);return r[0]=t,r[1]=e,r},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,r){return t[0]=e,t[1]=r,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},e.sub=e.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},e.mul=e.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},e.div=e.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},e.dist=e.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)},e.sqrDist=e.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n},e.len=e.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},e.sqrLen=e.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.normalize=function(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},e.lerp=function(t,e,r,n){var i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t},e.transformMat2=function(t,e,r){var n=e[0],i=e[1];return t[0]=n*r[0]+i*r[1],t[1]=n*r[2]+i*r[3],t},e.forEach=function(){var t=new Float32Array(2);return function(e,r,n,i,o,a){var s,h;for(r||(r=2),n||(n=0),h=i?Math.min(i*r+n,e.length):e.length,s=n;h>s;s+=r)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=e);var n={};if(!r)var r=1e-6;n.create=function(){return new Float32Array(3)},n.clone=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.fromValues=function(t,e,r){var n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=r,n},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},n.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},n.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},n.sub=n.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},n.mul=n.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},n.div=n.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},n.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},n.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},n.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},n.dist=n.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)},n.sqrDist=n.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i},n.len=n.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},n.sqrLen=n.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},n.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},n.cross=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],h=r[2];return t[0]=i*h-o*s,t[1]=o*a-n*h,t[2]=n*s-i*a,t},n.lerp=function(t,e,r,n){var i=e[0],o=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t},n.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12],t[1]=r[1]*n+r[5]*i+r[9]*o+r[13],t[2]=r[2]*n+r[6]*i+r[10]*o+r[14],t},n.transformQuat=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],h=r[2],u=r[3],c=u*n+s*o-h*i,l=u*i+h*n-a*o,d=u*o+a*i-s*n,f=-a*n-s*i-h*o;return t[0]=c*u+f*-a+l*-h-d*-s,t[1]=l*u+f*-s+d*-a-c*-h,t[2]=d*u+f*-h+c*-s-l*-a,t},n.forEach=function(){var t=new Float32Array(3);return function(e,r,n,i,o,a){var s,h;for(r||(r=3),n||(n=0),h=i?Math.min(i*r+n,e.length):e.length,s=n;h>s;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),n.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=n);var i={};if(!r)var r=1e-6;i.create=function(){return new Float32Array(4)},i.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},i.fromValues=function(t,e,r,n){var i=new Float32Array(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},i.set=function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},i.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},i.sub=i.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},i.mul=i.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},i.div=i.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},i.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},i.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},i.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},i.dist=i.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+o*o)},i.sqrDist=i.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+i*i+o*o},i.len=i.length=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)},i.sqrLen=i.squaredLength=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i},i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},i.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},i.lerp=function(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t[3]=s+n*(r[3]-s),t},i.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t},i.transformQuat=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],h=r[2],u=r[3],c=u*n+s*o-h*i,l=u*i+h*n-a*o,d=u*o+a*i-s*n,f=-a*n-s*i-h*o;return t[0]=c*u+f*-a+l*-h-d*-s,t[1]=l*u+f*-s+d*-a-c*-h,t[2]=d*u+f*-h+c*-s-l*-a,t},i.forEach=function(){var t=new Float32Array(4);return function(e,r,n,i,o,a){var s,h;for(r||(r=4),n||(n=0),h=i?Math.min(i*r+n,e.length):e.length,s=n;h>s;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),i.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=i);var o={},a=new Float32Array([1,0,0,1]);if(!r)var r=1e-6;o.create=function(){return new Float32Array(a)},o.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},o.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},o.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*o-i*n;return a?(a=1/a,t[0]=o*a,t[1]=-n*a,t[2]=-i*a,t[3]=r*a,t):null},o.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},o.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},o.mul=o.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],h=r[1],u=r[2],c=r[3];return t[0]=n*s+i*u,t[1]=n*h+i*c,t[2]=o*s+a*u,t[3]=o*h+a*c,t},o.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),h=Math.cos(r);return t[0]=n*h+i*s,t[1]=n*-s+i*h,t[2]=o*h+a*s,t[3]=o*-s+a*h,t},o.scale=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],h=r[1];return t[0]=n*s,t[1]=i*h,t[2]=o*s,t[3]=a*h,t},o.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.mat2=o);var s={},h=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!r)var r=1e-6;s.create=function(){return new Float32Array(h)},s.clone=function(t){var e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},s.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=c*a-s*u,d=-c*o+s*h,f=u*o-a*h,p=r*l+n*d+i*f;return p?(p=1/p,t[0]=l*p,t[1]=(-c*n+i*u)*p,t[2]=(s*n-i*a)*p,t[3]=d*p,t[4]=(c*r-i*h)*p,t[5]=(-s*r+i*o)*p,t[6]=f*p,t[7]=(-u*r+n*h)*p,t[8]=(a*r-n*o)*p,t):null},s.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8];return t[0]=a*c-s*u,t[1]=i*u-n*c,t[2]=n*s-i*a,t[3]=s*h-o*c,t[4]=r*c-i*h,t[5]=i*o-r*s,t[6]=o*u-a*h,t[7]=n*h-r*u,t[8]=r*a-n*o,t},s.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],h=t[7],u=t[8];return e*(u*o-a*h)+r*(-u*i+a*s)+n*(h*i-o*s)},s.mul=s.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=r[0],f=r[1],p=r[2],m=r[3],v=r[4],g=r[5],b=r[6],x=r[7],y=r[8];return t[0]=d*n+f*a+p*u,t[1]=d*i+f*s+p*c,t[2]=d*o+f*h+p*l,t[3]=m*n+v*a+g*u,t[4]=m*i+v*s+g*c,t[5]=m*o+v*h+g*l,t[6]=b*n+x*a+y*u,t[7]=b*i+x*s+y*c,t[8]=b*o+x*h+y*l,t},s.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},"undefined"!=typeof t&&(t.mat3=s);var u={},c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!r)var r=1e-6;u.create=function(){return new Float32Array(c)},u.clone=function(t){var e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},u.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},u.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],p=e[12],m=e[13],v=e[14],g=e[15],b=r*s-n*a,x=r*h-i*a,y=r*u-o*a,w=n*h-i*s,T=n*u-o*s,_=i*u-o*h,A=c*m-l*p,R=c*v-d*p,S=c*g-f*p,E=l*v-d*m,C=l*g-f*m,L=d*g-f*v,F=b*L-x*C+y*E+w*S-T*R+_*A;return F?(F=1/F,t[0]=(s*L-h*C+u*E)*F,t[1]=(i*C-n*L-o*E)*F,t[2]=(m*_-v*T+g*w)*F,t[3]=(d*T-l*_-f*w)*F,t[4]=(h*S-a*L-u*R)*F,t[5]=(r*L-i*S+o*R)*F,t[6]=(v*y-p*_-g*x)*F,t[7]=(c*_-d*y+f*x)*F,t[8]=(a*C-s*S+u*A)*F,t[9]=(n*S-r*C-o*A)*F,t[10]=(p*T-m*y+g*b)*F,t[11]=(l*y-c*T-f*b)*F,t[12]=(s*R-a*E-h*A)*F,t[13]=(r*E-n*R+i*A)*F,t[14]=(m*x-p*w-v*b)*F,t[15]=(c*w-l*x+d*b)*F,t):null},u.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],p=e[12],m=e[13],v=e[14],g=e[15];return t[0]=s*(d*g-f*v)-l*(h*g-u*v)+m*(h*f-u*d),t[1]=-(n*(d*g-f*v)-l*(i*g-o*v)+m*(i*f-o*d)),t[2]=n*(h*g-u*v)-s*(i*g-o*v)+m*(i*u-o*h),t[3]=-(n*(h*f-u*d)-s*(i*f-o*d)+l*(i*u-o*h)),t[4]=-(a*(d*g-f*v)-c*(h*g-u*v)+p*(h*f-u*d)),t[5]=r*(d*g-f*v)-c*(i*g-o*v)+p*(i*f-o*d),t[6]=-(r*(h*g-u*v)-a*(i*g-o*v)+p*(i*u-o*h)),t[7]=r*(h*f-u*d)-a*(i*f-o*d)+c*(i*u-o*h),t[8]=a*(l*g-f*m)-c*(s*g-u*m)+p*(s*f-u*l),t[9]=-(r*(l*g-f*m)-c*(n*g-o*m)+p*(n*f-o*l)),t[10]=r*(s*g-u*m)-a*(n*g-o*m)+p*(n*u-o*s),t[11]=-(r*(s*f-u*l)-a*(n*f-o*l)+c*(n*u-o*s)),t[12]=-(a*(l*v-d*m)-c*(s*v-h*m)+p*(s*d-h*l)),t[13]=r*(l*v-d*m)-c*(n*v-i*m)+p*(n*d-i*l),t[14]=-(r*(s*v-h*m)-a*(n*v-i*m)+p*(n*h-i*s)),t[15]=r*(s*d-h*l)-a*(n*d-i*l)+c*(n*h-i*s),t},u.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],h=t[7],u=t[8],c=t[9],l=t[10],d=t[11],f=t[12],p=t[13],m=t[14],v=t[15],g=e*a-r*o,b=e*s-n*o,x=e*h-i*o,y=r*s-n*a,w=r*h-i*a,T=n*h-i*s,_=u*p-c*f,A=u*m-l*f,R=u*v-d*f,S=c*m-l*p,E=c*v-d*p,C=l*v-d*m;return g*C-b*E+x*S+y*R-w*A+T*_},u.mul=u.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],f=e[10],p=e[11],m=e[12],v=e[13],g=e[14],b=e[15],x=r[0],y=r[1],w=r[2],T=r[3];return t[0]=x*n+y*s+w*l+T*m,t[1]=x*i+y*h+w*d+T*v,t[2]=x*o+y*u+w*f+T*g,t[3]=x*a+y*c+w*p+T*b,x=r[4],y=r[5],w=r[6],T=r[7],t[4]=x*n+y*s+w*l+T*m,t[5]=x*i+y*h+w*d+T*v,t[6]=x*o+y*u+w*f+T*g,t[7]=x*a+y*c+w*p+T*b,x=r[8],y=r[9],w=r[10],T=r[11],t[8]=x*n+y*s+w*l+T*m,t[9]=x*i+y*h+w*d+T*v,t[10]=x*o+y*u+w*f+T*g,t[11]=x*a+y*c+w*p+T*b,x=r[12],y=r[13],w=r[14],T=r[15],t[12]=x*n+y*s+w*l+T*m,t[13]=x*i+y*h+w*d+T*v,t[14]=x*o+y*u+w*f+T*g,t[15]=x*a+y*c+w*p+T*b,t},u.translate=function(t,e,r){var n,i,o,a,s,h,u,c,l,d,f,p,m=r[0],v=r[1],g=r[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*g+e[12],t[13]=e[1]*m+e[5]*v+e[9]*g+e[13],t[14]=e[2]*m+e[6]*v+e[10]*g+e[14],t[15]=e[3]*m+e[7]*v+e[11]*g+e[15]):(n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],f=e[10],p=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=d,t[10]=f,t[11]=p,t[12]=n*m+s*v+l*g+e[12],t[13]=i*m+h*v+d*g+e[13],t[14]=o*m+u*v+f*g+e[14],t[15]=a*m+c*v+p*g+e[15]),t},u.scale=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.rotate=function(t,e,n,i){var o,a,s,h,u,c,l,d,f,p,m,v,g,b,x,y,w,T,_,A,R,S,E,C,L=i[0],F=i[1],M=i[2],B=Math.sqrt(L*L+F*F+M*M);return Math.abs(B)<r?null:(B=1/B,L*=B,F*=B,M*=B,o=Math.sin(n),a=Math.cos(n),s=1-a,h=e[0],u=e[1],c=e[2],l=e[3],d=e[4],f=e[5],p=e[6],m=e[7],v=e[8],g=e[9],b=e[10],x=e[11],y=L*L*s+a,w=F*L*s+M*o,T=M*L*s-F*o,_=L*F*s-M*o,A=F*F*s+a,R=M*F*s+L*o,S=L*M*s+F*o,E=F*M*s-L*o,C=M*M*s+a,t[0]=h*y+d*w+v*T,t[1]=u*y+f*w+g*T,t[2]=c*y+p*w+b*T,t[3]=l*y+m*w+x*T,t[4]=h*_+d*A+v*R,t[5]=u*_+f*A+g*R,t[6]=c*_+p*A+b*R,t[7]=l*_+m*A+x*R,t[8]=h*S+d*E+v*C,t[9]=u*S+f*E+g*C,t[10]=c*S+p*E+b*C,t[11]=l*S+m*E+x*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},u.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],h=e[7],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*n,t[5]=a*i+c*n,t[6]=s*i+l*n,t[7]=h*i+d*n,t[8]=u*i-o*n,t[9]=c*i-a*n,t[10]=l*i-s*n,t[11]=d*i-h*n,t},u.rotateY=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],h=e[3],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-u*n,t[1]=a*i-c*n,t[2]=s*i-l*n,t[3]=h*i-d*n,t[8]=o*n+u*i,t[9]=a*n+c*i,t[10]=s*n+l*i,t[11]=h*n+d*i,t},u.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],h=e[3],u=e[4],c=e[5],l=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*n,t[1]=a*i+c*n,t[2]=s*i+l*n,t[3]=h*i+d*n,t[4]=u*i-o*n,t[5]=c*i-a*n,t[6]=l*i-s*n,t[7]=d*i-h*n,t},u.fromRotationTranslation=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,h=i+i,u=o+o,c=n*s,l=n*h,d=n*u,f=i*h,p=i*u,m=o*u,v=a*s,g=a*h,b=a*u;return t[0]=1-(f+m),t[1]=l+b,t[2]=d-g,t[3]=0,t[4]=l-b,t[5]=1-(c+m),t[6]=p+v,t[7]=0,t[8]=d+g,t[9]=p-v,t[10]=1-(c+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},u.frustum=function(t,e,r,n,i,o,a){var s=1/(r-e),h=1/(i-n),u=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*h,t[10]=(a+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*o*u,t[15]=0,t},u.perspective=function(t,e,r,n,i){var o=1/Math.tan(e/2),a=1/(n-i);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*a,t[15]=0,t},u.ortho=function(t,e,r,n,i,o,a){var s=1/(e-r),h=1/(n-i),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*h,t[14]=(a+o)*u,t[15]=1,t},u.lookAt=function(t,e,n,i){var o,a,s,h,c,l,d,f,p,m,v=e[0],g=e[1],b=e[2],x=i[0],y=i[1],w=i[2],T=n[0],_=n[1],A=n[2];return Math.abs(v-T)<r&&Math.abs(g-_)<r&&Math.abs(b-A)<r?u.identity(t):(d=v-T,f=g-_,p=b-A,m=1/Math.sqrt(d*d+f*f+p*p),d*=m,f*=m,p*=m,o=y*p-w*f,a=w*d-x*p,s=x*f-y*d,m=Math.sqrt(o*o+a*a+s*s),m?(m=1/m,o*=m,a*=m,s*=m):(o=0,a=0,s=0),h=f*s-p*a,c=p*o-d*s,l=d*a-f*o,m=Math.sqrt(h*h+c*c+l*l),m?(m=1/m,h*=m,c*=m,l*=m):(h=0,c=0,l=0),t[0]=o,t[1]=h,t[2]=d,t[3]=0,t[4]=a,t[5]=c,t[6]=f,t[7]=0,t[8]=s,t[9]=l,t[10]=p,t[11]=0,t[12]=-(o*v+a*g+s*b),t[13]=-(h*v+c*g+l*b),t[14]=-(d*v+f*g+p*b),t[15]=1,t)},u.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},"undefined"!=typeof t&&(t.mat4=u);var l={},d=new Float32Array([0,0,0,1]);if(!r)var r=1e-6;l.create=function(){return new Float32Array(d)},l.clone=i.clone,l.fromValues=i.fromValues,l.copy=i.copy,l.set=i.set,l.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},l.setAxisAngle=function(t,e,r){r=.5*r;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},l.add=i.add,l.mul=l.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],h=r[1],u=r[2],c=r[3];return t[0]=n*c+a*s+i*u-o*h,t[1]=i*c+a*h+o*s-n*u,t[2]=o*c+a*u+n*h-i*s,t[3]=a*c-n*s-i*h-o*u,t},l.scale=i.scale,l.rotateX=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),h=Math.cos(r);return t[0]=n*h+a*s,t[1]=i*h+o*s,t[2]=o*h-i*s,t[3]=a*h-n*s,t},l.rotateY=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),h=Math.cos(r);return t[0]=n*h-o*s,t[1]=i*h+a*s,t[2]=o*h+n*s,t[3]=a*h-i*s,t},l.rotateZ=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),h=Math.cos(r);return t[0]=n*h+i*s,t[1]=i*h-n*s,t[2]=o*h+a*s,t[3]=a*h-o*s,t},l.calculateW=function(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t},l.dot=i.dot,l.lerp=i.lerp,l.slerp=function(t,e,r,n){var i,o,a,s,h=e[0],u=e[1],c=e[2],l=e[3],d=r[0],f=r[1],p=r[2],m=e[3],v=h*d+u*f+c*p+l*m;return Math.abs(v)>=1?(t!==e&&(t[0]=h,t[1]=u,t[2]=c,t[3]=l),t):(i=Math.acos(v),o=Math.sqrt(1-v*v),Math.abs(o)<.001?(t[0]=.5*h+.5*d,t[1]=.5*u+.5*f,t[2]=.5*c+.5*p,t[3]=.5*l+.5*m,t):(a=Math.sin((1-n)*i)/o,s=Math.sin(n*i)/o,t[0]=h*a+d*s,t[1]=u*a+f*s,t[2]=c*a+p*s,t[3]=l*a+m*s,t))},l.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o,s=a?1/a:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=o*s,t},l.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},l.len=l.length=i.length,l.sqrLen=l.squaredLength=i.squaredLength,l.normalize=i.normalize,l.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=l)}(t.exports)}()}()},{}],20:[function(t,e,r){!function(){!function(){var t=this,n=t._,i={},o=Array.prototype,a=Object.prototype,s=Function.prototype,h=o.push,u=o.slice,c=o.concat,l=a.toString,d=a.hasOwnProperty,f=o.forEach,p=o.map,m=o.reduce,v=o.reduceRight,g=o.filter,b=o.every,x=o.some,y=o.indexOf,w=o.lastIndexOf,T=Array.isArray,_=Object.keys,A=s.bind,R=function(t){return t instanceof R?t:this instanceof R?(this._wrapped=t,void 0):new R(t)};"undefined"!=typeof r?("undefined"!=typeof e&&e.exports&&(r=e.exports=R),r._=R):t._=R,R.VERSION="1.4.4";var S=R.each=R.forEach=function(t,e,r){if(null!=t)if(f&&t.forEach===f)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,o=t.length;o>n;n++)if(e.call(r,t[n],n,t)===i)return}else for(var a in t)if(R.has(t,a)&&e.call(r,t[a],a,t)===i)return};R.map=R.collect=function(t,e,r){var n=[];return null==t?n:p&&t.map===p?t.map(e,r):(S(t,function(t,i,o){n[n.length]=e.call(r,t,i,o)}),n)};var E="Reduce of empty array with no initial value";R.reduce=R.foldl=R.inject=function(t,e,r,n){var i=arguments.length>2;if(null==t&&(t=[]),m&&t.reduce===m)return n&&(e=R.bind(e,n)),i?t.reduce(e,r):t.reduce(e);if(S(t,function(t,o,a){i?r=e.call(n,r,t,o,a):(r=t,i=!0)}),!i)throw new TypeError(E);return r},R.reduceRight=R.foldr=function(t,e,r,n){var i=arguments.length>2;if(null==t&&(t=[]),v&&t.reduceRight===v)return n&&(e=R.bind(e,n)),i?t.reduceRight(e,r):t.reduceRight(e);var o=t.length;if(o!==+o){var a=R.keys(t);o=a.length}if(S(t,function(s,h,u){h=a?a[--o]:--o,i?r=e.call(n,r,t[h],h,u):(r=t[h],i=!0)}),!i)throw new TypeError(E);return r},R.find=R.detect=function(t,e,r){var n;return C(t,function(t,i,o){return e.call(r,t,i,o)?(n=t,!0):void 0}),n},R.filter=R.select=function(t,e,r){var n=[];return null==t?n:g&&t.filter===g?t.filter(e,r):(S(t,function(t,i,o){e.call(r,t,i,o)&&(n[n.length]=t)}),n)},R.reject=function(t,e,r){return R.filter(t,function(t,n,i){return!e.call(r,t,n,i)},r)},R.every=R.all=function(t,e,r){e||(e=R.identity);var n=!0;return null==t?n:b&&t.every===b?t.every(e,r):(S(t,function(t,o,a){return(n=n&&e.call(r,t,o,a))?void 0:i}),!!n)};var C=R.some=R.any=function(t,e,r){e||(e=R.identity);var n=!1;return null==t?n:x&&t.some===x?t.some(e,r):(S(t,function(t,o,a){return n||(n=e.call(r,t,o,a))?i:void 0}),!!n)};R.contains=R.include=function(t,e){return null==t?!1:y&&t.indexOf===y?-1!=t.indexOf(e):C(t,function(t){return t===e})},R.invoke=function(t,e){var r=u.call(arguments,2),n=R.isFunction(e);return R.map(t,function(t){return(n?e:t[e]).apply(t,r)})},R.pluck=function(t,e){return R.map(t,function(t){return t[e]})},R.where=function(t,e,r){return R.isEmpty(e)?r?null:[]:R[r?"find":"filter"](t,function(t){for(var r in e)if(e[r]!==t[r])return!1;return!0})},R.findWhere=function(t,e){return R.where(t,e,!0)},R.max=function(t,e,r){if(!e&&R.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&R.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return S(t,function(t,i,o){var a=e?e.call(r,t,i,o):t;a>=n.computed&&(n={value:t,computed:a})}),n.value},R.min=function(t,e,r){if(!e&&R.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&R.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return S(t,function(t,i,o){var a=e?e.call(r,t,i,o):t;a<n.computed&&(n={value:t,computed:a})}),n.value},R.shuffle=function(t){var e,r=0,n=[];return S(t,function(t){e=R.random(r++),n[r-1]=n[e],n[e]=t}),n};var L=function(t){return R.isFunction(t)?t:function(e){return e[t]}};R.sortBy=function(t,e,r){var n=L(e);return R.pluck(R.map(t,function(t,e,i){return{value:t,index:e,criteria:n.call(r,t,e,i)}}).sort(function(t,e){var r=t.criteria,n=e.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(n>r||void 0===n)return-1}return t.index<e.index?-1:1}),"value")};var F=function(t,e,r,n){var i={},o=L(e||R.identity);return S(t,function(e,a){var s=o.call(r,e,a,t);n(i,s,e)}),i};R.groupBy=function(t,e,r){return F(t,e,r,function(t,e,r){(R.has(t,e)?t[e]:t[e]=[]).push(r)})},R.countBy=function(t,e,r){return F(t,e,r,function(t,e){R.has(t,e)||(t[e]=0),t[e]++})},R.sortedIndex=function(t,e,r,n){r=null==r?R.identity:L(r);for(var i=r.call(n,e),o=0,a=t.length;a>o;){var s=o+a>>>1;r.call(n,t[s])<i?o=s+1:a=s}return o},R.toArray=function(t){return t?R.isArray(t)?u.call(t):t.length===+t.length?R.map(t,R.identity):R.values(t):[]},R.size=function(t){return null==t?0:t.length===+t.length?t.length:R.keys(t).length},R.first=R.head=R.take=function(t,e,r){return null==t?void 0:null==e||r?t[0]:u.call(t,0,e)},R.initial=function(t,e,r){return u.call(t,0,t.length-(null==e||r?1:e))},R.last=function(t,e,r){return null==t?void 0:null==e||r?t[t.length-1]:u.call(t,Math.max(t.length-e,0))},R.rest=R.tail=R.drop=function(t,e,r){return u.call(t,null==e||r?1:e)},R.compact=function(t){return R.filter(t,R.identity)};var M=function(t,e,r){return S(t,function(t){R.isArray(t)?e?h.apply(r,t):M(t,e,r):r.push(t)}),r};R.flatten=function(t,e){return M(t,e,[])},R.without=function(t){return R.difference(t,u.call(arguments,1))},R.uniq=R.unique=function(t,e,r,n){R.isFunction(e)&&(n=r,r=e,e=!1);var i=r?R.map(t,r,n):t,o=[],a=[];return S(i,function(r,n){(e?n&&a[a.length-1]===r:R.contains(a,r))||(a.push(r),o.push(t[n]))}),o},R.union=function(){return R.uniq(c.apply(o,arguments))},R.intersection=function(t){var e=u.call(arguments,1);return R.filter(R.uniq(t),function(t){return R.every(e,function(e){return R.indexOf(e,t)>=0})})},R.difference=function(t){var e=c.apply(o,u.call(arguments,1));return R.filter(t,function(t){return!R.contains(e,t)})},R.zip=function(){for(var t=u.call(arguments),e=R.max(R.pluck(t,"length")),r=new Array(e),n=0;e>n;n++)r[n]=R.pluck(t,""+n);return r},R.object=function(t,e){if(null==t)return{};for(var r={},n=0,i=t.length;i>n;n++)e?r[t[n]]=e[n]:r[t[n][0]]=t[n][1];return r},R.indexOf=function(t,e,r){if(null==t)return-1;var n=0,i=t.length;if(r){if("number"!=typeof r)return n=R.sortedIndex(t,e),t[n]===e?n:-1;n=0>r?Math.max(0,i+r):r}if(y&&t.indexOf===y)return t.indexOf(e,r);for(;i>n;n++)if(t[n]===e)return n;return-1},R.lastIndexOf=function(t,e,r){if(null==t)return-1;var n=null!=r;if(w&&t.lastIndexOf===w)return n?t.lastIndexOf(e,r):t.lastIndexOf(e);for(var i=n?r:t.length;i--;)if(t[i]===e)return i;return-1},R.range=function(t,e,r){arguments.length<=1&&(e=t||0,t=0),r=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/r),0),i=0,o=new Array(n);n>i;)o[i++]=t,t+=r;return o},R.bind=function(t,e){if(t.bind===A&&A)return A.apply(t,u.call(arguments,1));var r=u.call(arguments,2);return function(){return t.apply(e,r.concat(u.call(arguments)))}},R.partial=function(t){var e=u.call(arguments,1);return function(){return t.apply(this,e.concat(u.call(arguments)))}},R.bindAll=function(t){var e=u.call(arguments,1);return 0===e.length&&(e=R.functions(t)),S(e,function(e){t[e]=R.bind(t[e],t)}),t},R.memoize=function(t,e){var r={};return e||(e=R.identity),function(){var n=e.apply(this,arguments);return R.has(r,n)?r[n]:r[n]=t.apply(this,arguments)}},R.delay=function(t,e){var r=u.call(arguments,2);return setTimeout(function(){return t.apply(null,r)},e)},R.defer=function(t){return R.delay.apply(R,[t,1].concat(u.call(arguments,1)))},R.throttle=function(t,e){var r,n,i,o,a=0,s=function(){a=new Date,i=null,o=t.apply(r,n)};return function(){var h=new Date,u=e-(h-a);return r=this,n=arguments,0>=u?(clearTimeout(i),i=null,a=h,o=t.apply(r,n)):i||(i=setTimeout(s,u)),o}},R.debounce=function(t,e,r){var n,i;return function(){var o=this,a=arguments,s=function(){n=null,r||(i=t.apply(o,a))},h=r&&!n;return clearTimeout(n),n=setTimeout(s,e),h&&(i=t.apply(o,a)),i}},R.once=function(t){var e,r=!1;return function(){return r?e:(r=!0,e=t.apply(this,arguments),t=null,e)}},R.wrap=function(t,e){return function(){var r=[t];return h.apply(r,arguments),e.apply(this,r)}},R.compose=function(){var t=arguments;return function(){for(var e=arguments,r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},R.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},R.keys=_||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var r in t)R.has(t,r)&&(e[e.length]=r);return e},R.values=function(t){var e=[];for(var r in t)R.has(t,r)&&e.push(t[r]);return e},R.pairs=function(t){var e=[];for(var r in t)R.has(t,r)&&e.push([r,t[r]]);return e},R.invert=function(t){var e={};for(var r in t)R.has(t,r)&&(e[t[r]]=r);return e},R.functions=R.methods=function(t){var e=[];for(var r in t)R.isFunction(t[r])&&e.push(r);return e.sort()},R.extend=function(t){return S(u.call(arguments,1),function(e){if(e)for(var r in e)t[r]=e[r]}),t},R.pick=function(t){var e={},r=c.apply(o,u.call(arguments,1));return S(r,function(r){r in t&&(e[r]=t[r])}),e},R.omit=function(t){var e={},r=c.apply(o,u.call(arguments,1));for(var n in t)R.contains(r,n)||(e[n]=t[n]);return e},R.defaults=function(t){return S(u.call(arguments,1),function(e){if(e)for(var r in e)null==t[r]&&(t[r]=e[r])}),t},R.clone=function(t){return R.isObject(t)?R.isArray(t)?t.slice():R.extend({},t):t},R.tap=function(t,e){return e(t),t};var B=function(t,e,r,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof R&&(t=t._wrapped),e instanceof R&&(e=e._wrapped);var i=l.call(t);if(i!=l.call(e))return!1;switch(i){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=r.length;o--;)if(r[o]==t)return n[o]==e;r.push(t),n.push(e);var a=0,s=!0;if("[object Array]"==i){if(a=t.length,s=a==e.length)for(;a--&&(s=B(t[a],e[a],r,n)););}else{var h=t.constructor,u=e.constructor;if(h!==u&&!(R.isFunction(h)&&h instanceof h&&R.isFunction(u)&&u instanceof u))return!1;for(var c in t)if(R.has(t,c)&&(a++,!(s=R.has(e,c)&&B(t[c],e[c],r,n))))break;if(s){for(c in e)if(R.has(e,c)&&!a--)break;s=!a}}return r.pop(),n.pop(),s};R.isEqual=function(t,e){return B(t,e,[],[])},R.isEmpty=function(t){if(null==t)return!0;if(R.isArray(t)||R.isString(t))return 0===t.length;for(var e in t)if(R.has(t,e))return!1;return!0},R.isElement=function(t){return!(!t||1!==t.nodeType)},R.isArray=T||function(t){return"[object Array]"==l.call(t)},R.isObject=function(t){return t===Object(t)},S(["Arguments","Function","String","Number","Date","RegExp"],function(t){R["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),R.isArguments(arguments)||(R.isArguments=function(t){return!(!t||!R.has(t,"callee"))}),"function"!=typeof/./&&(R.isFunction=function(t){return"function"==typeof t}),R.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},R.isNaN=function(t){return R.isNumber(t)&&t!=+t},R.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},R.isNull=function(t){return null===t},R.isUndefined=function(t){return void 0===t},R.has=function(t,e){return d.call(t,e)},R.noConflict=function(){return t._=n,this},R.identity=function(t){return t},R.times=function(t,e,r){for(var n=Array(t),i=0;t>i;i++)n[i]=e.call(r,i);return n},R.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};I.unescape=R.invert(I.escape);var k={escape:new RegExp("["+R.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+R.keys(I.unescape).join("|")+")","g")};R.each(["escape","unescape"],function(t){R[t]=function(e){return null==e?"":(""+e).replace(k[t],function(e){return I[t][e]
})}}),R.result=function(t,e){if(null==t)return null;var r=t[e];return R.isFunction(r)?r.call(t):r},R.mixin=function(t){S(R.functions(t),function(e){var r=R[e]=t[e];R.prototype[e]=function(){var t=[this._wrapped];return h.apply(t,arguments),U.call(this,r.apply(R,t))}})};var O=0;R.uniqueId=function(t){var e=++O+"";return t?t+e:e},R.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var D=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;R.template=function(t,e,r){var n;r=R.defaults({},r,R.templateSettings);var i=new RegExp([(r.escape||D).source,(r.interpolate||D).source,(r.evaluate||D).source].join("|")+"|$","g"),o=0,a="__p+='";t.replace(i,function(e,r,n,i,s){return a+=t.slice(o,s).replace(j,function(t){return"\\"+P[t]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),n&&(a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),i&&(a+="';\n"+i+"\n__p+='"),o=s+e.length,e}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(r.variable||"obj","_",a)}catch(s){throw s.source=a,s}if(e)return n(e,R);var h=function(t){return n.call(this,t,R)};return h.source="function("+(r.variable||"obj")+"){\n"+a+"}",h},R.chain=function(t){return R(t).chain()};var U=function(t){return this._chain?R(t).chain():t};R.mixin(R),S(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=o[t];R.prototype[t]=function(){var r=this._wrapped;return e.apply(r,arguments),"shift"!=t&&"splice"!=t||0!==r.length||delete r[0],U.call(this,r)}}),S(["concat","join","slice"],function(t){var e=o[t];R.prototype[t]=function(){return U.call(this,e.apply(this._wrapped,arguments))}}),R.extend(R.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this)}()},{}],21:[function(t){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),Leap=t("../lib/index")},{"../lib/index":8}]},{},[21]),define("leapController",["Leap","utils/eventPublisher"],function(t,e){var r=new t.Controller,n=0,i=!1,o=0,a=e(["handFrame","debugInfo"]);return r.on("frame",function(t){var e,r=0;for(void 0===t.hands?i=!1:(o=t.hands.length,i=o>0?!0:!1),handCount=o;r!=handCount;r+=1)e=t.hands[r],a.fire("handFrame",{x:parseInt(e.palmPosition[0],10),y:parseInt(e.palmPosition[1],10),z:parseInt(e.palmPosition[2],10)});n+=1}),setInterval(function(){var t=n/2,e="leap: received "+n+" frames @ "+t+"fps.";a.fire("debugInfo",e),n=0},2e3),console.log("leap: init"),r.connect(),{getHandsAvailable:function(){return i},getHandsLength:function(){return o},events:a}}),define("displayFactory",["PIXI"],function(t){function e(t,e,r){t.position.x=e===!0?e:0,t.position.y=r===!0?r:0}function r(t,e,r){t.anchor.x=e===!0?e:.5,t.anchor.y=r===!0?r:.5}function n(t,e,r){t.width=e===!0?e:800,t.height=r===!0?r:600}function i(n,i,o,a,s){var h=new t.Sprite(n);return e(h,i,o),r(h,a,s),h}function o(e,r){var i=new t.DisplayObjectContainer;return n(i,e,r),i}var a=t.Texture.fromImage("assets/bunny.png");return{makeBunny:function(t,e,r,n){return i(a,t,e,r,n)},makeLayer:function(t,e){return o(t,e)},makeScene:function(t,e){return o(t,e)}}}),define("layers/crosshair",["displayController","displayConfig","leapController","displayFactory"],function(t,e,r,n){function i(){l||(f.addChild(d),t.events.on("renderFrame",a),t.events.on("renderFrame",s),r.events.on("handFrame",h),l=!0)}function o(){l&&(f.removeChild(d),t.events.remove("renderFrame",a),t.events.remove("renderFrame",s),r.events.remove("handFrame",h),l=!1)}function a(){d.rotation+=.1}function s(){r.getHandsAvailable()===!0?d.alpha<1&&(d.alpha+=.02):d.alpha>.2&&(d.alpha-=.01)}function h(t){d.position.x=u/2+2.5*t.x,d.position.y=4*(c/3)-2*t.y}var u=e.width,c=e.height,l=!1,d=n.makeBunny(),f=n.makeLayer();return{activate:function(){i()},deactivate:function(){o()},getLayer:function(){return f},getRunning:function(){return l}}}),define("scenes/mainScene",["layers/crosshair","displayFactory"],function(t,e){var r=e.makeScene();return r.addChild(t.getLayer()),t.activate(),{getScene:function(){return r},toggleCrosshair:function(){t.getRunning()===!0?t.deactivate():t.activate()}}}),function(t){function e(t,e){for(var r=t.length;r--;)if(t[r]===e)return r;return-1}function r(t,e){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function n(t){for(x in w)w[x]=t[E[x]]}function i(t,r){var i,o,a,h,u;if(i=t.keyCode,-1==e(S,i)&&S.push(i),(93==i||224==i)&&(i=91),i in w){w[i]=!0;for(a in _)_[a]==i&&(s[a]=!0)}else if(n(t),s.filter.call(this,t)&&i in y)for(h=0;h<y[i].length;h++)if(o=y[i][h],o.scope==r||"all"==o.scope){u=o.mods.length>0;for(a in w)(!w[a]&&e(o.mods,+a)>-1||w[a]&&-1==e(o.mods,+a))&&(u=!1);(0==o.mods.length&&!w[16]&&!w[18]&&!w[17]&&!w[91]||u)&&o.method(t,o)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0))}}function o(t){var r,n=t.keyCode,i=e(S,n);if(i>=0&&S.splice(i,1),(93==n||224==n)&&(n=91),n in w){w[n]=!1;for(r in _)_[r]==n&&(s[r]=!1)}}function a(){for(x in w)w[x]=!1;for(x in _)s[x]=!1}function s(t,e,r){var n,i,o;for(n=m(t),void 0===r&&(r=e,e="all"),o=0;o<n.length;o++)i=[],t=n[o].split("+"),t.length>1&&(i=v(t),t=[t[t.length-1]]),t=t[0],t=R(t),t in y||(y[t]=[]),y[t].push({shortcut:n[o],scope:e,method:r,key:n[o],mods:i})}function h(t,e){var n,i,o=t.split("+"),a=[];if(o.length>1&&(a=v(o),t=o[o.length-1]),t=R(t),void 0===e&&(e=f()),y[t])for(n in y[t])i=y[t][n],i.scope===e&&r(i.mods,a)&&(y[t][n]={})}function u(t){return"string"==typeof t&&(t=R(t)),-1!=e(S,t)}function c(){return S.slice(0)}function l(t){var e=(t.target||t.srcElement).tagName;return"INPUT"!=e&&"SELECT"!=e&&"TEXTAREA"!=e}function d(t){T=t||"all"}function f(){return T||"all"}function p(t){var e,r,n;for(e in y)for(r=y[e],n=0;n<r.length;)r[n].scope===t?r.splice(n,1):n++}function m(t){var e;return t=t.replace(/\s/g,""),e=t.split(","),""==e[e.length-1]&&(e[e.length-2]+=","),e}function v(t){var e=t.slice(0,t.length-1);for(mi=0;mi<e.length;mi++)e[mi]=_[e[mi]];return e}function g(t,e,r){t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent&&t.attachEvent("on"+e,function(){r(window.event)})}function b(){var e=t.key;return t.key=C,e}var x,y={},w={16:!1,18:!1,17:!1,91:!1},T="all",_={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},A={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},R=function(t){return A[t]||t.toUpperCase().charCodeAt(0)},S=[];for(x=1;20>x;x++)A["f"+x]=111+x;var E={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(x in _)s[x]=!1;g(document,"keydown",function(t){i(t,T)}),g(document,"keyup",o),g(window,"focus",a);var C=t.key;t.key=s,t.key.setScope=d,t.key.getScope=f,t.key.deleteScope=p,t.key.filter=l,t.key.isPressed=u,t.key.getPressedKeyCodes=c,t.key.noConflict=b,t.key.unbind=h,"undefined"!=typeof module&&(module.exports=key)}(this),define("key",function(t){return function(){var e;return e||t.key}}(this)),define("gameController",["scenes/mainScene","displayController","leapController","key"],function(t,e,r,n){function i(){a===!0?(e.events.remove("debugInfo",o),r.events.remove("debugInfo",o),console.log("hiding debug info"),a=!1):(e.events.on("debugInfo",o),r.events.on("debugInfo",o),console.log("showing debug info"),a=!0)}function o(t){console.log(t)}var a=!1;return e.stage.addChild(t.getScene()),n("enter",function(){i()}),{}}),require(["gameController"]);