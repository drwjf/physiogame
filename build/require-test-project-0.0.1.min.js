/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.8 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/**
 * @license
 * Pixi.JS - v1.2.0
 * Copyright (c) 2012, Mat Groves
 * http://goodboydigital.com/
 *
 * Compiled: 2013-06-19
 *
 * Pixi.JS is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */

/* Copyright (c) 2012, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

//     keymaster.js
//     (c) 2011-2012 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.

var requirejs,require,define;!function(global){function isFunction(t){return"[object Function]"===ostring.call(t)}function isArray(t){return"[object Array]"===ostring.call(t)}function each(t,e){if(t){var n;for(n=0;n<t.length&&(!t[n]||!e(t[n],n,t));n+=1);}}function eachReverse(t,e){if(t){var n;for(n=t.length-1;n>-1&&(!t[n]||!e(t[n],n,t));n-=1);}}function hasProp(t,e){return hasOwn.call(t,e)}function getOwn(t,e){return hasProp(t,e)&&t[e]}function eachProp(t,e){var n;for(n in t)if(hasProp(t,n)&&e(t[n],n))break}function mixin(t,e,n,i){return e&&eachProp(e,function(e,r){(n||!hasProp(t,r))&&(i&&"string"!=typeof e?(t[r]||(t[r]={}),mixin(t[r],e,n,i)):t[r]=e)}),t}function bind(t,e){return function(){return e.apply(t,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(t){throw t}function getGlobal(t){if(!t)return t;var e=global;return each(t.split("."),function(t){e=e[t]}),e}function makeError(t,e,n,i){var r=new Error(e+"\nhttp://requirejs.org/docs/errors.html#"+t);return r.requireType=t,r.requireModules=i,n&&(r.originalError=n),r}function newContext(t){function e(t){var e,n;for(e=0;t[e];e+=1)if(n=t[e],"."===n)t.splice(e,1),e-=1;else if(".."===n){if(1===e&&(".."===t[2]||".."===t[0]))break;e>0&&(t.splice(e-1,2),e-=2)}}function n(t,n,i){var r,o,a,s,h,u,c,l,d,f,p,m=n&&n.split("/"),v=m,g=_.map,x=g&&g["*"];if(t&&"."===t.charAt(0)&&(n?(v=getOwn(_.pkgs,n)?m=[n]:m.slice(0,m.length-1),t=v.concat(t.split("/")),e(t),o=getOwn(_.pkgs,r=t[0]),t=t.join("/"),o&&t===r+"/"+o.main&&(t=r)):0===t.indexOf("./")&&(t=t.substring(2))),i&&g&&(m||x)){for(s=t.split("/"),h=s.length;h>0;h-=1){if(c=s.slice(0,h).join("/"),m)for(u=m.length;u>0;u-=1)if(a=getOwn(g,m.slice(0,u).join("/")),a&&(a=getOwn(a,c))){l=a,d=h;break}if(l)break;!f&&x&&getOwn(x,c)&&(f=getOwn(x,c),p=h)}!l&&f&&(l=f,d=p),l&&(s.splice(0,d,l),t=s.join("/"))}return t}function i(t){isBrowser&&each(scripts(),function(e){return e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===b.contextName?(e.parentNode.removeChild(e),!0):void 0})}function r(t){var e=getOwn(_.paths,t);return e&&isArray(e)&&e.length>1?(i(t),e.shift(),b.require.undef(t),b.require([t]),!0):void 0}function o(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function a(t,e,i,r){var a,s,h,u,c=null,l=e?e.name:null,d=t,f=!0,p="";return t||(f=!1,t="_@r"+(F+=1)),u=o(t),c=u[0],t=u[1],c&&(c=n(c,l,r),s=getOwn(C,c)),t&&(c?p=s&&s.normalize?s.normalize(t,function(t){return n(t,l,r)}):n(t,l,r):(p=n(t,l,r),u=o(p),c=u[0],p=u[1],i=!0,a=b.nameToUrl(p))),h=!c||s||i?"":"_unnormalized"+(M+=1),{prefix:c,name:p,parentMap:e,unnormalized:!!h,url:a,originalName:d,isDefine:f,id:(c?c+"!"+p:p)+h}}function s(t){var e=t.id,n=getOwn(A,e);return n||(n=A[e]=new b.Module(t)),n}function h(t,e,n){var i=t.id,r=getOwn(A,i);!hasProp(C,i)||r&&!r.defineEmitComplete?(r=s(t),r.error&&"error"===e?n(r.error):r.on(e,n)):"defined"===e&&n(C[i])}function u(t,e){var n=t.requireModules,i=!1;e?e(t):(each(n,function(e){var n=getOwn(A,e);n&&(n.error=t,n.events.error&&(i=!0,n.emit("error",t)))}),i||req.onError(t))}function c(){globalDefQueue.length&&(apsp.apply(E,[E.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function l(t){delete A[t],delete R[t]}function d(t,e,n){var i=t.map.id;t.error?t.emit("error",t.error):(e[i]=!0,each(t.depMaps,function(i,r){var o=i.id,a=getOwn(A,o);!a||t.depMatched[r]||n[o]||(getOwn(e,o)?(t.defineDep(r,C[o]),t.check()):d(a,e,n))}),n[i]=!0)}function f(){var t,e,n,o,a=1e3*_.waitSeconds,s=a&&b.startTime+a<(new Date).getTime(),h=[],c=[],l=!1,p=!0;if(!x){if(x=!0,eachProp(R,function(n){if(t=n.map,e=t.id,n.enabled&&(t.isDefine||c.push(n),!n.error))if(!n.inited&&s)r(e)?(o=!0,l=!0):(h.push(e),i(e));else if(!n.inited&&n.fetched&&t.isDefine&&(l=!0,!t.prefix))return p=!1}),s&&h.length)return n=makeError("timeout","Load timeout for modules: "+h,null,h),n.contextName=b.contextName,u(n);p&&each(c,function(t){d(t,{},{})}),s&&!o||!l||!isBrowser&&!isWebWorker||T||(T=setTimeout(function(){T=0,f()},50)),x=!1}}function p(t){hasProp(C,t[0])||s(a(t[0],null,!0)).init(t[1],t[2])}function m(t,e,n,i){t.detachEvent&&!isOpera?i&&t.detachEvent(i,e):t.removeEventListener(n,e,!1)}function v(t){var e=t.currentTarget||t.srcElement;return m(e,b.onScriptLoad,"load","onreadystatechange"),m(e,b.onScriptError,"error"),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function g(){var t;for(c();E.length;){if(t=E.shift(),null===t[0])return u(makeError("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));p(t)}}var x,y,b,w,T,_={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},A={},R={},S={},E=[],C={},L={},F=1,M=1;return w={require:function(t){return t.require?t.require:t.require=b.makeRequire(t.map)},exports:function(t){return t.usingExports=!0,t.map.isDefine?t.exports?t.exports:t.exports=C[t.map.id]={}:void 0},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){var e,n=getOwn(_.pkgs,t.map.id);return e=n?getOwn(_.config,t.map.id+"/"+n.main):getOwn(_.config,t.map.id),e||{}},exports:C[t.map.id]}}},y=function(t){this.events=getOwn(S,t.id)||{},this.map=t,this.shim=getOwn(_.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},y.prototype={init:function(t,e,n,i){i=i||{},this.inited||(this.factory=e,n?this.on("error",n):this.events.error&&(n=bind(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,e){this.depMatched[t]||(this.depMatched[t]=!0,this.depCount-=1,this.depExports[t]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,b.startTime=(new Date).getTime();var t=this.map;return this.shim?(b.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return t.prefix?this.callPlugin():this.load()})),void 0):t.prefix?this.callPlugin():this.load()}},load:function(){var t=this.map.url;L[t]||(L[t]=!0,b.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var t,e,n=this.map.id,i=this.depExports,r=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{r=b.execCb(n,o,i,r)}catch(a){t=a}else r=b.execCb(n,o,i,r);if(this.map.isDefine&&(e=this.module,e&&void 0!==e.exports&&e.exports!==this.exports?r=e.exports:void 0===r&&this.usingExports&&(r=this.exports)),t)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",u(this.error=t)}else r=o;this.exports=r,this.map.isDefine&&!this.ignore&&(C[n]=r,req.onResourceLoad&&req.onResourceLoad(b,this.map,this.depMaps)),l(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var t=this.map,e=t.id,i=a(t.prefix);this.depMaps.push(i),h(i,"defined",bind(this,function(i){var r,o,c,d=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null,p=b.makeRequire(t.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(i.normalize&&(d=i.normalize(d,function(t){return n(t,f,!0)})||""),o=a(t.prefix+"!"+d,this.map.parentMap),h(o,"defined",bind(this,function(t){this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),c=getOwn(A,o.id),c&&(this.depMaps.push(o),this.events.error&&c.on("error",bind(this,function(t){this.emit("error",t)})),c.enable()),void 0):(r=bind(this,function(t){this.init([],function(){return t},null,{enabled:!0})}),r.error=bind(this,function(t){this.inited=!0,this.error=t,t.requireModules=[e],eachProp(A,function(t){0===t.map.id.indexOf(e+"_unnormalized")&&l(t.map.id)}),u(t)}),r.fromText=bind(this,function(n,i){var o=t.name,h=a(o),c=useInteractive;i&&(n=i),c&&(useInteractive=!1),s(h),hasProp(_.config,e)&&(_.config[o]=_.config[e]);try{req.exec(n)}catch(l){return u(makeError("fromtexteval","fromText eval for "+e+" failed: "+l,l,[e]))}c&&(useInteractive=!0),this.depMaps.push(h),b.completeLoad(o),p([o],r)}),i.load(t.name,p,r,_),void 0)})),b.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){R[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(t,e){var n,i,r;if("string"==typeof t){if(t=a(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[e]=t,r=getOwn(w,t.id))return this.depExports[e]=r(this),void 0;this.depCount+=1,h(t,"defined",bind(this,function(t){this.defineDep(e,t),this.check()})),this.errback&&h(t,"error",bind(this,this.errback))}n=t.id,i=A[n],hasProp(w,n)||!i||i.enabled||b.enable(t,this)})),eachProp(this.pluginMaps,bind(this,function(t){var e=getOwn(A,t.id);e&&!e.enabled&&b.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,e){var n=this.events[t];n||(n=this.events[t]=[]),n.push(e)},emit:function(t,e){each(this.events[t],function(t){t(e)}),"error"===t&&delete this.events[t]}},b={config:_,contextName:t,registry:A,defined:C,urlFetched:L,defQueue:E,Module:y,makeModuleMap:a,nextTick:req.nextTick,onError:u,configure:function(t){t.baseUrl&&"/"!==t.baseUrl.charAt(t.baseUrl.length-1)&&(t.baseUrl+="/");var e=_.pkgs,n=_.shim,i={paths:!0,config:!0,map:!0};eachProp(t,function(t,e){i[e]?"map"===e?(_.map||(_.map={}),mixin(_[e],t,!0,!0)):mixin(_[e],t,!0):_[e]=t}),t.shim&&(eachProp(t.shim,function(t,e){isArray(t)&&(t={deps:t}),!t.exports&&!t.init||t.exportsFn||(t.exportsFn=b.makeShimExports(t)),n[e]=t}),_.shim=n),t.packages&&(each(t.packages,function(t){var n;t="string"==typeof t?{name:t}:t,n=t.location,e[t.name]={name:t.name,location:n||t.name,main:(t.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),_.pkgs=e),eachProp(A,function(t,e){t.inited||t.map.unnormalized||(t.map=a(e))}),(t.deps||t.callback)&&b.require(t.deps||[],t.callback)},makeShimExports:function(t){function e(){var e;return t.init&&(e=t.init.apply(global,arguments)),e||t.exports&&getGlobal(t.exports)}return e},makeRequire:function(e,i){function r(n,o,h){var c,l,d;return i.enableBuildCallback&&o&&isFunction(o)&&(o.__requireJsBuild=!0),"string"==typeof n?isFunction(o)?u(makeError("requireargs","Invalid require call"),h):e&&hasProp(w,n)?w[n](A[e.id]):req.get?req.get(b,n,e,r):(l=a(n,e,!1,!0),c=l.id,hasProp(C,c)?C[c]:u(makeError("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+t+(e?"":". Use require([])")))):(g(),b.nextTick(function(){g(),d=s(a(null,e)),d.skipMap=i.skipMap,d.init(n,o,h,{enabled:!0}),f()}),r)}return i=i||{},mixin(r,{isBrowser:isBrowser,toUrl:function(t){var i,r=t.lastIndexOf("."),o=t.split("/")[0],a="."===o||".."===o;return-1!==r&&(!a||r>1)&&(i=t.substring(r,t.length),t=t.substring(0,r)),b.nameToUrl(n(t,e&&e.id,!0),i,!0)},defined:function(t){return hasProp(C,a(t,e,!1,!0).id)},specified:function(t){return t=a(t,e,!1,!0).id,hasProp(C,t)||hasProp(A,t)}}),e||(r.undef=function(t){c();var n=a(t,e,!0),i=getOwn(A,t);delete C[t],delete L[n.url],delete S[t],i&&(i.events.defined&&(S[t]=i.events),l(t))}),r},enable:function(t){var e=getOwn(A,t.id);e&&s(t).enable()},completeLoad:function(t){var e,n,i,o=getOwn(_.shim,t)||{},a=o.exports;for(c();E.length;){if(n=E.shift(),null===n[0]){if(n[0]=t,e)break;e=!0}else n[0]===t&&(e=!0);p(n)}if(i=getOwn(A,t),!e&&!hasProp(C,t)&&i&&!i.inited){if(!(!_.enforceDefine||a&&getGlobal(a)))return r(t)?void 0:u(makeError("nodefine","No define call for "+t,null,[t]));p([t,o.deps||[],o.exportsFn])}f()},nameToUrl:function(t,e,n){var i,r,o,a,s,h,u,c,l;if(req.jsExtRegExp.test(t))c=t+(e||"");else{for(i=_.paths,r=_.pkgs,s=t.split("/"),h=s.length;h>0;h-=1){if(u=s.slice(0,h).join("/"),o=getOwn(r,u),l=getOwn(i,u)){isArray(l)&&(l=l[0]),s.splice(0,h,l);break}if(o){a=t===o.name?o.location+"/"+o.main:o.location,s.splice(0,h,a);break}}c=s.join("/"),c+=e||(/\?/.test(c)||n?"":".js"),c=("/"===c.charAt(0)||c.match(/^[\w\+\.\-]+:/)?"":_.baseUrl)+c}return _.urlArgs?c+((-1===c.indexOf("?")?"?":"&")+_.urlArgs):c},load:function(t,e){req.load(b,t,e)},execCb:function(t,e,n,i){return e.apply(i,n)},onScriptLoad:function(t){if("load"===t.type||readyRegExp.test((t.currentTarget||t.srcElement).readyState)){interactiveScript=null;var e=v(t);b.completeLoad(e.id)}},onScriptError:function(t){var e=v(t);return r(e.id)?void 0:u(makeError("scripterror","Script error for: "+e.id,t,[e.id]))}},b.require=b.makeRequire(),b}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(t){return"interactive"===t.readyState?interactiveScript=t:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.8",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||!navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(t,e,n,i){var r,o,a=defContextName;return isArray(t)||"string"==typeof t||(o=t,isArray(e)?(t=e,e=n,n=i):t=[]),o&&o.context&&(a=o.context),r=getOwn(contexts,a),r||(r=contexts[a]=req.s.newContext(a)),o&&r.configure(o),r.require(t,e,n)},req.config=function(t){return req(t)},req.nextTick="undefined"!=typeof setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(t){req[t]=function(){var e=contexts[defContextName];return e.require[t].apply(e,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(t){var e=t.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return e.type=t.scriptType||"text/javascript",e.charset="utf-8",e.async=!0,e},req.load=function(t,e,n){var i,r=t&&t.config||{};if(isBrowser)return i=req.createNode(r,e,n),i.setAttribute("data-requirecontext",t.contextName),i.setAttribute("data-requiremodule",e),!i.attachEvent||i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0||isOpera?(i.addEventListener("load",t.onScriptLoad,!1),i.addEventListener("error",t.onScriptError,!1)):(useInteractive=!0,i.attachEvent("onreadystatechange",t.onScriptLoad)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{importScripts(n),t.completeLoad(e)}catch(o){t.onError(makeError("importscripts","importScripts failed for "+e+" at "+n,o,[e]))}},isBrowser&&eachReverse(scripts(),function(t){return head||(head=t.parentNode),dataMain=t.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(t,e,n){var i,r;"string"!=typeof t&&(n=e,e=t,t=null),isArray(e)||(n=e,e=null),!e&&isFunction(n)&&(e=[],n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(t,n){e.push(n)}),e=(1===n.length?["require"]:["require","exports","module"]).concat(e))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript(),i&&(t||(t=i.getAttribute("data-requiremodule")),r=contexts[i.getAttribute("data-requirecontext")])),(r?r.defQueue:globalDefQueue).push([t,e,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),!function(){function t(t){return[(255&t>>16)/255,(255&t>>8)/255,(255&t)/255]}function e(){return i.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,i.Matrix}var n=this,i=i||{};i.Point=function(t,e){this.x=t||0,this.y=e||0},i.Point.prototype.clone=function(){return new i.Point(this.x,this.y)},i.Point.constructor=i.Point,i.Rectangle=function(t,e,n,i){this.x=t||0,this.y=e||0,this.width=n||0,this.height=i||0},i.Rectangle.prototype.clone=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Rectangle.constructor=i.Rectangle,i.Polygon=function(t){this.points=t},i.Polygon.clone=function(){for(var t=[],e=0;e<this.points.length;e++)t.push(this.points[e].clone());return new i.Polygon(t)},i.Polygon.constructor=i.Polygon,i.DisplayObject=function(){this.position=new i.Point,this.scale=new i.Point(1,1),this.pivot=new i.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.worldVisible=!1,this.parent=null,this.stage=null,this.hitArea=null,this.worldAlpha=1,this.color=[],this.worldTransform=i.mat3.create(),this.localTransform=i.mat3.create(),this.dynamic=!0,this._sr=0,this._cr=1,this.childIndex=0,this.renderable=!1,this.interactive=!1,this.buttonMode=!1},i.DisplayObject.constructor=i.DisplayObject,i.DisplayObject.prototype.setInteractive=function(t){this.interactive=t,this.stage&&(this.stage.dirty=!0)},i.DisplayObject.prototype.updateTransform=function(){this.rotation!=this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var t=this.localTransform,e=this.parent.worldTransform,n=this.worldTransform;t[0]=this._cr*this.scale.x,t[1]=-this._sr*this.scale.y,t[3]=this._sr*this.scale.x,t[4]=this._cr*this.scale.y;var i=this.pivot.x,r=this.pivot.y;t[2]=this.position.x-t[0]*i-r*t[1],t[5]=this.position.y-t[4]*r-i*t[3];var o=t[0],a=t[1],s=t[2],h=t[3],u=t[4],c=t[5],l=e[0],d=e[1],f=e[2],p=e[3],m=e[4],v=e[5];n[0]=l*o+d*h,n[1]=l*a+d*u,n[2]=l*s+d*c+f,n[3]=p*o+m*h,n[4]=p*a+m*u,n[5]=p*s+m*c+v,this.worldAlpha=this.alpha*this.parent.worldAlpha},i.DisplayObjectContainer=function(){i.DisplayObject.call(this),this.children=[],this.renderable=!1},i.DisplayObjectContainer.constructor=i.DisplayObjectContainer,i.DisplayObjectContainer.prototype=Object.create(i.DisplayObject.prototype),i.DisplayObjectContainer.prototype.addChild=function(t){void 0!=t.parent&&t.parent.removeChild(t),t.parent=this,t.childIndex=this.children.length,this.children.push(t),this.stage&&this.stage.__addChild(t),this.__renderGroup&&(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),this.__renderGroup.addDisplayObjectAndChildren(t))},i.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(!(e>=0&&e<=this.children.length))throw new Error(t+" The index "+e+" supplied is out of bounds "+this.children.length);void 0!=t.parent&&t.parent.removeChild(t),e==this.children.length?this.children.push(t):this.children.splice(e,0,t),t.parent=this,t.childIndex=e;for(var n=this.children.length,i=e;n>i;i++)this.children[i].childIndex=i;this.stage&&this.stage.__addChild(t),this.__renderGroup&&(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),this.__renderGroup.addDisplayObjectAndChildren(t))},i.DisplayObjectContainer.prototype.swapChildren=function(t,e){var n=this.children.indexOf(t),i=this.children.indexOf(e);if(-1===n||-1===i)throw new Error(t+" Both the supplied DisplayObjects must be a child of the caller "+this);this.stage&&(this.stage.__removeChild(t),this.stage.__removeChild(e),this.stage.__addChild(t),this.stage.__addChild(e)),t.childIndex=i,e.childIndex=n,this.children[n]=e,this.children[i]=t},i.DisplayObjectContainer.prototype.getChildAt=function(t){if(t>=0&&t<this.children.length)return this.children[t];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},i.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error(t+" The supplied DisplayObject must be a child of the caller "+this);this.stage&&this.stage.__removeChild(t),t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),t.parent=void 0,this.children.splice(e,1);for(var n=e,i=this.children.length;i>n;n++)this.children[n].childIndex-=1},i.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){i.DisplayObject.prototype.updateTransform.call(this);for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform()}},i.blendModes={},i.blendModes.NORMAL=0,i.blendModes.SCREEN=1,i.Sprite=function(t){i.DisplayObjectContainer.call(this),this.anchor=new i.Point,this.texture=t,this.blendMode=i.blendModes.NORMAL,this._width=0,this._height=0,t.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Sprite.constructor=i.Sprite,i.Sprite.prototype=Object.create(i.DisplayObjectContainer.prototype),Object.defineProperty(i.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(i.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),i.Sprite.prototype.setTexture=function(t){this.texture.baseTexture!=t.baseTexture&&(this.textureChange=!0),this.texture=t,this.updateFrame=!0},i.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},i.Sprite.fromFrame=function(t){var e=i.TextureCache[t];if(!e)throw new Error("The frameId '"+t+"' does not exist in the texture cache"+this);return new i.Sprite(e)},i.Sprite.fromImage=function(t){var e=i.Texture.fromImage(t);return new i.Sprite(e)},i.MovieClip=function(t){i.Sprite.call(this,t[0]),this.textures=t,this.currentFrame=0,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.playing},i.MovieClip.constructor=i.MovieClip,i.MovieClip.prototype=Object.create(i.Sprite.prototype),i.MovieClip.prototype.stop=function(){this.playing=!1},i.MovieClip.prototype.play=function(){this.playing=!0},i.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1,this.currentFrame=t;var e=0|this.currentFrame+.5;this.setTexture(this.textures[e%this.textures.length])},i.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t,this.playing=!0},i.MovieClip.prototype.updateTransform=function(){if(i.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var t=0|this.currentFrame+.5;this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},i.Text=function(t,e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),i.Sprite.call(this,i.Texture.fromCanvas(this.canvas)),this.setText(t),this.setStyle(e),this.updateText(),this.dirty=!1},i.Text.constructor=i.Text,i.Text.prototype=Object.create(i.Sprite.prototype),i.Text.prototype.setStyle=function(t){t=t||{},t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,this.style=t,this.dirty=!0},i.Sprite.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},i.Text.prototype.updateText=function(){this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),n=[],r=0,o=0;o<e.length;o++){var a=this.context.measureText(e[o]).width;n[o]=a,r=Math.max(r,a)}this.canvas.width=r+this.style.strokeThickness;var s=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=s*e.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",o=0;o<e.length;o++){var h=new i.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+o*s);"right"==this.style.align?h.x+=r-n[o]:"center"==this.style.align&&(h.x+=(r-n[o])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[o],h.x,h.y),this.style.fill&&this.context.fillText(e[o],h.x,h.y)}this.updateTexture()},i.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,i.texturesToUpdate.push(this.texture.baseTexture)},i.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),i.Sprite.prototype.updateTransform.call(this)},i.Text.prototype.determineFontHeight=function(t){var e=i.Text.heightCache[t];if(!e){var n=document.getElementsByTagName("body")[0],r=document.createElement("div"),o=document.createTextNode("M");r.appendChild(o),r.setAttribute("style",t+";position:absolute;top:0;left:0"),n.appendChild(r),e=r.offsetHeight,i.Text.heightCache[t]=e,n.removeChild(r)}return e},i.Text.prototype.wordWrap=function(t){for(var e=function(t,e,n,i,r){var o=Math.floor((i-n)/2)+n;return o==n?1:t.measureText(e.substring(0,o)).width<=r?t.measureText(e.substring(0,o+1)).width>r?o:arguments.callee(t,e,o,i,r):arguments.callee(t,e,n,o,r)},n=function(t,n,i){if(t.measureText(n).width<=i||n.length<1)return n;var r=e(t,n,0,n.length,i);return n.substring(0,r)+"\n"+arguments.callee(t,n.substring(r),i)},i="",r=t.split("\n"),o=0;o<r.length;o++)i+=n(this.context,r[o],this.style.wordWrapWidth)+"\n";return i},i.Text.prototype.destroy=function(t){t&&this.texture.destroy()},i.Text.heightCache={},i.BitmapText=function(t,e){i.DisplayObjectContainer.call(this),this.setText(t),this.setStyle(e),this.updateText(),this.dirty=!1},i.BitmapText.constructor=i.BitmapText,i.BitmapText.prototype=Object.create(i.DisplayObjectContainer.prototype),i.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},i.BitmapText.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",this.style=t;var e=t.font.split(" ");this.fontName=e[e.length-1],this.fontSize=e.length>=2?parseInt(e[e.length-2],10):i.BitmapText.fonts[this.fontName].size,this.dirty=!0},i.BitmapText.prototype.updateText=function(){for(var t=i.BitmapText.fonts[this.fontName],e=new i.Point,n=null,r=[],o=0,a=[],s=0,h=this.fontSize/t.size,u=0;u<this.text.length;u++){var c=this.text.charCodeAt(u);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(u)))a.push(e.x),o=Math.max(o,e.x),s++,e.x=0,e.y+=t.lineHeight,n=null;else{var l=t.chars[c];l&&(n&&l[n]&&(e.x+=l.kerning[n]),r.push({texture:l.texture,line:s,charCode:c,position:new i.Point(e.x+l.xOffset,e.y+l.yOffset)}),e.x+=l.xAdvance,n=c)}}a.push(e.x),o=Math.max(o,e.x);var d=[];for(u=0;s>=u;u++){var f=0;"right"==this.style.align?f=o-a[u]:"center"==this.style.align&&(f=(o-a[u])/2),d.push(f)}for(u=0;u<r.length;u++){var p=new i.Sprite(r[u].texture);p.position.x=(r[u].position.x+d[r[u].line])*h,p.position.y=r[u].position.y*h,p.scale.x=p.scale.y=h,this.addChild(p)}this.width=e.x*h,this.height=(e.y+t.lineHeight)*h},i.BitmapText.prototype.updateTransform=function(){if(this.dirty){for(;this.children.length>0;)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.BitmapText.fonts={},i.InteractionManager=function(t){this.stage=t,this.tempPoint=new i.Point,this.mouseoverEnabled=!0,this.mouse=new i.InteractionData,this.touchs={},this.pool=[],this.interactiveItems=[],this.last=0},i.InteractionManager.constructor=i.InteractionManager,i.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var n=t.children,i=n.length,r=i-1;r>=0;r--){var o=n[r];o.visible&&(o.interactive?(e.interactiveChildren=!0,this.interactiveItems.push(o),o.children.length>0&&this.collectInteractiveSprite(o,o)):(o.__iParent=null,o.children.length>0&&this.collectInteractiveSprite(o,e)))}},i.InteractionManager.prototype.setTarget=function(t){window.navigator.msPointerEnabled&&(t.view.style["-ms-content-zooming"]="none",t.view.style["-ms-touch-action"]="none"),this.target=t,t.view.addEventListener("mousemove",this.onMouseMove.bind(this),!0),t.view.addEventListener("mousedown",this.onMouseDown.bind(this),!0),document.body.addEventListener("mouseup",this.onMouseUp.bind(this),!0),t.view.addEventListener("mouseout",this.onMouseUp.bind(this),!0),t.view.addEventListener("touchstart",this.onTouchStart.bind(this),!0),t.view.addEventListener("touchend",this.onTouchEnd.bind(this),!0),t.view.addEventListener("touchmove",this.onTouchMove.bind(this),!0)},i.InteractionManager.prototype.update=function(){if(this.target){var t=Date.now(),e=t-this.last;if(e=30*e/1e3,!(1>e)){if(this.last=t,this.dirty){this.dirty=!1,this.interactiveItems.length;for(var n=0;n<this.interactiveItems.length;n++)this.interactiveItems[n].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var i=this.interactiveItems.length;this.target.view.style.cursor="default";for(var n=0;i>n;n++){var r=this.interactiveItems[n];r.visible&&(r.mouseover||r.mouseout||r.buttonMode)&&(r.__hit=this.hitTest(r,this.mouse),r.__hit?(r.buttonMode&&(this.target.view.style.cursor="pointer"),r.__isOver||(r.mouseover&&r.mouseover(this.mouse),r.__isOver=!0)):r.__isOver&&(r.mouseout&&r.mouseout(this.mouse),r.__isOver=!1))}}}},i.InteractionManager.prototype.onMouseMove=function(t){var e=this.target.view.getBoundingClientRect();this.mouse.global.x=(t.clientX-e.left)*(this.target.width/e.width),this.mouse.global.y=(t.clientY-e.top)*(this.target.height/e.height);var n=this.interactiveItems.length;this.mouse.global;for(var i=0;n>i;i++){var r=this.interactiveItems[i];r.mousemove&&r.mousemove(this.mouse)}},i.InteractionManager.prototype.onMouseDown=function(t){t.preventDefault();var e=this.interactiveItems.length;this.mouse.global,this.stage;for(var n=0;e>n;n++){var i=this.interactiveItems[n];if((i.mousedown||i.click)&&(i.__mouseIsDown=!0,i.__hit=this.hitTest(i,this.mouse),i.__hit&&(i.mousedown&&i.mousedown(this.mouse),i.__isDown=!0,!i.interactiveChildren)))break}},i.InteractionManager.prototype.onMouseUp=function(){this.mouse.global;for(var t=this.interactiveItems.length,e=!1,n=0;t>n;n++){var i=this.interactiveItems[n];(i.mouseup||i.mouseupoutside||i.click)&&(i.__hit=this.hitTest(i,this.mouse),i.__hit&&!e?(i.mouseup&&i.mouseup(this.mouse),i.__isDown&&i.click&&i.click(this.mouse),i.interactiveChildren||(e=!0)):i.__isDown&&i.mouseupoutside&&i.mouseupoutside(this.mouse),i.__isDown=!1)}},i.InteractionManager.prototype.hitTest=function(t,e){var n=e.global;if(!t.visible)return!1;var r=t instanceof i.Sprite,o=t.worldTransform,a=o[0],s=o[1],h=o[2],u=o[3],c=o[4],l=o[5],d=1/(a*c+s*-u),f=c*d*n.x+-s*d*n.y+(l*s-h*c)*d,p=a*d*n.y+-u*d*n.x+(-l*a+h*u)*d;if(t.hitArea){var m=t.hitArea;if(t.hitArea instanceof i.Polygon){for(var v=!1,g=0,x=t.hitArea.points.length-1;g<t.hitArea.points.length;x=g++){var y=t.hitArea.points[g].x,b=t.hitArea.points[g].y,w=t.hitArea.points[x].x,T=t.hitArea.points[x].y,_=b>p!=T>p&&(w-y)*(p-b)/(T-b)+y>f;
_&&(v=!v)}if(v)return r&&(e.target=t),!0}else{var A=m.x;if(f>A&&f<A+m.width){var R=m.y;if(p>R&&p<R+m.height)return r&&(e.target=t),!0}}}else if(r){var R,S=t.texture.frame.width,E=t.texture.frame.height,A=-S*t.anchor.x;if(f>A&&A+S>f&&(R=-E*t.anchor.y,p>R&&R+E>p))return e.target=t,!0}for(var C=t.children.length,g=0;C>g;g++){var L=t.children[g],F=this.hitTest(L,e);if(F)return!0}return!1},i.InteractionManager.prototype.onTouchMove=function(t){for(var e=this.target.view.getBoundingClientRect(),n=t.changedTouches,i=0;i<n.length;i++){var r=n[i],o=this.touchs[r.identifier];o.global.x=(r.clientX-e.left)*(this.target.width/e.width),o.global.y=(r.clientY-e.top)*(this.target.height/e.height)}for(var a=this.interactiveItems.length,i=0;a>i;i++){var s=this.interactiveItems[i];s.touchmove&&s.touchmove(o)}},i.InteractionManager.prototype.onTouchStart=function(t){t.preventDefault();for(var e=this.target.view.getBoundingClientRect(),n=t.changedTouches,r=0;r<n.length;r++){var o=n[r],a=this.pool.pop();a||(a=new i.InteractionData),this.touchs[o.identifier]=a,a.global.x=(o.clientX-e.left)*(this.target.width/e.width),a.global.y=(o.clientY-e.top)*(this.target.height/e.height);for(var s=this.interactiveItems.length,h=0;s>h;h++){var u=this.interactiveItems[h];if((u.touchstart||u.tap)&&(u.__hit=this.hitTest(u,a),u.__hit&&(u.touchstart&&u.touchstart(a),u.__isDown=!0,u.__touchData=a,!u.interactiveChildren)))break}}},i.InteractionManager.prototype.onTouchEnd=function(t){for(var e=this.target.view.getBoundingClientRect(),n=t.changedTouches,i=0;i<n.length;i++){var r=n[i],o=this.touchs[r.identifier],a=!1;o.global.x=(r.clientX-e.left)*(this.target.width/e.width),o.global.y=(r.clientY-e.top)*(this.target.height/e.height);for(var s=this.interactiveItems.length,h=0;s>h;h++){var u=this.interactiveItems[h],c=u.__touchData;u.__hit=this.hitTest(u,o),c==o&&((u.touchend||u.tap)&&(u.__hit&&!a?(u.touchend&&u.touchend(o),u.__isDown&&u.tap&&u.tap(o),u.interactiveChildren||(a=!0)):u.__isDown&&u.touchendoutside&&u.touchendoutside(o),u.__isDown=!1),u.__touchData=null)}this.pool.push(o),this.touchs[r.identifier]=null}},i.InteractionData=function(){this.global=new i.Point,this.local=new i.Point,this.target},i.InteractionData.prototype.getLocalPosition=function(t){var e=t.worldTransform,n=this.global,r=e[0],o=e[1],a=e[2],s=e[3],h=e[4],u=e[5],c=1/(r*h+o*-s);return new i.Point(h*c*n.x+-o*c*n.y+(u*o-a*h)*c,r*c*n.y+-s*c*n.x+(-u*r+a*s)*c)},i.InteractionData.constructor=i.InteractionData,i.Stage=function(t,e){i.DisplayObjectContainer.call(this),this.worldTransform=i.mat3.create(),this.__childrenAdded=[],this.__childrenRemoved=[],this.childIndex=0,this.stage=this,this.stage.hitArea=new i.Rectangle(0,0,1e5,1e5),this.interactive=!!e,this.interactionManager=new i.InteractionManager(this),this.setBackgroundColor(t),this.worldVisible=!0,this.stage.dirty=!0},i.Stage.constructor=i.Stage,i.Stage.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},i.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t(this.backgroundColor);var n=this.backgroundColor.toString(16);n="000000".substr(0,6-n.length)+n,this.backgroundColorString="#"+n},i.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},i.Stage.prototype.__addChild=function(t){if(t.interactive&&(this.dirty=!0),t.stage=this,t.children)for(var e=0;e<t.children.length;e++)this.__addChild(t.children[e])},i.Stage.prototype.__removeChild=function(t){if(t.interactive&&(this.dirty=!0),t.stage=void 0,t.children)for(var e=0,n=t.children.length;n>e;e++)this.__removeChild(t.children[e])};for(var o=0,s=["ms","moz","webkit","o"],h=0;h<s.length&&!window.requestAnimationFrame;++h)window.requestAnimationFrame=window[s[h]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[s[h]+"CancelAnimationFrame"]||window[s[h]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var e=(new Date).getTime(),n=Math.max(0,16-(e-o)),i=window.setTimeout(function(){t(e+n)},n);return o=e+n,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.requestAnimFrame=window.requestAnimationFrame,"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var t=Array.prototype.slice;return function(e){function n(){var o=r.concat(t.call(arguments));i.apply(this instanceof n?this:e,o)}var i=this,r=t.call(arguments,1);if("function"!=typeof i)throw new TypeError;return n.prototype=function o(t){return t&&(o.prototype=t),this instanceof o?void 0:new o}(i.prototype),n}}());var u=i.AjaxRequest=function(){var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:!1;for(var e=0;e<t.length;e++)try{return new ActiveXObject(t[e])}catch(n){}};i.EventTarget=function(){var t={};this.addEventListener=this.on=function(e,n){void 0===t[e]&&(t[e]=[]),-1===t[e].indexOf(n)&&t[e].push(n)},this.dispatchEvent=this.emit=function(e){for(var n in t[e.type])t[e.type][n](e)},this.removeEventListener=this.off=function(e,n){var i=t[e].indexOf(n);-1!==i&&t[e].splice(i,1)}},e(),i.mat3={},i.mat3.create=function(){var t=new i.Matrix(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.mat4={},i.mat4.create=function(){var t=new i.Matrix(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.mat3.multiply=function(t,e,n){n||(n=t);var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=e[0],f=e[1],p=e[2],m=e[3],v=e[4],g=e[5],x=e[6],y=e[7],b=e[8];return n[0]=d*i+f*a+p*u,n[1]=d*r+f*s+p*c,n[2]=d*o+f*h+p*l,n[3]=m*i+v*a+g*u,n[4]=m*r+v*s+g*c,n[5]=m*o+v*h+g*l,n[6]=x*i+y*a+b*u,n[7]=x*r+y*s+b*c,n[8]=x*o+y*h+b*l,n},i.mat3.toMat4=function(t,e){return e||(e=i.mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},i.mat4.create=function(){var t=new i.Matrix(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.mat4.transpose=function(t,e){if(!e||t===e){var n=t[1],i=t[2],r=t[3],o=t[6],a=t[7],s=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=n,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=o,t[11]=t[14],t[12]=r,t[13]=a,t[14]=s,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},i.mat4.multiply=function(t,e,n){n||(n=t);var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],p=t[11],m=t[12],v=t[13],g=t[14],x=t[15],y=e[0],b=e[1],w=e[2],T=e[3];return n[0]=y*i+b*s+w*l+T*m,n[1]=y*r+b*h+w*d+T*v,n[2]=y*o+b*u+w*f+T*g,n[3]=y*a+b*c+w*p+T*x,y=e[4],b=e[5],w=e[6],T=e[7],n[4]=y*i+b*s+w*l+T*m,n[5]=y*r+b*h+w*d+T*v,n[6]=y*o+b*u+w*f+T*g,n[7]=y*a+b*c+w*p+T*x,y=e[8],b=e[9],w=e[10],T=e[11],n[8]=y*i+b*s+w*l+T*m,n[9]=y*r+b*h+w*d+T*v,n[10]=y*o+b*u+w*f+T*g,n[11]=y*a+b*c+w*p+T*x,y=e[12],b=e[13],w=e[14],T=e[15],n[12]=y*i+b*s+w*l+T*m,n[13]=y*r+b*h+w*d+T*v,n[14]=y*o+b*u+w*f+T*g,n[15]=y*a+b*c+w*p+T*x,n},i.autoDetectRenderer=function(t,e,n,r){t||(t=800),e||(e=600);var o=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(t){return!1}}();return o?new i.WebGLRenderer(t,e,n,r):new i.CanvasRenderer(t,e,n,r)},i.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],i.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat4 uMVMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = uMVMatrix * vec4(aVertexPosition, 1.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.CompileVertexShader=function(t,e){return i._CompileShader(t,e,t.VERTEX_SHADER)},i.CompileFragmentShader=function(t,e){return i._CompileShader(t,e,t.FRAGMENT_SHADER)},i._CompileShader=function(t,e,n){var i=e.join("\n"),r=t.createShader(n);return t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(alert(t.getShaderInfoLog(r)),null)},i._defaultFrame=new i.Rectangle(0,0,1,1),i.gl,i.WebGLRenderer=function(t,e,n,r){this.transparent=!!r,this.width=t||800,this.height=e||600,this.view=n||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var o=this;this.view.addEventListener("webglcontextlost",function(t){o.handleContextLost(t)},!1),this.view.addEventListener("webglcontextrestored",function(t){o.handleContextRestored(t)},!1),this.batchs=[];try{i.gl=this.gl=this.view.getContext("experimental-webgl",{alpha:this.transparent,antialias:!1,premultipliedAlpha:!1})}catch(a){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}this.initShaders();var s=this.gl;i.WebGLRenderer.gl=s,this.batch=new i.WebGLBatch(s),s.disable(s.DEPTH_TEST),s.disable(s.CULL_FACE),s.enable(s.BLEND),s.colorMask(!0,!0,!0,this.transparent),this.projectionMatrix=i.mat4.create(),this.resize(this.width,this.height),this.contextLost=!1,this.stageRenderGroup=new i.WebGLRenderGroup(this.gl)},i.WebGLRenderer.constructor=i.WebGLRenderer,i.WebGLRenderer.getBatch=function(){return 0==i._batchs.length?new i.WebGLBatch(i.WebGLRenderer.gl):i._batchs.pop()},i.WebGLRenderer.returnBatch=function(t){t.clean(),i._batchs.push(t)},i.WebGLRenderer.prototype.initShaders=function(){var t=this.gl,e=i.CompileFragmentShader(t,i.shaderFragmentSrc),n=i.CompileVertexShader(t,i.shaderVertexSrc);i.shaderProgram=t.createProgram();var r=i.shaderProgram;t.attachShader(r,n),t.attachShader(r,e),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||alert("Could not initialise shaders"),t.useProgram(r),r.vertexPositionAttribute=t.getAttribLocation(r,"aVertexPosition"),t.enableVertexAttribArray(r.vertexPositionAttribute),r.textureCoordAttribute=t.getAttribLocation(r,"aTextureCoord"),t.enableVertexAttribArray(r.textureCoordAttribute),r.colorAttribute=t.getAttribLocation(r,"aColor"),t.enableVertexAttribArray(r.colorAttribute),r.mvMatrixUniform=t.getUniformLocation(r,"uMVMatrix"),r.samplerUniform=t.getUniformLocation(r,"uSampler")},i.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(this.__stage=t,this.stageRenderGroup.setRenderable(t)),i.WebGLRenderer.updateTextures(),t.updateTransform();var e=this.gl;if(e.colorMask(!0,!0,!0,this.transparent),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],!this.transparent),e.clear(e.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=t.backgroundColorSplit,this.stageRenderGroup.render(this.projectionMatrix),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0){for(var n=0;n<i.Texture.frameUpdates.length;n++)i.Texture.frameUpdates[n].updateFrame=!1;i.Texture.frameUpdates=[]}}},i.WebGLRenderer.updateTextures=function(){for(var t=0;t<i.texturesToUpdate.length;t++)this.updateTexture(i.texturesToUpdate[t]);for(var t=0;t<i.texturesToDestroy.length;t++)this.destroyTexture(i.texturesToDestroy[t]);i.texturesToUpdate=[],i.texturesToDestroy=[]},i.WebGLRenderer.updateTexture=function(t){var e=i.gl;t._glTexture||(t._glTexture=e.createTexture()),t.hasLoaded&&(e.bindTexture(e.TEXTURE_2D,t._glTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),e.bindTexture(e.TEXTURE_2D,null))},i.WebGLRenderer.prototype.destroyTexture=function(t){var e=this.gl;t._glTexture&&(t._glTexture=e.createTexture(),e.deleteTexture(e.TEXTURE_2D,t._glTexture))},i.WebGLRenderer.prototype.resize=function(t,e){this.width=t,this.height=e,this.view.width=t,this.view.height=e,this.gl.viewport(0,0,this.width,this.height);var n=this.projectionMatrix;n[0]=2/this.width,n[5]=-2/this.height,n[12]=-1,n[13]=1},i.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},i.WebGLRenderer.prototype.handleContextRestored=function(){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var t in i.TextureCache){var e=i.TextureCache[t].baseTexture;e._glTexture=null,i.WebGLRenderer.updateTexture(e)}for(var n=0;n<this.batchs.length;n++)this.batchs[n].restoreLostContext(this.gl),this.batchs[n].dirty=!0;i._restoreBatchs(this.gl),this.contextLost=!1},i._batchs=[],i._getBatch=function(t){return 0==i._batchs.length?new i.WebGLBatch(t):i._batchs.pop()},i._returnBatch=function(t){t.clean(),i._batchs.push(t)},i._restoreBatchs=function(t){for(var e=0;e<i._batchs.length;e++)i._batchs[e].restoreLostContext(t)},i.WebGLBatch=function(t){this.gl=t,this.size=0,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.blendMode=i.blendModes.NORMAL,this.dynamicSize=1},i.WebGLBatch.constructor=i.WebGLBatch,i.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},i.WebGLBatch.prototype.restoreLostContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer()},i.WebGLBatch.prototype.init=function(t){t.batch=this,this.dirty=!0,this.blendMode=t.blendMode,this.texture=t.texture.baseTexture,this.head=t,this.tail=t,this.size=1,this.growBatch()},i.WebGLBatch.prototype.insertBefore=function(t,e){this.size++,t.batch=this,this.dirty=!0;var n=e.__prev;e.__prev=t,t.__next=e,n?(t.__prev=n,n.__next=t):this.head=t},i.WebGLBatch.prototype.insertAfter=function(t,e){this.size++,t.batch=this,this.dirty=!0;var n=e.__next;e.__next=t,t.__prev=e,n?(t.__next=n,n.__prev=t):this.tail=t},i.WebGLBatch.prototype.remove=function(t){return this.size--,0==this.size?(t.batch=null,t.__prev=null,t.__next=null,void 0):(t.__prev?t.__prev.__next=t.__next:(this.head=t.__next,this.head.__prev=null),t.__next?t.__next.__prev=t.__prev:(this.tail=t.__prev,this.tail.__next=null),t.batch=null,t.__next=null,t.__prev=null,this.dirty=!0,void 0)},i.WebGLBatch.prototype.split=function(t){this.dirty=!0;var e=new i.WebGLBatch(this.gl);e.init(t),e.texture=this.texture,e.tail=this.tail,this.tail=t.__prev,this.tail.__next=null,t.__prev=null;for(var n=0;t;)n++,t.batch=e,t=t.__next;return e.size=n,this.size-=n,e},i.WebGLBatch.prototype.merge=function(t){this.dirty=!0,this.tail.__next=t.head,t.head.__prev=this.tail,this.size+=t.size,this.tail=t.tail;for(var e=t.head;e;)e.batch=this,e=e.__next},i.WebGLBatch.prototype.growBatch=function(){var t=this.gl;this.dynamicSize=1==this.size?1:1.5*this.size,this.verticies=new Float32Array(8*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticies,t.DYNAMIC_DRAW),this.uvs=new Float32Array(8*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(4*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(6*this.dynamicSize);for(var e=this.indices.length/6,n=0;e>n;n++){var i=6*n,r=4*n;this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},i.WebGLBatch.prototype.refresh=function(){this.gl,this.dynamicSize<this.size&&this.growBatch();for(var t,e=0,n=this.head;n;){t=8*e;var i=n.texture,r=i.frame,o=i.baseTexture.width,a=i.baseTexture.height;this.uvs[t+0]=r.x/o,this.uvs[t+1]=r.y/a,this.uvs[t+2]=(r.x+r.width)/o,this.uvs[t+3]=r.y/a,this.uvs[t+4]=(r.x+r.width)/o,this.uvs[t+5]=(r.y+r.height)/a,this.uvs[t+6]=r.x/o,this.uvs[t+7]=(r.y+r.height)/a,n.updateFrame=!1,colorIndex=4*e,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=n.worldAlpha,n=n.__next,e++}this.dirtyUVS=!0,this.dirtyColors=!0},i.WebGLBatch.prototype.update=function(){this.gl;for(var t,e,n,i,r,o,a,s,h,u,c,l,d,f,p,m,v=0,g=this.head;g;){if(g.worldVisible){if(e=g.texture.frame.width,n=g.texture.frame.height,i=g.anchor.x,r=g.anchor.y,o=e*(1-i),a=e*-i,s=n*(1-r),h=n*-r,u=8*v,t=g.worldTransform,c=t[0],l=t[3],d=t[1],f=t[4],p=t[2],m=t[5],this.verticies[u+0]=c*a+d*h+p,this.verticies[u+1]=f*h+l*a+m,this.verticies[u+2]=c*o+d*h+p,this.verticies[u+3]=f*h+l*o+m,this.verticies[u+4]=c*o+d*s+p,this.verticies[u+5]=f*s+l*o+m,this.verticies[u+6]=c*a+d*s+p,this.verticies[u+7]=f*s+l*a+m,g.updateFrame||g.texture.updateFrame){this.dirtyUVS=!0;var x=g.texture,y=x.frame,b=x.baseTexture.width,w=x.baseTexture.height;this.uvs[u+0]=y.x/b,this.uvs[u+1]=y.y/w,this.uvs[u+2]=(y.x+y.width)/b,this.uvs[u+3]=y.y/w,this.uvs[u+4]=(y.x+y.width)/b,this.uvs[u+5]=(y.y+y.height)/w,this.uvs[u+6]=y.x/b,this.uvs[u+7]=(y.y+y.height)/w,g.updateFrame=!1}if(g.cacheAlpha!=g.worldAlpha){g.cacheAlpha=g.worldAlpha;var T=4*v;this.colors[T]=this.colors[T+1]=this.colors[T+2]=this.colors[T+3]=g.worldAlpha,this.dirtyColors=!0}}else u=8*v,this.verticies[u+0]=0,this.verticies[u+1]=0,this.verticies[u+2]=0,this.verticies[u+3]=0,this.verticies[u+4]=0,this.verticies[u+5]=0,this.verticies[u+6]=0,this.verticies[u+7]=0;v++,g=g.__next}},i.WebGLBatch.prototype.render=function(t,e){if(t=t||0,void 0==e&&(e=this.size),this.dirty&&(this.refresh(),this.dirty=!1),0!=this.size){this.update();var n=this.gl;n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA);var r=i.shaderProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.uvs)),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.colors)),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var o=e-t;n.drawElements(n.TRIANGLES,6*o,n.UNSIGNED_SHORT,12*t)}},i.WebGLRenderGroup=function(t){this.gl=t,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},i.WebGLRenderGroup.constructor=i.WebGLRenderGroup,i.WebGLRenderGroup.prototype.setRenderable=function(t){this.root&&this.removeDisplayObjectAndChildren(this.root),t.worldVisible=t.visible,this.root=t,this.addDisplayObjectAndChildren(t)},i.WebGLRenderGroup.prototype.render=function(t){i.WebGLRenderer.updateTextures();var e=this.gl;e.uniformMatrix4fv(i.shaderProgram.mvMatrixUniform,!1,t),this.checkVisibility(this.root,this.root.visible);for(var n,r=0;r<this.batchs.length;r++)n=this.batchs[r],n instanceof i.WebGLBatch?this.batchs[r].render():n instanceof i.TilingSprite?n.visible&&this.renderTilingSprite(n,t):n instanceof i.Strip&&n.visible&&this.renderStrip(n,t)},i.WebGLRenderGroup.prototype.renderSpecific=function(t,e){i.WebGLRenderer.updateTextures();var n=this.gl;this.checkVisibility(t,t.visible),n.uniformMatrix4fv(i.shaderProgram.mvMatrixUniform,!1,e);var r,o,a,s,h=t.renderable?t:this.getNextRenderable(t),u=h.batch;if(h instanceof i.Sprite){u=h.batch;var c=u.head;if(c==h)r=0;else for(r=1;c.__next!=h;)r++,c=c.__next}else u=h;for(var l,d=t,f=t;f.children.length>0;)f=f.children[f.children.length-1],f.renderable&&(d=f);if(d instanceof i.Sprite){l=d.batch;var c=l.head;if(c==d)a=0;else for(a=1;c.__next!=d;)a++,c=c.__next}else l=d;if(u==l)return u instanceof i.WebGLBatch?u.render(r,a+1):u instanceof i.TilingSprite?u.visible&&this.renderTilingSprite(u,e):u instanceof i.Strip?u.visible&&this.renderStrip(u,e):u instanceof i.CustomRenderable&&u.visible&&u.renderWebGL(this,e),void 0;o=this.batchs.indexOf(u),s=this.batchs.indexOf(l),u instanceof i.WebGLBatch?u.render(r):u instanceof i.TilingSprite?u.visible&&this.renderTilingSprite(u,e):u instanceof i.Strip?u.visible&&this.renderStrip(u,e):u instanceof i.CustomRenderable&&u.visible&&u.renderWebGL(this,e);for(var p=o+1;s>p;p++)renderable=this.batchs[p],renderable instanceof i.WebGLBatch?this.batchs[p].render():renderable instanceof i.TilingSprite?renderable.visible&&this.renderTilingSprite(renderable,e):renderable instanceof i.Strip?renderable.visible&&this.renderStrip(renderable,e):renderable instanceof i.CustomRenderable&&renderable.visible&&renderable.renderWebGL(this,e);l instanceof i.WebGLBatch?l.render(0,a+1):l instanceof i.TilingSprite?l.visible&&this.renderTilingSprite(l):l instanceof i.Strip?l.visible&&this.renderStrip(l):l instanceof i.CustomRenderable&&l.visible&&l.renderWebGL(this,e)},i.WebGLRenderGroup.prototype.checkVisibility=function(t,e){for(var n=t.children,i=0;i<n.length;i++){var r=n[i];r.worldVisible=r.visible&&e,r.textureChange&&(r.textureChange=!1,r.worldVisible&&(this.removeDisplayObject(r),this.addDisplayObject(r))),r.children.length>0&&this.checkVisibility(r,r.worldVisible)}},i.WebGLRenderGroup.prototype.updateTexture=function(t){if(1==t.batch.length)return t.batch.texture=t.texture.baseTexture,void 0;if(t.batch.texture!=t.texture.baseTexture)if(t.batch.head==t){var e=t.batch,n=this.batchs.indexOf(e),r=this.batchs[n-1];if(e.remove(t),r)if(r.texture==t.texture.baseTexture&&r.blendMode==t.blendMode)r.insertAfter(t,r.tail);else{var o=i.WebGLRenderer.getBatch();o.init(t),this.batchs.splice(n-1,0,o)}else{var o=i.WebGLRenderer.getBatch();o.init(t),this.batchs.splice(0,0,o)}}else if(t.batch.tail==t){var e=t.batch,n=this.batchs.indexOf(e),a=this.batchs[n+1];if(e.remove(t),a){if(a.texture==t.texture.baseTexture&&a.blendMode==t.blendMode)return a.insertBefore(t,a.head),void 0;var o=i.WebGLRenderer.getBatch();o.init(t),this.batchs.splice(n+1,0,o)}else{var o=i.WebGLRenderer.getBatch();o.init(t),this.batchs.push(o)}}else{var e=t.batch,s=e.split(t);s.remove(t);var o=i.WebGLRenderer.getBatch(),n=this.batchs.indexOf(e);o.init(t),this.batchs.splice(n+1,0,o,s)}},i.WebGLRenderGroup.prototype.addDisplayObject=function(t){if(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),t.__renderGroup=this,t.renderable){var e=this.getPreviousRenderable(t),n=this.getNextRenderable(t);if(t instanceof i.Sprite){var r,o;if(e instanceof i.Sprite){if(r=e.batch,r&&r.texture==t.texture.baseTexture&&r.blendMode==t.blendMode)return r.insertAfter(t,e),void 0}else r=e;if(n)if(n instanceof i.Sprite){if(o=n.batch){if(o.texture==t.texture.baseTexture&&o.blendMode==t.blendMode)return o.insertBefore(t,n),void 0;if(o==r){var a=r.split(n),s=i.WebGLRenderer.getBatch(),h=this.batchs.indexOf(r);return s.init(t),this.batchs.splice(h+1,0,s,a),void 0}}}else o=n;var s=i.WebGLRenderer.getBatch();if(s.init(t),r){var h=this.batchs.indexOf(r);this.batchs.splice(h+1,0,s)}else this.batchs.push(s)}else t instanceof i.TilingSprite?(this.initTilingSprite(t),this.batchs.push(t)):t instanceof i.Strip&&(this.initStrip(t),this.batchs.push(t));this.batchUpdate=!0}},i.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(t){this.addDisplayObject(t);for(var e=t.children,n=0;n<e.length;n++)this.addDisplayObjectAndChildren(e[n])},i.WebGLRenderGroup.prototype.removeDisplayObject=function(t){if(t.__renderGroup=null,t.renderable){var e;if(t instanceof i.Sprite){var n=t.batch;if(!n)return;n.remove(t),0==n.size&&(e=n)}else e=t;if(e){var r=this.batchs.indexOf(e);if(-1==r)return;if(0==r||r==this.batchs.length-1)return this.batchs.splice(r,1),e instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(e),void 0;if(this.batchs[r-1]instanceof i.WebGLBatch&&this.batchs[r+1]instanceof i.WebGLBatch&&this.batchs[r-1].texture==this.batchs[r+1].texture&&this.batchs[r-1].blendMode==this.batchs[r+1].blendMode)return this.batchs[r-1].merge(this.batchs[r+1]),e instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(e),i.WebGLRenderer.returnBatch(this.batchs[r+1]),this.batchs.splice(r,2),void 0;this.batchs.splice(r,1),e instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(e)}}},i.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(t){if(t.__renderGroup==this){this.removeDisplayObject(t);for(var e=t.children,n=0;n<e.length;n++)this.removeDisplayObjectAndChildren(e[n])}},i.WebGLRenderGroup.prototype.getNextRenderable=function(t){var e=t;do{if(0==e.children.length){if(!e.parent)return null;for(;e.childIndex==e.parent.children.length-1;)if(e=e.parent,e==this.root||!e.parent){e=null;break}e&&(e=e.parent.children[e.childIndex+1])}else e=e.children[0];if(!e)break}while(!e.renderable||!e.__renderGroup);return e},i.WebGLRenderGroup.prototype.getPreviousRenderable=function(t){var e=t;do{if(0==e.childIndex){if(e=e.parent,!e)return null}else for(e=e.parent.children[e.childIndex-1];0!=e.children.length;)e=e.children[e.children.length-1];if(e==this.root)break}while(!e.renderable||!e.__renderGroup);return e},i.WebGLRenderGroup.prototype.initTilingSprite=function(t){var e=this.gl;t.verticies=new Float32Array([0,0,t.width,0,t.width,t.height,0,t.height]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.colors=new Float32Array([1,1,1,1]),t.indices=new Uint16Array([0,1,3,2]),t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.verticies,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW),t.texture.baseTexture._glTexture?(e.bindTexture(e.TEXTURE_2D,t.texture.baseTexture._glTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),t.texture.baseTexture._powerOf2=!0):t.texture.baseTexture._powerOf2=!0},i.WebGLRenderGroup.prototype.renderStrip=function(t,e){var n=this.gl,r=i.shaderProgram,o=i.mat3.toMat4(t.worldTransform);i.mat4.transpose(o),i.mat4.multiply(e,o,o),n.uniformMatrix4fv(r.mvMatrixUniform,!1,o),t.blendMode==i.blendModes.NORMAL?n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA):n.blendFunc(n.ONE,n.ONE_MINUS_SRC_COLOR),t.dirty?(t.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,t._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,t.verticies,n.STATIC_DRAW),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,t._uvBuffer),n.bufferData(n.ARRAY_BUFFER,t.uvs,n.STATIC_DRAW),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,t._colorBuffer),n.bufferData(n.ARRAY_BUFFER,t.colors,n.STATIC_DRAW),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,t._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,t.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,t._uvBuffer),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,t._colorBuffer),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t._indexBuffer)),n.drawElements(n.TRIANGLE_STRIP,t.indices.length,n.UNSIGNED_SHORT,0),n.uniformMatrix4fv(r.mvMatrixUniform,!1,e)},i.WebGLRenderGroup.prototype.renderTilingSprite=function(t,e){var n=this.gl;i.shaderProgram;var r=t.tilePosition,o=t.tileScale,a=r.x/t.texture.baseTexture.width,s=r.y/t.texture.baseTexture.height,h=t.width/t.texture.baseTexture.width/o.x,u=t.height/t.texture.baseTexture.height/o.y;t.uvs[0]=0-a,t.uvs[1]=0-s,t.uvs[2]=1*h-a,t.uvs[3]=0-s,t.uvs[4]=1*h-a,t.uvs[5]=1*u-s,t.uvs[6]=0-a,t.uvs[7]=1*u-s,n.bindBuffer(n.ARRAY_BUFFER,t._uvBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,t.uvs),this.renderStrip(t,e)},i.WebGLRenderGroup.prototype.initStrip=function(t){var e=this.gl;this.shaderProgram,t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.verticies,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW)},i.CanvasRenderer=function(t,e,n,i){this.transparent=i,this.width=t||800,this.height=e||600,this.refresh=!0,this.view=n||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.count=0,this.context=this.view.getContext("2d")},i.CanvasRenderer.constructor=i.CanvasRenderer,i.CanvasRenderer.prototype.render=function(t){i.texturesToUpdate=[],i.texturesToDestroy=[],t.updateTransform(),this.view.style.backgroundColor==t.backgroundColorString||this.transparent||(this.view.style.backgroundColor=t.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(t),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0&&(i.Texture.frameUpdates=[])},i.CanvasRenderer.prototype.resize=function(t,e){this.width=t,this.height=e,this.view.width=t,this.view.height=e},i.CanvasRenderer.prototype.renderDisplayObject=function(t){var e=t.worldTransform,n=this.context;if(t.visible){if(t instanceof i.Sprite){var r=t.texture.frame;r&&(n.globalAlpha=t.worldAlpha,n.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),n.drawImage(t.texture.baseTexture.source,r.x,r.y,r.width,r.height,t.anchor.x*-r.width,t.anchor.y*-r.height,r.width,r.height))}else t instanceof i.Strip?(n.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this.renderStrip(t)):t instanceof i.TilingSprite?(n.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this.renderTilingSprite(t)):t instanceof i.CustomRenderable&&t.renderCanvas(this);if(t.children)for(var o=0;o<t.children.length;o++)this.renderDisplayObject(t.children[o]);this.context.setTransform(1,0,0,1,0,0)}},i.CanvasRenderer.prototype.renderStripFlat=function(t){var e=this.context,n=t.verticies;t.uvs;var i=n.length/2;this.count++,e.beginPath();for(var r=1;i-2>r;r++){var o=2*r,a=n[o],s=n[o+2],h=n[o+4],u=n[o+1],c=n[o+3],l=n[o+5];e.moveTo(a,u),e.lineTo(s,c),e.lineTo(h,l)}e.fillStyle="#FF0000",e.fill(),e.closePath()},i.CanvasRenderer.prototype.renderTilingSprite=function(t){var e=this.context;t.__tilePattern||(t.__tilePattern=e.createPattern(t.texture.baseTexture.source,"repeat")),e.beginPath();
var n=t.tilePosition,i=t.tileScale;e.scale(i.x,i.y),e.translate(n.x,n.y),e.fillStyle=t.__tilePattern,e.fillRect(-n.x,-n.y,t.width/i.x,t.height/i.y),e.scale(1/i.x,1/i.y),e.translate(-n.x,-n.y),e.closePath()},i.CanvasRenderer.prototype.renderStrip=function(t){var e=this.context,n=t.verticies,i=t.uvs,r=n.length/2;this.count++;for(var o=1;r-2>o;o++){var a=2*o,s=n[a],h=n[a+2],u=n[a+4],c=n[a+1],l=n[a+3],d=n[a+5],f=i[a]*t.texture.width,p=i[a+2]*t.texture.width,m=i[a+4]*t.texture.width,v=i[a+1]*t.texture.height,g=i[a+3]*t.texture.height,x=i[a+5]*t.texture.height;e.save(),e.beginPath(),e.moveTo(s,c),e.lineTo(h,l),e.lineTo(u,d),e.closePath(),e.clip();var y=f*g+v*m+p*x-g*m-v*p-f*x,b=s*g+v*u+h*x-g*u-v*h-s*x,w=f*h+s*m+p*u-h*m-s*p-f*u,T=f*g*u+v*h*m+s*p*x-s*g*m-v*p*u-f*h*x,_=c*g+v*d+l*x-g*d-v*l-c*x,A=f*l+c*m+p*d-l*m-c*p-f*d,R=f*g*d+v*l*m+c*p*x-c*g*m-v*p*d-f*l*x;e.transform(b/y,_/y,w/y,A/y,T/y,R/y),e.drawImage(t.texture.baseTexture.source,0,0),e.restore()}},i.Strip=function(t,e,n){i.DisplayObjectContainer.call(this),this.texture=t,this.blendMode=i.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(r){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=e,this.height=n,t.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Strip.constructor=i.Strip,i.Strip.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Strip.prototype.setTexture=function(t){this.texture=t,this.width=t.frame.width,this.height=t.frame.height,this.updateFrame=!0},i.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Rope=function(t,e){i.Strip.call(this,t),this.points=e;try{this.verticies=new Float32Array(4*e.length),this.uvs=new Float32Array(4*e.length),this.colors=new Float32Array(2*e.length),this.indices=new Uint16Array(2*e.length)}catch(n){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},i.Rope.constructor=i.Rope,i.Rope.prototype=Object.create(i.Strip.prototype),i.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,n=this.indices,i=this.colors,r=t[0],o=t[0];this.count-=.2,e[0]=0,e[1]=1,e[2]=0,e[3]=1,i[0]=1,i[1]=1,n[0]=0,n[1]=1;for(var a=t.length,s=1;a>s;s++){var o=t[s],h=4*s,u=s/(a-1);s%2?(e[h]=u,e[h+1]=0,e[h+2]=u,e[h+3]=1):(e[h]=u,e[h+1]=0,e[h+2]=u,e[h+3]=1),h=2*s,i[h]=1,i[h+1]=1,h=2*s,n[h]=h,n[h+1]=h+1,r=o}}},i.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var e,n=this.verticies,r=t[0],o={x:0,y:0},a=t[0];this.count-=.2,n[0]=a.x+o.x,n[1]=a.y+o.y,n[2]=a.x-o.x,n[3]=a.y-o.y;for(var s=t.length,h=1;s>h;h++){var a=t[h],u=4*h;e=h<t.length-1?t[h+1]:a,o.y=-(e.x-r.x),o.x=e.y-r.y;var c=10*(1-h/(s-1));c>1&&(c=1);var l=Math.sqrt(o.x*o.x+o.y*o.y),d=this.texture.height/2;o.x/=l,o.y/=l,o.x*=d,o.y*=d,n[u]=a.x+o.x,n[u+1]=a.y+o.y,n[u+2]=a.x-o.x,n[u+3]=a.y-o.y,r=a}i.DisplayObjectContainer.prototype.updateTransform.call(this)}},i.Rope.prototype.setTexture=function(t){this.texture=t,this.updateFrame=!0},i.TilingSprite=function(t,e,n){i.DisplayObjectContainer.call(this),this.texture=t,this.width=e,this.height=n,this.renderable=!0,this.tileScale=new i.Point(1,1),this.tilePosition=new i.Point(0,0),this.blendMode=i.blendModes.NORMAL},i.TilingSprite.constructor=i.TilingSprite,i.TilingSprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.TilingSprite.prototype.setTexture=function(t){this.texture=t,this.updateFrame=!0},i.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Spine=function(t){if(i.DisplayObjectContainer.call(this),this.spineData=i.AnimCache[t],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+t);this.count=0,this.sprites=[],this.skeleton=new c.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new c.AnimationStateData(this.spineData),this.state=new c.AnimationState(this.stateData);for(var e=0;e<this.skeleton.drawOrder.length;e++){var n=this.skeleton.drawOrder[e].data.attachmentName;i.TextureCache[n]||(n+=".png");var r=new i.Sprite(i.Texture.fromFrame(n));r.anchor.x=r.anchor.y=.5,this.addChild(r),this.sprites.push(r)}},i.Spine.constructor=i.Spine,i.Spine.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Spine.prototype.updateTransform=function(){this.state.update(1/60),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var t=0;t<this.skeleton.drawOrder.length;t++){var e=this.skeleton.drawOrder[t],n=e.bone.worldX+e.attachment.x*e.bone.m00+e.attachment.y*e.bone.m01+.5*e.attachment.width,r=e.bone.worldY+e.attachment.x*e.bone.m10+e.attachment.y*e.bone.m11+.5*e.attachment.height;if(e.cacheName!=e.attachment.name){var o=e.attachment.name;i.TextureCache[o]||(o+=".png"),this.sprites[t].setTexture(i.TextureCache[o]),e.cacheName=e.attachment.name}n+=-(e.attachment.width*(e.bone.worldScaleX+e.attachment.scaleX-1)>>1),r+=-(e.attachment.height*(e.bone.worldScaleY+e.attachment.scaleY-1)>>1),this.sprites[t].position.x=n,this.sprites[t].position.y=r,this.sprites[t].rotation=-(e.bone.worldRotation+e.attachment.rotation)*(Math.PI/180)}i.DisplayObjectContainer.prototype.updateTransform.call(this)};var c={};c.BoneData=function(t,e){this.name=t,this.parent=e},c.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},c.SlotData=function(t,e){this.name=t,this.boneData=e},c.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},c.Bone=function(t,e){this.data=t,this.parent=e,this.setToSetupPose()},c.Bone.yDown=!1,c.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(t,e){var n=this.parent;null!=n?(this.worldX=this.x*n.m00+this.y*n.m01+n.worldX,this.worldY=this.x*n.m10+this.y*n.m11+n.worldY,this.worldScaleX=n.worldScaleX*this.scaleX,this.worldScaleY=n.worldScaleY*this.scaleY,this.worldRotation=n.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var i=this.worldRotation*Math.PI/180,r=Math.cos(i),o=Math.sin(i);this.m00=r*this.worldScaleX,this.m10=o*this.worldScaleX,this.m01=-o*this.worldScaleY,this.m11=r*this.worldScaleY,t&&(this.m00=-this.m00,this.m01=-this.m01),e&&(this.m10=-this.m10,this.m11=-this.m11),c.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY}},c.Slot=function(t,e,n){this.data=t,this.skeleton=e,this.bone=n,this.setToSetupPose()},c.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(t){this.attachment=t,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(t){this._attachmentTime=this.skeleton.time-t},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.skeleton.data.slots,n=0,i=e.length;i>n;n++)if(e[n]==t){this.setAttachment(t.attachmentName?this.skeleton.getAttachmentBySlotIndex(n,t.attachmentName):null);break}}},c.Skin=function(t){this.name=t,this.attachments={}},c.Skin.prototype={addAttachment:function(t,e,n){this.attachments[t+":"+e]=n},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var n in e.attachments){var i=n.indexOf(":"),r=parseInt(n.substring(0,i)),o=n.substring(i+1),a=t.slots[r];if(a.attachment&&a.attachment.name==o){var s=this.getAttachment(r,o);s&&a.setAttachment(s)}}}},c.Animation=function(t,e,n){this.name=t,this.timelines=e,this.duration=n},c.Animation.prototype={apply:function(t,e,n){n&&0!=this.duration&&(e%=this.duration);for(var i=this.timelines,r=0,o=i.length;o>r;r++)i[r].apply(t,e,1)},mix:function(t,e,n,i){n&&0!=this.duration&&(e%=this.duration);for(var r=this.timelines,o=0,a=r.length;a>o;o++)r[o].apply(t,e,i)}},c.binarySearch=function(t,e,n){var i=0,r=Math.floor(t.length/n)-2;if(0==r)return n;for(var o=r>>>1;;){if(t[(o+1)*n]<=e?i=o+1:r=o,i==r)return(i+1)*n;o=i+r>>>1}},c.linearSearch=function(t,e,n){for(var i=0,r=t.length-n;r>=i;i+=n)if(t[i]>e)return i;return-1},c.Curves=function(t){this.curves=[],this.curves.length=6*(t-1)},c.Curves.prototype={setLinear:function(t){this.curves[6*t]=0},setStepped:function(t){this.curves[6*t]=-1},setCurve:function(t,e,n,i,r){var o=.1,a=o*o,s=a*o,h=3*o,u=3*a,c=6*a,l=6*s,d=2*-e+i,f=2*-n+r,p=3*(e-i)+1,m=3*(n-r)+1,v=6*t,g=this.curves;g[v]=e*h+d*u+p*s,g[v+1]=n*h+f*u+m*s,g[v+2]=d*c+p*l,g[v+3]=f*c+m*l,g[v+4]=p*l,g[v+5]=m*l},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var n=6*t,i=this.curves,r=i[n];if(!r)return e;if(-1==r)return 0;for(var o=i[n+1],a=i[n+2],s=i[n+3],h=i[n+4],u=i[n+5],c=r,l=o,d=8;;){if(c>=e){var f=c-r,p=l-o;return p+(l-p)*(e-f)/(c-f)}if(0==d)break;d--,r+=a,o+=s,a+=h,s+=u,c+=r,l+=o}return l+(1-l)*(e-c)/(1-c)}},c.RotateTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=2*t},c.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,n){t*=2,this.frames[t]=e,this.frames[t+1]=n},apply:function(t,e,n){var i=this.frames;if(!(e<i[0])){var r=t.bones[this.boneIndex];if(e>=i[i.length-2]){for(var o=r.data.rotation+i[i.length-1]-r.rotation;o>180;)o-=360;for(;-180>o;)o+=360;return r.rotation+=o*n,void 0}var a=c.binarySearch(i,e,2),s=i[a-1],h=i[a],u=1-(e-h)/(i[a-2]-h);u=this.curves.getCurvePercent(a/2-1,u);for(var o=i[a+1]-s;o>180;)o-=360;for(;-180>o;)o+=360;for(o=r.data.rotation+(s+o*u)-r.rotation;o>180;)o-=360;for(;-180>o;)o+=360;r.rotation+=o*n}}},c.TranslateTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=3*t},c.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,n,i){t*=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i},apply:function(t,e,n){var i=this.frames;if(!(e<i[0])){var r=t.bones[this.boneIndex];if(e>=i[i.length-3])return r.x+=(r.data.x+i[i.length-2]-r.x)*n,r.y+=(r.data.y+i[i.length-1]-r.y)*n,void 0;var o=c.binarySearch(i,e,3),a=i[o-2],s=i[o-1],h=i[o],u=1-(e-h)/(i[o+-3]-h);u=this.curves.getCurvePercent(o/3-1,u),r.x+=(r.data.x+a+(i[o+1]-a)*u-r.x)*n,r.y+=(r.data.y+s+(i[o+2]-s)*u-r.y)*n}}},c.ScaleTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=3*t},c.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,n,i){t*=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i},apply:function(t,e,n){var i=this.frames;if(!(e<i[0])){var r=t.bones[this.boneIndex];if(e>=i[i.length-3])return r.scaleX+=(r.data.scaleX-1+i[i.length-2]-r.scaleX)*n,r.scaleY+=(r.data.scaleY-1+i[i.length-1]-r.scaleY)*n,void 0;var o=c.binarySearch(i,e,3),a=i[o-2],s=i[o-1],h=i[o],u=1-(e-h)/(i[o+-3]-h);u=this.curves.getCurvePercent(o/3-1,u),r.scaleX+=(r.data.scaleX-1+a+(i[o+1]-a)*u-r.scaleX)*n,r.scaleY+=(r.data.scaleY-1+s+(i[o+2]-s)*u-r.scaleY)*n}}},c.ColorTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=5*t},c.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e){t*=5,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=g,this.frames[t+3]=b,this.frames[t+4]=a},apply:function(t,e,n){var i=this.frames;if(!(e<i[0])){var r=t.slots[this.slotIndex];if(e>=i[i.length-5]){var o=i.length-1;return r.r=i[o-3],r.g=i[o-2],r.b=i[o-1],r.a=i[o],void 0}var a=c.binarySearch(i,e,5),s=i[a-4],h=i[a-3],u=i[a-2],l=i[a-1],d=i[a],f=1-(e-d)/(i[a-5]-d);f=this.curves.getCurvePercent(a/5-1,f);var p=s+(i[a+1]-s)*f,m=h+(i[a+2]-h)*f,v=u+(i[a+3]-u)*f,g=l+(i[a+4]-l)*f;1>n?(r.r+=(p-r.r)*n,r.g+=(m-r.g)*n,r.b+=(v-r.b)*n,r.a+=(g-r.a)*n):(r.r=p,r.g=m,r.b=v,r.a=g)}}},c.AttachmentTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},c.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n},apply:function(t,e){var n=this.frames;if(!(e<n[0])){var i;i=e>=n[n.length-1]?n.length-1:c.binarySearch(n,e,1)-1;var r=this.attachmentNames[i];t.slots[this.slotIndex].setAttachment(r?t.getAttachmentBySlotIndex(this.slotIndex,r):null)}}},c.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},c.SkeletonData.prototype={defaultSkin:null,findBone:function(t){for(var e=this.bones,n=0,i=e.length;i>n;n++)if(e[n].name==t)return e[n];return null},findBoneIndex:function(t){for(var e=this.bones,n=0,i=e.length;i>n;n++)if(e[n].name==t)return n;return-1},findSlot:function(t){for(var e=this.slots,n=0,i=e.length;i>n;n++)if(e[n].name==t)return slot[n];return null},findSlotIndex:function(t){for(var e=this.slots,n=0,i=e.length;i>n;n++)if(e[n].name==t)return n;return-1},findSkin:function(t){for(var e=this.skins,n=0,i=e.length;i>n;n++)if(e[n].name==t)return e[n];return null},findAnimation:function(t){for(var e=this.animations,n=0,i=e.length;i>n;n++)if(e[n].name==t)return e[n];return null}},c.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,n=t.bones.length;n>e;e++){var i=t.bones[e],r=i.parent?this.bones[t.bones.indexOf(i.parent)]:null;this.bones.push(new c.Bone(i,r))}this.slots=[],this.drawOrder=[];for(var e=0,n=t.slots.length;n>e;e++){var o=t.slots[e],a=this.bones[t.bones.indexOf(o.boneData)],s=new c.Slot(o,this,a);this.slots.push(s),this.drawOrder.push(s)}},c.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var t=this.flipX,e=this.flipY,n=this.bones,i=0,r=n.length;r>i;i++)n[i].updateWorldTransform(t,e)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,n=t.length;n>e;e++)t[e].setToSetupPose()},setSlotsToSetupPose:function(){for(var t=this.slots,e=0,n=t.length;n>e;e++)t[e].setToSetupPose(e)},getRootBone:function(){return 0==this.bones.length?null:this.bones[0]},findBone:function(t){for(var e=this.bones,n=0,i=e.length;i>n;n++)if(e[n].data.name==t)return e[n];return null},findBoneIndex:function(t){for(var e=this.bones,n=0,i=e.length;i>n;n++)if(e[n].data.name==t)return n;return-1},findSlot:function(t){for(var e=this.slots,n=0,i=e.length;i>n;n++)if(e[n].data.name==t)return e[n];return null},findSlotIndex:function(t){for(var e=this.slots,n=0,i=e.length;i>n;n++)if(e[n].data.name==t)return n;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){this.skin&&t&&t._attachAll(this,this.skin),this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var n=this.skin.getAttachment(t,e);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var n=this.slots,i=0,r=n.size;r>i;i++){var o=n[i];if(o.data.name==t){var a=null;if(e&&(a=this.getAttachment(i,e),null==a))throw"Attachment not found: "+e+", for slot: "+t;return o.setAttachment(a),void 0}}throw"Slot not found: "+t},update:function(t){time+=t}},c.AttachmentType={region:0},c.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},c.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,n,i,r){var o=this.uvs;r?(o[2]=t,o[3]=i,o[4]=t,o[5]=e,o[6]=n,o[7]=e,o[0]=n,o[1]=i):(o[0]=t,o[1]=i,o[2]=t,o[3]=e,o[4]=n,o[5]=e,o[6]=n,o[7]=i)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*t,i=-this.height/2*this.scaleY+this.regionOffsetY*e,r=n+this.regionWidth*t,o=i+this.regionHeight*e,a=this.rotation*Math.PI/180,s=Math.cos(a),h=Math.sin(a),u=n*s+this.x,c=n*h,l=i*s+this.y,d=i*h,f=r*s+this.x,p=r*h,m=o*s+this.y,v=o*h,g=this.offset;g[0]=u-d,g[1]=l+c,g[2]=u-v,g[3]=m+c,g[4]=f-v,g[5]=m+p,g[6]=f-d,g[7]=l+p},computeVertices:function(t,e,n,i){t+=n.worldX,e+=n.worldY;var r=n.m00,o=n.m01,a=n.m10,s=n.m11,h=this.offset;i[0]=h[0]*r+h[1]*o+t,i[1]=h[0]*a+h[1]*s+e,i[2]=h[2]*r+h[3]*o+t,i[3]=h[2]*a+h[3]*s+e,i[4]=h[4]*r+h[5]*o+t,i[5]=h[4]*a+h[5]*s+e,i[6]=h[6]*r+h[7]*o+t,i[7]=h[6]*a+h[7]*s+e}},c.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},c.AnimationStateData.prototype={setMixByName:function(t,e,n){var i=this.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.setMix(i,r,n)},setMix:function(t,e,n){this.animationToMixTime[t.name+":"+e.name]=n},getMix:function(t,e){var n=this.animationToMixTime[t.name+":"+e.name];return n?n:0}},c.AnimationState=function(t){this.data=t,this.queue=[]},c.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(t){if(this.currentTime+=t,this.previousTime+=t,this.mixTime+=t,this.queue.length>0){var e=this.queue[0];this.currentTime>=e.delay&&(this._setAnimation(e.animation,e.loop),this.queue.shift())}},apply:function(t){if(this.current)if(this.previous){this.previous.apply(t,this.previousTime,this.previousLoop);var e=this.mixTime/this.mixDuration;e>=1&&(e=1,this.previous=null),this.current.mix(t,this.currentTime,this.currentLoop,e)}else this.current.apply(t,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(t,e){this.previous=null,t&&this.current&&(this.mixDuration=this.data.getMix(this.current,t),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=t,this.currentLoop=e,this.currentTime=0},setAnimationByName:function(t,e){var n=this.data.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;this.setAnimation(n,e)},setAnimation:function(t,e){this.queue.length=0,this._setAnimation(t,e)},addAnimationByName:function(t,e,n){var i=this.data.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.addAnimation(i,e,n)},addAnimation:function(t,e,n){var i={};if(i.animation=t,i.loop=e,!n||0>=n){var r=0==this.queue.length?this.current:this.queue[this.queue.length-1].animation;n=null!=r?r.duration-this.data.getMix(r,t)+(n||0):0}i.delay=n,this.queue.push(i)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},c.SkeletonJson=function(t){this.attachmentLoader=t},c.SkeletonJson.prototype={scale:1,readSkeletonData:function(t){for(var e=new c.SkeletonData,n=t.bones,i=0,r=n.length;r>i;i++){var o=n[i],a=null;if(o.parent&&(a=e.findBone(o.parent),!a))throw"Parent bone not found: "+o.parent;var s=new c.BoneData(o.name,a);s.length=(o.length||0)*this.scale,s.x=(o.x||0)*this.scale,s.y=(o.y||0)*this.scale,s.rotation=o.rotation||0,s.scaleX=o.scaleX||1,s.scaleY=o.scaleY||1,e.bones.push(s)}for(var h=t.slots,i=0,r=h.length;r>i;i++){var u=h[i],s=e.findBone(u.bone);if(!s)throw"Slot bone not found: "+u.bone;var l=new c.SlotData(u.name,s),d=u.color;d&&(l.r=c.SkeletonJson.toColor(d,0),l.g=c.SkeletonJson.toColor(d,1),l.b=c.SkeletonJson.toColor(d,2),l.a=c.SkeletonJson.toColor(d,3)),l.attachmentName=u.attachment,e.slots.push(l)}var f=t.skins;for(var p in f)if(f.hasOwnProperty(p)){var m=f[p],v=new c.Skin(p);for(var g in m)if(m.hasOwnProperty(g)){var x=e.findSlotIndex(g),y=m[g];for(var b in y)if(y.hasOwnProperty(b)){var w=this.readAttachment(v,b,y[b]);null!=w&&v.addAttachment(x,b,w)}}e.skins.push(v),"default"==v.name&&(e.defaultSkin=v)}var T=t.animations;for(var _ in T)T.hasOwnProperty(_)&&this.readAnimation(_,T[_],e);return e},readAttachment:function(t,e,n){e=n.name||e;var i=c.AttachmentType[n.type||"region"],r=new c.RegionAttachment;return r.name=e,i==c.AttachmentType.region&&(r.x=(n.x||0)*this.scale,r.y=(n.y||0)*this.scale,r.scaleX=n.scaleX||1,r.scaleY=n.scaleY||1,r.rotation=n.rotation||0,r.width=(n.width||32)*this.scale,r.height=(n.height||32)*this.scale,r.updateOffset()),r},readAnimation:function(t,e,n){var i=[],r=0,o=e.bones;for(var a in o)if(o.hasOwnProperty(a)){var s=n.findBoneIndex(a);if(-1==s)throw"Bone not found: "+a;var h=o[a];for(var u in h)if(h.hasOwnProperty(u)){var l=h[u];if("rotate"==u){var d=new c.RotateTimeline(l.length);d.boneIndex=s;for(var f=0,p=0,m=l.length;m>p;p++){var v=l[p];d.setFrame(f,v.time,v.angle),c.SkeletonJson.readCurve(d,f,v),f++}i.push(d),r=Math.max(r,d.frames[2*d.getFrameCount()-2])}else{if("translate"!=u&&"scale"!=u)throw"Invalid timeline type for a bone: "+u+" ("+a+")";var d,g=1;"scale"==u?d=new c.ScaleTimeline(l.length):(d=new c.TranslateTimeline(l.length),g=this.scale),d.boneIndex=s;for(var f=0,p=0,m=l.length;m>p;p++){var v=l[p],x=(v.x||0)*g,y=(v.y||0)*g;d.setFrame(f,v.time,x,y),c.SkeletonJson.readCurve(d,f,v),f++}i.push(d),r=Math.max(r,d.frames[3*d.getFrameCount()-3])}}}var b=e.slots;for(var w in b)if(b.hasOwnProperty(w)){var T=b[w],_=n.findSlotIndex(w);for(var u in T)if(T.hasOwnProperty(u)){var l=T[u];if("color"==u){var d=new c.ColorTimeline(l.length);d.slotIndex=_;for(var f=0,p=0,m=l.length;m>p;p++){var v=l[p],A=v.color,R=c.SkeletonJson.toColor(A,0),S=c.SkeletonJson.toColor(A,1),E=c.SkeletonJson.toColor(A,2),C=c.SkeletonJson.toColor(A,3);d.setFrame(f,v.time,R,S,E,C),c.SkeletonJson.readCurve(d,f,v),f++}i.push(d),r=Math.max(r,d.frames[5*d.getFrameCount()-5])}else{if("attachment"!=u)throw"Invalid timeline type for a slot: "+u+" ("+w+")";var d=new c.AttachmentTimeline(l.length);d.slotIndex=_;for(var f=0,p=0,m=l.length;m>p;p++){var v=l[p];d.setFrame(f++,v.time,v.name)}i.push(d),r=Math.max(r,d.frames[Math.floor(d.getFrameCount())-1])}}}n.animations.push(new c.Animation(t,i,r))}},c.SkeletonJson.readCurve=function(t,e,n){var i=n.curve;i&&("stepped"==i?t.curves.setStepped(e):i instanceof Array&&t.curves.setCurve(e,i[0],i[1],i[2],i[3]))},c.SkeletonJson.toColor=function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2),16)/255},c.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var n=new c.AtlasReader(t),i=[];i.length=4;for(var r=null;;){var o=n.readLine();if(null==o)break;if(o=n.trim(o),0==o.length)r=null;else if(r){var a=new c.AtlasRegion;a.name=o,a.page=r,a.rotate="true"==n.readValue(),n.readTuple(i);var s=parseInt(i[0]),h=parseInt(i[1]);n.readTuple(i);var u=parseInt(i[0]),l=parseInt(i[1]);a.u=s/r.width,a.v=h/r.height,a.rotate?(a.u2=(s+l)/r.width,a.v2=(h+u)/r.height):(a.u2=(s+u)/r.width,a.v2=(h+l)/r.height),a.x=s,a.y=h,a.width=Math.abs(u),a.height=Math.abs(l),4==n.readTuple(i)&&(a.splits=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3])],4==n.readTuple(i)&&(a.pads=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3])],n.readTuple(i))),a.originalWidth=parseInt(i[0]),a.originalHeight=parseInt(i[1]),n.readTuple(i),a.offsetX=parseInt(i[0]),a.offsetY=parseInt(i[1]),a.index=parseInt(n.readValue()),this.regions.push(a)}else{r=new c.AtlasPage,r.name=o,r.format=c.Atlas.Format[n.readValue()],n.readTuple(i),r.minFilter=c.Atlas.TextureFilter[i[0]],r.magFilter=c.Atlas.TextureFilter[i[1]];var d=n.readValue();r.uWrap=c.Atlas.TextureWrap.clampToEdge,r.vWrap=c.Atlas.TextureWrap.clampToEdge,"x"==d?r.uWrap=c.Atlas.TextureWrap.repeat:"y"==d?r.vWrap=c.Atlas.TextureWrap.repeat:"xy"==d&&(r.uWrap=r.vWrap=c.Atlas.TextureWrap.repeat),e.load(r,o),this.pages.push(r)}}},c.Atlas.prototype={findRegion:function(t){for(var e=this.regions,n=0,i=e.length;i>n;n++)if(e[n].name==t)return e[n];return null},dispose:function(){for(var t=this.pages,e=0,n=t.length;n>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,n=0,i=e.length;i>n;n++){var r=e[n];r.page==t&&(r.u=r.x/t.width,r.v=r.y/t.height,r.rotate?(r.u2=(r.x+r.height)/t.width,r.v2=(r.y+r.width)/t.height):(r.u2=(r.x+r.width)/t.width,r.v2=(r.y+r.height)/t.height))}}},c.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},c.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},c.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},c.AtlasPage=function(){},c.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},c.AtlasRegion=function(){},c.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},c.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},c.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),n=e.indexOf(":");if(-1==n)throw"Invalid line: "+e;for(var i=0,r=n+1;3>i;i++){var o=e.indexOf(",",r);if(-1==o){if(0==i)throw"Invalid line: "+e;break}t[i]=this.trim(e.substr(r,o-r)),r=o+1}return t[i]=this.trim(e.substring(r)),i+1}},c.AtlasAttachmentLoader=function(t){this.atlas=t},c.AtlasAttachmentLoader.prototype={newAttachment:function(t,e,n){switch(e){case c.AttachmentType.region:var i=this.atlas.findRegion(n);if(!i)throw"Region not found in atlas: "+n+" ("+e+")";var r=new c.RegionAttachment(n);return r.rendererObject=i,r.setUVs(i.u,i.v,i.u2,i.v2,i.rotate),r.regionOffsetX=i.offsetX,r.regionOffsetY=i.offsetY,r.regionWidth=i.width,r.regionHeight=i.height,r.regionOriginalWidth=i.originalWidth,r.regionOriginalHeight=i.originalHeight,r}throw"Unknown attachment type: "+e}},i.AnimCache={},c.Bone.yDown=!0,i.CustomRenderable=function(){i.DisplayObject.call(this)},i.CustomRenderable.constructor=i.CustomRenderable,i.CustomRenderable.prototype=Object.create(i.DisplayObject.prototype),i.CustomRenderable.prototype.renderCanvas=function(){},i.CustomRenderable.prototype.initWebGL=function(){},i.CustomRenderable.prototype.renderWebGL=function(){},i.BaseTextureCache={},i.texturesToUpdate=[],i.texturesToDestroy=[],i.BaseTexture=function(t){if(i.EventTarget.call(this),this.width=100,this.height=100,this.source=t,t){if(this.source instanceof Image)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);else{var e=this;this.source.onload=function(){e.hasLoaded=!0,e.width=e.source.width,e.height=e.source.height,i.texturesToUpdate.push(e),e.dispatchEvent({type:"loaded",content:e})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);this._powerOf2=!1}},i.BaseTexture.constructor=i.BaseTexture,i.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,i.texturesToDestroy.push(this)},i.BaseTexture.fromImage=function(t,e){var n=i.BaseTextureCache[t];if(!n){var r=new Image;e&&(r.crossOrigin=""),r.src=t,n=new i.BaseTexture(r),i.BaseTextureCache[t]=n}return n},i.TextureCache={},i.FrameCache={},i.Texture=function(t,e){if(i.EventTarget.call(this),e||(this.noFrame=!0,e=new i.Rectangle(0,0,1,1)),this.trim=new i.Point,t instanceof i.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=e,this.scope=this,t.hasLoaded)this.noFrame&&(e=new i.Rectangle(0,0,t.width,t.height)),this.setFrame(e);else{var n=this;t.addEventListener("loaded",function(){n.onBaseTextureLoaded()})}},i.Texture.constructor=i.Texture,i.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new i.Rectangle(0,0,t.width,t.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},i.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy()},i.Texture.prototype.setFrame=function(t){if(this.frame=t,this.width=t.width,this.height=t.height,t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,i.Texture.frameUpdates.push(this)},i.Texture.fromImage=function(t,e){var n=i.TextureCache[t];return n||(n=new i.Texture(i.BaseTexture.fromImage(t,e)),i.TextureCache[t]=n),n},i.Texture.fromFrame=function(t){var e=i.TextureCache[t];if(!e)throw new Error("The frameId '"+t+"' does not exist in the texture cache "+this);return e},i.Texture.fromCanvas=function(t){var e=new i.BaseTexture(t);return new i.Texture(e)},i.Texture.addTextureToCache=function(t,e){i.TextureCache[e]=t},i.Texture.removeTextureFromCache=function(t){var e=i.TextureCache[t];return i.TextureCache[t]=null,e},i.Texture.frameUpdates=[],i.RenderTexture=function(t,e){i.EventTarget.call(this),this.width=t||100,this.height=e||100,this.indetityMatrix=i.mat3.create(),this.frame=new i.Rectangle(0,0,this.width,this.height),i.gl?this.initWebGL():this.initCanvas()},i.RenderTexture.constructor=i.RenderTexture,i.RenderTexture.prototype=Object.create(i.Texture.prototype),i.RenderTexture.prototype.initWebGL=function(){var t=i.gl;this.glFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new i.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.baseTexture._glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,t.bindFramebuffer(t.FRAMEBUFFER,this.glFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.baseTexture._glTexture,0),this.projectionMatrix=i.mat4.create(),this.projectionMatrix[5]=2/this.height,this.projectionMatrix[13]=-1,this.projectionMatrix[0]=2/this.width,this.projectionMatrix[12]=-1,this.render=this.renderWebGL},i.RenderTexture.prototype.initCanvas=function(){this.renderer=new i.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new i.BaseTexture(this.renderer.view),this.frame=new i.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},i.RenderTexture.prototype.renderWebGL=function(t,e){var n=i.gl;n.colorMask(!0,!0,!0,!0),n.viewport(0,0,this.width,this.height),n.bindFramebuffer(n.FRAMEBUFFER,this.glFramebuffer),e&&(n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT));var r=t.children;t.worldTransform=i.mat3.create();for(var o=0,a=r.length;a>o;o++)r[o].updateTransform();var s=t.__renderGroup;s?t==s.root?s.render(this.projectionMatrix):s.renderSpecific(t,this.projectionMatrix):(this.renderGroup||(this.renderGroup=new i.WebGLRenderGroup(n)),this.renderGroup.setRenderable(t),this.renderGroup.render(this.projectionMatrix))},i.RenderTexture.prototype.renderCanvas=function(t,e){var n=t.children;t.worldTransform=i.mat3.create();for(var r=0,o=n.length;o>r;r++)n[r].updateTransform();
e&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(t),i.texturesToUpdate.push(this.baseTexture)},i.AssetLoader=function(t){i.EventTarget.call(this),this.assetURLs=t,this.crossorigin=!1,this.loadersByType={jpg:i.ImageLoader,jpeg:i.ImageLoader,png:i.ImageLoader,gif:i.ImageLoader,json:i.JsonLoader,anim:i.SpineLoader,xml:i.BitmapFontLoader,fnt:i.BitmapFontLoader}},i.AssetLoader.constructor=i.AssetLoader,i.AssetLoader.prototype.load=function(){var t=this;this.loadCount=this.assetURLs.length;for(var e=0;e<this.assetURLs.length;e++){var n=this.assetURLs[e],i=n.split(".").pop().toLowerCase(),r=this.loadersByType[i];if(!r)throw new Error(i+" is an unsupported file type");var o=new r(n,this.crossorigin);o.addEventListener("loaded",function(){t.onAssetLoaded()}),o.load()}},i.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},i.JsonLoader=function(t,e){i.EventTarget.call(this),this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.crossorigin=e,this.loaded=!1},i.JsonLoader.constructor=i.JsonLoader,i.JsonLoader.prototype.load=function(){this.ajaxRequest=new u;var t=this;this.ajaxRequest.onreadystatechange=function(){t.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},i.JsonLoader.prototype.onJSONLoaded=function(){if(4==this.ajaxRequest.readyState)if(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var t=this,e=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(e,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(){t.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()}else if(this.json.bones){var s=new c.SkeletonJson,h=s.readSkeletonData(this.json);i.AnimCache[this.url]=h,this.onLoaded()}else this.onLoaded();else this.onError()},i.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},i.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},i.SpriteSheetLoader=function(t,e){i.EventTarget.call(this),this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={},this.crossorigin=e},i.SpriteSheetLoader.constructor=i.SpriteSheetLoader,i.SpriteSheetLoader.prototype.load=function(){var t=this,e=new i.JsonLoader(this.url,this.crossorigin);e.addEventListener("loaded",function(e){t.json=e.content.json,t.onJSONLoaded()}),e.load()},i.SpriteSheetLoader.prototype.onJSONLoaded=function(){var t=this,e=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(e,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(){t.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()},i.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.ImageLoader=function(t,e){i.EventTarget.call(this),this.texture=i.Texture.fromImage(t,e)},i.ImageLoader.constructor=i.ImageLoader,i.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var t=this;this.texture.baseTexture.addEventListener("loaded",function(){t.onLoaded()})}},i.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.BitmapFontLoader=function(t,e){i.EventTarget.call(this),this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.crossorigin=e},i.BitmapFontLoader.constructor=i.BitmapFontLoader,i.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var t=this;this.ajaxRequest.onreadystatechange=function(){t.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},i.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))){var t=this.baseUrl+this.ajaxRequest.responseXML.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue,e=new i.ImageLoader(t,this.crossorigin);this.texture=e.texture.baseTexture;var n={},r=this.ajaxRequest.responseXML.getElementsByTagName("info")[0],o=this.ajaxRequest.responseXML.getElementsByTagName("common")[0];n.font=r.attributes.getNamedItem("face").nodeValue,n.size=parseInt(r.attributes.getNamedItem("size").nodeValue,10),n.lineHeight=parseInt(o.attributes.getNamedItem("lineHeight").nodeValue,10),n.chars={};for(var a=this.ajaxRequest.responseXML.getElementsByTagName("char"),s=0;s<a.length;s++){var h=parseInt(a[s].attributes.getNamedItem("id").nodeValue,10),u={x:parseInt(a[s].attributes.getNamedItem("x").nodeValue,10),y:parseInt(a[s].attributes.getNamedItem("y").nodeValue,10),width:parseInt(a[s].attributes.getNamedItem("width").nodeValue,10),height:parseInt(a[s].attributes.getNamedItem("height").nodeValue,10)};i.TextureCache[h]=new i.Texture(this.texture,u),n.chars[h]={xOffset:parseInt(a[s].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(a[s].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(a[s].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new i.Texture(this.texture,u)}}var c=this.ajaxRequest.responseXML.getElementsByTagName("kerning");for(s=0;s<c.length;s++){var l=parseInt(c[s].attributes.getNamedItem("first").nodeValue,10),d=parseInt(c[s].attributes.getNamedItem("second").nodeValue,10),f=parseInt(c[s].attributes.getNamedItem("amount").nodeValue,10);n.chars[d].kerning[l]=f}i.BitmapText.fonts[n.font]=n;var p=this;e.addEventListener("loaded",function(){p.onLoaded()}),e.load()}},i.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.SpineLoader=function(t,e){i.EventTarget.call(this),this.url=t,this.crossorigin=e,this.loaded=!1},i.SpineLoader.constructor=i.SpineLoader,i.SpineLoader.prototype.load=function(){new i.JsonLoader(this.url,this.crossorigin),jsonLoader.addEventListener("loaded",function(t){scope.json=t.content.json,scope.onJSONLoaded()}),jsonLoader.load()},i.SpineLoader.prototype.load=function(){var t=this,e=new i.JsonLoader(this.url,this.crossorigin);e.addEventListener("loaded",function(e){t.json=e.content.json,t.onJSONLoaded()}),e.load()},i.SpineLoader.prototype.onJSONLoaded=function(){var t=new c.SkeletonJson,e=t.readSkeletonData(this.json);i.AnimCache[this.url]=e,this.onLoaded()},i.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.PIXI=i):n.PIXI=i}.call(this),define("PIXI",function(t){return function(){var e;return e||t.PIXI}}(this)),define("config",[],function(){return{width:1024,height:768,interactive:!0,background:14540253,renderTarget:document.body}}),define("utils/eventPublisher",[],function(){return function(t){function e(t){var e=0,i=n.length;for(e;i>e;e+=1)if(t===n[e])return!0;return!1}var n=[],i=0;if("[object Array]"!==Object.prototype.toString.apply(t))throw new TypeError("EventTypes argument isn't an array.");if(0===t.length)throw new Error("No elements within array!");for(i;i<t.length;i+=1)if("string"!=typeof t[i])throw new TypeError("EventType can only be strings within an array");return n=t,{subscribers:{any:[]},on:function(t,n,i){if(t=t||"any"){if(!e(t))throw new Error("Encountered unexpected eventtype: "+t+". Needs predefinition in publisher object.");t=t}else t="any";n="function"==typeof n?n:i[n],"undefined"==typeof this.subscribers[t]&&(this.subscribers[t]=[]),this.subscribers[t].push({fn:n,context:i||this})},remove:function(t,e,n){this.visitSubscribers("unsubscribe",t,e,n)},fire:function(t,e){this.visitSubscribers("publish",t,e)},visitSubscribers:function(t,e,n,i){var r,o=e||"any",a=this.subscribers[o],s=a?a.length:0,h=i?i:this;for(r=0;s>r;r+=1)"publish"===t?a[r].fn.call(a[r].targetContext,n):a[r].fn===n&&a[r].context===h&&a.splice(r,1)}}}}),define("displayController",["PIXI","config","utils/eventPublisher"],function(t,e,n){function i(){requestAnimFrame(i),h.fire("renderFrame"),o.render(r),s+=1}var r=new t.Stage(e.background,e.interactive),o=t.autoDetectRenderer(e.width,e.height),a=e.renderTarget,s=0,h=n(["renderFrame","debugInfo"]);return function(){console.log("display: init"),a.appendChild(o.view),requestAnimFrame(i)}(),setInterval(function(){var t=s/2,e="display: received "+s+" frames @ "+t+"fps.";h.fire("debugInfo",e),s=0},2e3),{stage:r,events:h}}),function(t,e,n){function i(n,o){if(!e[n]){if(!t[n]){var a="function"==typeof require&&require;if(!o&&a)return a(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var s=e[n]={exports:{}};t[n][0].call(s.exports,function(e){var r=t[n][1][e];return i(r?r:e)},s,s.exports)}return e[n].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,e){var n=t("./protocol").chooseProtocol,i=t("events").EventEmitter,r=t("underscore"),o=e.exports=function(t){this.opts=r.defaults(t||{},{host:"127.0.0.1",enableGestures:!1,port:6437,enableHeartbeat:!0,heartbeatInterval:100,requestProtocolVersion:3}),this.host=this.opts.host,this.port=this.opts.port,this.on("ready",function(){this.enableGestures(this.opts.enableGestures),this.opts.enableHeartbeat&&this.startHeartbeat()}),this.on("disconnect",function(){this.opts.enableHeartbeat&&this.stopHeartbeat()}),this.heartbeatTimer=null};o.prototype.getUrl=function(){return"ws://"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"},o.prototype.sendHeartbeat=function(){this.protocol&&(this.setHeartbeatState(!0),this.protocol.sendHeartbeat(this))},o.prototype.handleOpen=function(){this.emit("connect")},o.prototype.enableGestures=function(t){this.gesturesEnabled=t?!0:!1,this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))},o.prototype.handleClose=function(){this.disconnect(),this.startReconnection()},o.prototype.startReconnection=function(){var t=this;setTimeout(function(){t.connect()},1e3)},o.prototype.disconnect=function(){this.socket&&(this.socket.close(),delete this.socket,delete this.protocol,this.emit("disconnect"))},o.prototype.handleData=function(t){var e,i=JSON.parse(t);void 0===this.protocol?(e=this.protocol=n(i),this.emit("ready")):e=this.protocol(i),this.emit(e.type,e)},o.prototype.connect=function(){return this.socket?void 0:(this.socket=this.setupSocket(),!0)},o.prototype.send=function(t){this.socket.send(t)},o.prototype.stopHeartbeat=function(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),delete this.heartbeatTimer,this.setHeartbeatState(!1))},o.prototype.setHeartbeatState=function(t){this.heartbeatState!==t&&(this.heartbeatState=t,this.emit(this.heartbeatState?"focus":"blur"))},r.extend(o.prototype,i.prototype)},{"./protocol":12,events:17,underscore:20}],2:[function(t,e){var n=e.exports=function(t){this.pos=0,this._buf=[],this.size=t};n.prototype.get=function(t){return void 0==t&&(t=0),t>=this.size?void 0:t>=this._buf.length?void 0:this._buf[(this.pos-t-1)%this.size]},n.prototype.push=function(t){return this._buf[this.pos%this.size]=t,this.pos++}},{}],3:[function(t,e){var n=e.exports=t("./base_connection");n.prototype.setupSocket=function(){var t=this,e=new WebSocket(this.getUrl());return e.onopen=function(){t.handleOpen()},e.onmessage=function(e){t.handleData(e.data)},e.onclose=function(){t.handleClose()},e},n.prototype.startHeartbeat=function(){if(this.protocol.sendHeartbeat&&!this.heartbeatTimer){var t=this,e=null;e="undefined"!=typeof document.hidden?"hidden":"undefined"!=typeof document.mozHidden?"mozHidden":"undefined"!=typeof document.msHidden?"msHidden":"undefined"!=typeof document.webkitHidden?"webkitHidden":void 0;var n=!0,i=window.addEventListener("focus",function(){n=!0}),r=window.addEventListener("blur",function(){n=!1});this.on("disconnect",function(){t.heartbeatTimer&&(clearTimeout(t.heartbeatTimer),delete t.heartbeatTimer),window.removeEventListener(i),window.removeEventListener(r)}),this.heartbeatTimer=setInterval(function(){var i=void 0===e?!0:document[e]===!1;i&&n?t.sendHeartbeat():t.setHeartbeatState(!1)},this.opts.heartbeatInterval)}}},{"./base_connection":1}],4:[function(t,e){!function(n){var i=t("./frame"),r=t("./circular_buffer"),o=t("./pipeline"),a=t("events").EventEmitter,s=t("./gesture").gestureListener,h=t("underscore"),u=e.exports=function(e){var o="undefined"!=typeof n&&"node"===n.title;e=h.defaults(e||{},{inNode:o}),this.inNode=e.inNode,e=h.defaults(e||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",supressAnimationLoop:!1}),this.supressAnimationLoop=e.supressAnimationLoop,this.frameEventName=e.frameEventName,this.history=new r(200),this.lastFrame=i.Invalid,this.lastValidFrame=i.Invalid,this.lastConnectionFrame=i.Invalid,this.accumulatedGestures=[],this.connectionType=void 0===e.connectionType?this.inBrowser()?t("./connection"):t("./node_connection"):e.connectionType,this.connection=new this.connectionType(e),this.setupConnectionEvents()};u.prototype.gesture=function(t,e){var n=s(this,t);return void 0!==e&&n.stop(e),n},u.prototype.inBrowser=function(){return!this.inNode},u.prototype.useAnimationLoop=function(){return this.inBrowser()&&"undefined"==typeof chrome},u.prototype.connect=function(){var t=this;if(this.connection.connect()&&this.inBrowser()&&!t.supressAnimationLoop){var e=function(){t.emit("animationFrame",t.lastConnectionFrame),window.requestAnimFrame(e)};window.requestAnimFrame(e)}},u.prototype.disconnect=function(){this.connection.disconnect()},u.prototype.frame=function(t){return this.history.get(t)||i.Invalid},u.prototype.loop=function(t){switch(t.length){case 1:this.on(this.frameEventName,t);break;case 2:var e=this,n=function(i){t(i,function(){e.lastFrame!=i?n(e.lastFrame):e.once(e.frameEventName,n)})};this.once(this.frameEventName,n)}this.connect()},u.prototype.addStep=function(t){this.pipeline||(this.pipeline=new o(this)),this.pipeline.addStep(t)},u.prototype.processFrame=function(t){t.gestures&&(this.accumulatedGestures=this.accumulatedGestures.concat(t.gestures)),this.pipeline&&(t=this.pipeline.run(t),t||(t=i.Invalid)),this.lastConnectionFrame=t,this.emit("deviceFrame",t)},u.prototype.processFinishedFrame=function(t){if(this.lastFrame=t,t.valid&&(this.lastValidFrame=t),t.controller=this,t.historyIdx=this.history.push(t),t.gestures){t.gestures=this.accumulatedGestures,this.accumulatedGestures=[];for(var e=0;e!=t.gestures.length;e++)this.emit("gesture",t.gestures[e],t)}this.emit("frame",t)},u.prototype.setupConnectionEvents=function(){var t=this;this.connection.on("frame",function(e){t.processFrame(e)}),this.on(this.frameEventName,function(e){t.processFinishedFrame(e)}),this.connection.on("disconnect",function(){t.emit("disconnect")}),this.connection.on("ready",function(){t.emit("ready")}),this.connection.on("connect",function(){t.emit("connect")}),this.connection.on("focus",function(){t.emit("focus")}),this.connection.on("blur",function(){t.emit("blur")}),this.connection.on("protocol",function(e){t.emit("protocol",e)}),this.connection.on("deviceConnect",function(e){t.emit(e.state?"deviceConnected":"deviceDisconnected")})},h.extend(u.prototype,a.prototype)}(t("__browserify_process"))},{"./circular_buffer":2,"./connection":3,"./frame":5,"./gesture":6,"./node_connection":16,"./pipeline":10,__browserify_process:18,events:17,underscore:20}],5:[function(t,e){var n=t("./hand"),i=t("./pointable"),r=t("./gesture").createGesture,o=t("gl-matrix"),a=o.mat3,s=o.vec3,h=t("./interaction_box"),u=t("underscore"),c=e.exports=function(t){this.valid=!0,this.id=t.id,this.timestamp=t.timestamp,this.hands=[],this.handsMap={},this.pointables=[],this.tools=[],this.fingers=[],t.interactionBox&&(this.interactionBox=new h(t.interactionBox)),this.gestures=[],this.pointablesMap={},this._translation=t.t,this._rotation=u.flatten(t.r),this._scaleFactor=t.s,this.data=t,this.type="frame",this.currentFrameRate=t.currentFrameRate;for(var e={},o=0,a=t.hands.length;o!=a;o++){var s=new n(t.hands[o]);s.frame=this,this.hands.push(s),this.handsMap[s.id]=s,e[s.id]=o}for(var c=0,l=t.pointables.length;c!=l;c++){var d=new i(t.pointables[c]);if(d.frame=this,this.pointables.push(d),this.pointablesMap[d.id]=d,(d.tool?this.tools:this.fingers).push(d),void 0!==d.handId&&e.hasOwnProperty(d.handId)){var s=this.hands[e[d.handId]];s.pointables.push(d),(d.tool?s.tools:s.fingers).push(d)}}if(t.gestures)for(var f=0,p=t.gestures.length;f!=p;f++)this.gestures.push(r(t.gestures[f]))};c.prototype.tool=function(t){var e=this.pointable(t);return e.tool?e:i.Invalid},c.prototype.pointable=function(t){return this.pointablesMap[t]||i.Invalid},c.prototype.finger=function(t){var e=this.pointable(t);return e.tool?i.Invalid:e},c.prototype.hand=function(t){return this.handsMap[t]||n.Invalid},c.prototype.rotationAngle=function(t,e){if(!this.valid||!t.valid)return 0;var n=this.rotationMatrix(t),i=.5*(n[0]+n[4]+n[8]-1),r=Math.acos(i);if(r=isNaN(r)?0:r,void 0!==e){var o=this.rotationAxis(t);r*=s.dot(o,s.normalize(s.create(),e))}return r},c.prototype.rotationAxis=function(t){return this.valid&&t.valid?s.normalize(s.create(),[this._rotation[7]-t._rotation[5],this._rotation[2]-t._rotation[6],this._rotation[3]-t._rotation[1]]):s.create()},c.prototype.rotationMatrix=function(t){if(!this.valid||!t.valid)return a.create();var e=a.transpose(a.create(),this._rotation);return a.multiply(a.create(),t._rotation,e)},c.prototype.scaleFactor=function(t){return this.valid&&t.valid?Math.exp(this._scaleFactor-t._scaleFactor):1},c.prototype.translation=function(t){return this.valid&&t.valid?s.subtract(s.create(),this._translation,t._translation):s.create()},c.prototype.toString=function(){var t="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";return this.gestures&&(t+=" | Gesture count:("+this.gestures.length+")"),t+=" ]"},c.prototype.dump=function(){var t="";t+="Frame Info:<br/>",t+=this.toString(),t+="<br/><br/>Hands:<br/>";for(var e=0,n=this.hands.length;e!=n;e++)t+="  "+this.hands[e].toString()+"<br/>";t+="<br/><br/>Pointables:<br/>";for(var i=0,r=this.pointables.length;i!=r;i++)t+="  "+this.pointables[i].toString()+"<br/>";if(this.gestures){t+="<br/><br/>Gestures:<br/>";for(var o=0,a=this.gestures.length;o!=a;o++)t+="  "+this.gestures[o].toString()+"<br/>"}return t+="<br/><br/>Raw JSON:<br/>",t+=JSON.stringify(this.data)},c.Invalid={valid:!1,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return i.Invalid},finger:function(){return i.Invalid},hand:function(){return n.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return a.create()},rotationAxis:function(){return s.create()},scaleFactor:function(){return 1},translation:function(){return s.create()}}},{"./gesture":6,"./hand":7,"./interaction_box":9,"./pointable":11,"gl-matrix":19,underscore:20}],6:[function(t,e,n){var i=t("gl-matrix"),r=(i.vec3,t("events").EventEmitter),o=t("underscore");n.createGesture=function(t){var e;switch(t.type){case"circle":e=new s(t);break;case"swipe":e=new h(t);break;case"screenTap":e=new u(t);break;case"keyTap":e=new c(t);break;default:throw"unkown gesture type"}return e.id=t.id,e.handIds=t.handIds,e.pointableIds=t.pointableIds,e.duration=t.duration,e.state=t.state,e.type=t.type,e},n.gestureListener=function(t,e){var n={},i={};t.on("gesture",function(t,r){if(t.type==e){if(("start"==t.state||"stop"==t.state)&&void 0===i[t.id]){var s=new a(t,r);i[t.id]=s,o.each(n,function(t,e){s.on(e,t)})}i[t.id].update(t,r),"stop"==t.state&&delete i[t.id]}});var r={start:function(t){return n.start=t,r},stop:function(t){return n.stop=t,r},complete:function(t){return n.stop=t,r},update:function(t){return n.update=t,r}};return r};var a=n.Gesture=function(t,e){this.gestures=[t],this.frames=[e]};a.prototype.update=function(t,e){this.gestures.push(t),this.frames.push(e),this.emit(t.state,this)},o.extend(a.prototype,r.prototype);var s=function(t){this.center=t.center,this.normal=t.normal,this.progress=t.progress,this.radius=t.radius};s.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var h=function(t){this.startPosition=t.startPosition,this.position=t.position,this.direction=t.direction,this.speed=t.speed};h.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var u=function(t){this.position=t.position,this.direction=t.direction,this.progress=t.progress};u.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var c=function(t){this.position=t.position,this.direction=t.direction,this.progress=t.progress};c.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+"]"}},{events:17,"gl-matrix":19,underscore:20}],7:[function(t,e){var n=t("./pointable"),i=t("gl-matrix"),r=i.mat3,o=i.vec3,a=t("underscore"),s=e.exports=function(t){this.id=t.id,this.palmPosition=t.palmPosition,this.direction=t.direction,this.palmVelocity=t.palmVelocity,this.palmNormal=t.palmNormal,this.sphereCenter=t.sphereCenter,this.sphereRadius=t.sphereRadius,this.valid=!0,this.pointables=[],this.fingers=[],this.tools=[],this._translation=t.t,this._rotation=a.flatten(t.r),this._scaleFactor=t.s,this.timeVisible=t.timeVisible,this.stabilizedPalmPosition=t.stabilizedPalmPosition};s.prototype.finger=function(t){var e=this.frame.finger(t);return e&&e.handId==this.id?e:n.Invalid},s.prototype.rotationAngle=function(t,e){if(!this.valid||!t.valid)return 0;var n=t.hand(this.id);if(!n.valid)return 0;var i=this.rotationMatrix(t),r=.5*(i[0]+i[4]+i[8]-1),a=Math.acos(r);if(a=isNaN(a)?0:a,void 0!==e){var s=this.rotationAxis(t);a*=o.dot(s,o.normalize(o.create(),e))}return a},s.prototype.rotationAxis=function(t){if(!this.valid||!t.valid)return o.create();var e=t.hand(this.id);return e.valid?o.normalize(o.create(),[this._rotation[7]-e._rotation[5],this._rotation[2]-e._rotation[6],this._rotation[3]-e._rotation[1]]):o.create()},s.prototype.rotationMatrix=function(t){if(!this.valid||!t.valid)return r.create();var e=t.hand(this.id);if(!e.valid)return r.create();var n=r.transpose(r.create(),this._rotation),i=r.multiply(r.create(),e._rotation,n);return i},s.prototype.scaleFactor=function(t){if(!this.valid||!t.valid)return 1;var e=t.hand(this.id);return e.valid?Math.exp(this._scaleFactor-e._scaleFactor):1},s.prototype.translation=function(t){if(!this.valid||!t.valid)return o.create();var e=t.hand(this.id);return e.valid?[this._translation[0]-e._translation[0],this._translation[1]-e._translation[1],this._translation[2]-e._translation[2]]:o.create()},s.prototype.toString=function(){return"Hand [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "},s.Invalid={valid:!1,fingers:[],tools:[],pointables:[],pointable:function(){return n.Invalid},finger:function(){return n.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return r.create()},rotationAxis:function(){return o.create()},scaleFactor:function(){return 1},translation:function(){return o.create()}}},{"./pointable":11,"gl-matrix":19,underscore:20}],8:[function(t,e){!function(){e.exports={Controller:t("./controller"),Frame:t("./frame"),Gesture:t("./gesture"),Hand:t("./hand"),Pointable:t("./pointable"),InteractionBox:t("./interaction_box"),Connection:t("./connection"),CircularBuffer:t("./circular_buffer"),UI:t("./ui"),glMatrix:t("gl-matrix"),mat3:t("gl-matrix").mat3,vec3:t("gl-matrix").vec3,loopController:void 0,loop:function(t,e){void 0===e&&(e=t,t={}),this.loopController||(this.loopController=new this.Controller(t)),this.loopController.loop(e)}}}()},{"./circular_buffer":2,"./connection":3,"./controller":4,"./frame":5,"./gesture":6,"./hand":7,"./interaction_box":9,"./pointable":11,"./ui":13,"gl-matrix":19}],9:[function(t,e){var n=t("gl-matrix"),i=n.vec3,r=e.exports=function(t){this.valid=!0,this.center=t.center,this.size=t.size,this.width=t.size[0],this.height=t.size[1],this.depth=t.size[2]};r.prototype.denormalizePoint=function(t){return i.fromValues((t[0]-.5)*this.size[0]+this.center[0],(t[1]-.5)*this.size[1]+this.center[1],(t[2]-.5)*this.size[2]+this.center[2])},r.prototype.normalizePoint=function(t,e){var n=i.fromValues((t[0]-this.center[0])/this.size[0]+.5,(t[1]-this.center[1])/this.size[1]+.5,(t[2]-this.center[2])/this.size[2]+.5);return e&&(n[0]=Math.min(Math.max(n[0],0),1),n[1]=Math.min(Math.max(n[1],0),1),n[2]=Math.min(Math.max(n[2],0),1)),n},r.prototype.toString=function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"},r.Invalid={valid:!1}},{"gl-matrix":19}],10:[function(t,e){var n=e.exports=function(){this.steps=[]};n.prototype.addStep=function(t){this.steps.push(t)},n.prototype.run=function(t){for(var e=this.steps.length,n=0;n!=e&&t;n++)t=this.steps[n](t);return t}},{}],11:[function(t,e){var n=t("gl-matrix");n.vec3;var i=e.exports=function(t){this.valid=!0,this.id=t.id,this.handId=t.handId,this.length=t.length,this.tool=t.tool,this.width=t.width,this.direction=t.direction,this.stabilizedTipPosition=t.stabilizedTipPosition,this.tipPosition=t.tipPosition,this.tipVelocity=t.tipVelocity,this.touchZone=t.touchZone,this.touchDistance=t.touchDistance,this.timeVisible=t.timeVisible};i.prototype.toString=function(){return 1==this.tool?"Pointable [ id:"+this.id+" "+this.length+"mmx | with:"+this.width+"mm | direction:"+this.direction+" ]":"Pointable [ id:"+this.id+" "+this.length+"mmx | direction: "+this.direction+" ]"},i.Invalid={valid:!1}},{"gl-matrix":19}],12:[function(t,e,n){var i=t("./frame"),r=function(t){this.type=t.type,this.state=t.state};n.chooseProtocol=function(t){var e;switch(t.version){case 1:e=o(1,function(t){return new i(t)});break;case 2:e=o(2,function(t){return new i(t)}),e.sendHeartbeat=function(t){t.send(e.encode({heartbeat:!0}))};break;case 3:e=o(3,function(t){return t.event?new r(t.event):new i(t)}),e.sendHeartbeat=function(t){t.send(e.encode({heartbeat:!0}))};break;default:throw"unrecognized version"}return e};var o=function(t,e){var n=e;return n.encode=function(t){return JSON.stringify(t)},n.version=t,n.versionLong="Version "+t,n.type="protocol",n}},{"./frame":5}],13:[function(t,e,n){n.UI={Region:t("./ui/region"),Cursor:t("./ui/cursor")}},{"./ui/cursor":14,"./ui/region":15}],14:[function(t,e){e.exports=function(){return function(t){var e=t.pointables.sort(function(t,e){return t.z-e.z})[0];return e&&e.valid&&(t.cursorPosition=e.tipPosition),t}}},{}],15:[function(t,e){var n=t("events").EventEmitter,i=t("underscore"),r=e.exports=function(t,e){this.start=new Vector(t),this.end=new Vector(e),this.enteredFrame=null};r.prototype.hasPointables=function(t){for(var e=0;e!=t.pointables.length;e++){var n=t.pointables[e].tipPosition;if(n.x>=this.start.x&&n.x<=this.end.x&&n.y>=this.start.y&&n.y<=this.end.y&&n.z>=this.start.z&&n.z<=this.end.z)return!0}return!1},r.prototype.listener=function(t){var e=this;return t&&t.nearThreshold&&this.setupNearRegion(t.nearThreshold),function(t){return e.updatePosition(t)}},r.prototype.clipper=function(){var t=this;return function(e){return t.updatePosition(e),t.enteredFrame?e:null}},r.prototype.setupNearRegion=function(t){var e=this.nearRegion=new r([this.start.x-t,this.start.y-t,this.start.z-t],[this.end.x+t,this.end.y+t,this.end.z+t]),n=this;e.on("enter",function(t){n.emit("near",t)}),e.on("exit",function(t){n.emit("far",t)}),n.on("exit",function(t){n.emit("near",t)})},r.prototype.updatePosition=function(t){return this.nearRegion&&this.nearRegion.updatePosition(t),this.hasPointables(t)&&null==this.enteredFrame?(this.enteredFrame=t,this.emit("enter",this.enteredFrame)):this.hasPointables(t)||null==this.enteredFrame||(this.enteredFrame=null,this.emit("exit",this.enteredFrame)),t},r.prototype.normalize=function(t){return new Vector([(t.x-this.start.x)/(this.end.x-this.start.x),(t.y-this.start.y)/(this.end.y-this.start.y),(t.z-this.start.z)/(this.end.z-this.start.z)])},r.prototype.mapToXY=function(t,e,n){var i=this.normalize(t),r=i.x,o=i.y;return r>1?r=1:-1>r&&(r=-1),o>1?o=1:-1>o&&(o=-1),[(r+1)/2*e,(1-o)/2*n,i.z]},i.extend(r.prototype,n.prototype)},{events:17,underscore:20}],16:[function(){},{}],17:[function(t,e,n){!function(t){function e(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(e===t[n])return n;return-1}t.EventEmitter||(t.EventEmitter=function(){});var i=n.EventEmitter=t.EventEmitter,r="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=10;i.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},i.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||r(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"==typeof e){switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var n=Array.prototype.slice.call(arguments,1);e.apply(this,n)}return!0}if(r(e)){for(var n=Array.prototype.slice.call(arguments,1),i=e.slice(),o=0,a=i.length;a>o;o++)i[o].apply(this,n);return!0}return!1},i.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t])if(r(this._events[t])){if(!this._events[t].warned){var n;n=void 0!==this._events.maxListeners?this._events.maxListeners:o,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}this._events[t].push(e)}else this._events[t]=[this._events[t],e];else this._events[t]=e;return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){var n=this;return n.on(t,function i(){n.removeListener(t,i),e.apply(this,arguments)}),this},i.prototype.removeListener=function(t,n){if("function"!=typeof n)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var i=this._events[t];if(r(i)){var o=e(i,n);if(0>o)return this;i.splice(o,1),0==i.length&&delete this._events[t]}else this._events[t]===n&&delete this._events[t];return this},i.prototype.removeAllListeners=function(t){return 0===arguments.length?(this._events={},this):(t&&this._events&&this._events[t]&&(this._events[t]=null),this)},i.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),r(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}(t("__browserify_process"))},{__browserify_process:18}],18:[function(t,e){var n=e.exports={};n.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){if(t.source===window&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var e=n.shift();
e()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],19:[function(t,e,n){!function(){!function(){var t={};"undefined"==typeof n?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define("Leap",[],function(){return t.exports})):t.exports=window:t.exports=n,function(t){var e={};if(!n)var n=1e-6;e.create=function(){return new Float32Array(2)},e.clone=function(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var n=new Float32Array(2);return n[0]=t,n[1]=e,n},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,n){return t[0]=e,t[1]=n,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},e.sub=e.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},e.mul=e.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},e.div=e.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},e.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},e.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},e.dist=e.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(n*n+i*i)},e.sqrDist=e.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},e.len=e.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},e.sqrLen=e.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.normalize=function(t,e){var n=e[0],i=e[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},e.lerp=function(t,e,n,i){var r=e[0],o=e[1];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t},e.transformMat2=function(t,e,n){var i=e[0],r=e[1];return t[0]=i*n[0]+r*n[1],t[1]=i*n[2]+r*n[3],t},e.forEach=function(){var t=new Float32Array(2);return function(e,n,i,r,o,a){var s,h;for(n||(n=2),i||(i=0),h=r?Math.min(r*n+i,e.length):e.length,s=i;h>s;s+=n)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=e);var i={};if(!n)var n=1e-6;i.create=function(){return new Float32Array(3)},i.clone=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},i.fromValues=function(t,e,n){var i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=n,i},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},i.set=function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},i.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},i.sub=i.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},i.mul=i.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},i.div=i.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},i.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},i.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},i.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},i.dist=i.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)},i.sqrDist=i.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r},i.len=i.length=function(t){var e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)},i.sqrLen=i.squaredLength=function(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i},i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},i.normalize=function(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},i.cross=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],h=n[2];return t[0]=r*h-o*s,t[1]=o*a-i*h,t[2]=i*s-r*a,t},i.lerp=function(t,e,n,i){var r=e[0],o=e[1],a=e[2];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=a+i*(n[2]-a),t},i.transformMat4=function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12],t[1]=n[1]*i+n[5]*r+n[9]*o+n[13],t[2]=n[2]*i+n[6]*r+n[10]*o+n[14],t},i.transformQuat=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],h=n[2],u=n[3],c=u*i+s*o-h*r,l=u*r+h*i-a*o,d=u*o+a*r-s*i,f=-a*i-s*r-h*o;return t[0]=c*u+f*-a+l*-h-d*-s,t[1]=l*u+f*-s+d*-a-c*-h,t[2]=d*u+f*-h+c*-s-l*-a,t},i.forEach=function(){var t=new Float32Array(3);return function(e,n,i,r,o,a){var s,h;for(n||(n=3),i||(i=0),h=r?Math.min(r*n+i,e.length):e.length,s=i;h>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),i.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=i);var r={};if(!n)var n=1e-6;r.create=function(){return new Float32Array(4)},r.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},r.fromValues=function(t,e,n,i){var r=new Float32Array(4);return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},r.set=function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},r.sub=r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t},r.mul=r.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},r.div=r.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t},r.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},r.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},r.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},r.dist=r.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(n*n+i*i+r*r+o*o)},r.sqrDist=r.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return n*n+i*i+r*r+o*o},r.len=r.length=function(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.sqrt(e*e+n*n+i*i+r*r)},r.sqrLen=r.squaredLength=function(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r},r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},r.normalize=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},r.lerp=function(t,e,n,i){var r=e[0],o=e[1],a=e[2],s=e[3];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=a+i*(n[2]-a),t[3]=s+i*(n[3]-s),t},r.transformMat4=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*a,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*a,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*a,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*a,t},r.transformQuat=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],h=n[2],u=n[3],c=u*i+s*o-h*r,l=u*r+h*i-a*o,d=u*o+a*r-s*i,f=-a*i-s*r-h*o;return t[0]=c*u+f*-a+l*-h-d*-s,t[1]=l*u+f*-s+d*-a-c*-h,t[2]=d*u+f*-h+c*-s-l*-a,t},r.forEach=function(){var t=new Float32Array(4);return function(e,n,i,r,o,a){var s,h;for(n||(n=4),i||(i=0),h=r?Math.min(r*n+i,e.length):e.length,s=i;h>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),r.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=r);var o={},a=new Float32Array([1,0,0,1]);if(!n)var n=1e-6;o.create=function(){return new Float32Array(a)},o.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},o.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},o.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n*o-r*i;return a?(a=1/a,t[0]=o*a,t[1]=-i*a,t[2]=-r*a,t[3]=n*a,t):null},o.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},o.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},o.mul=o.multiply=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],h=n[1],u=n[2],c=n[3];return t[0]=i*s+r*u,t[1]=i*h+r*c,t[2]=o*s+a*u,t[3]=o*h+a*c,t},o.rotate=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),h=Math.cos(n);return t[0]=i*h+r*s,t[1]=i*-s+r*h,t[2]=o*h+a*s,t[3]=o*-s+a*h,t},o.scale=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],h=n[1];return t[0]=i*s,t[1]=r*h,t[2]=o*s,t[3]=a*h,t},o.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.mat2=o);var s={},h=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!n)var n=1e-6;s.create=function(){return new Float32Array(h)},s.clone=function(t){var e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},s.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=c*a-s*u,d=-c*o+s*h,f=u*o-a*h,p=n*l+i*d+r*f;return p?(p=1/p,t[0]=l*p,t[1]=(-c*i+r*u)*p,t[2]=(s*i-r*a)*p,t[3]=d*p,t[4]=(c*n-r*h)*p,t[5]=(-s*n+r*o)*p,t[6]=f*p,t[7]=(-u*n+i*h)*p,t[8]=(a*n-i*o)*p,t):null},s.adjoint=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8];return t[0]=a*c-s*u,t[1]=r*u-i*c,t[2]=i*s-r*a,t[3]=s*h-o*c,t[4]=n*c-r*h,t[5]=r*o-n*s,t[6]=o*u-a*h,t[7]=i*h-n*u,t[8]=n*a-i*o,t},s.determinant=function(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],h=t[7],u=t[8];return e*(u*o-a*h)+n*(-u*r+a*s)+i*(h*r-o*s)},s.mul=s.multiply=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=n[0],f=n[1],p=n[2],m=n[3],v=n[4],g=n[5],x=n[6],y=n[7],b=n[8];return t[0]=d*i+f*a+p*u,t[1]=d*r+f*s+p*c,t[2]=d*o+f*h+p*l,t[3]=m*i+v*a+g*u,t[4]=m*r+v*s+g*c,t[5]=m*o+v*h+g*l,t[6]=x*i+y*a+b*u,t[7]=x*r+y*s+b*c,t[8]=x*o+y*h+b*l,t},s.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},"undefined"!=typeof t&&(t.mat3=s);var u={},c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!n)var n=1e-6;u.create=function(){return new Float32Array(c)},u.clone=function(t){var e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},u.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=r,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},u.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],p=e[12],m=e[13],v=e[14],g=e[15],x=n*s-i*a,y=n*h-r*a,b=n*u-o*a,w=i*h-r*s,T=i*u-o*s,_=r*u-o*h,A=c*m-l*p,R=c*v-d*p,S=c*g-f*p,E=l*v-d*m,C=l*g-f*m,L=d*g-f*v,F=x*L-y*C+b*E+w*S-T*R+_*A;return F?(F=1/F,t[0]=(s*L-h*C+u*E)*F,t[1]=(r*C-i*L-o*E)*F,t[2]=(m*_-v*T+g*w)*F,t[3]=(d*T-l*_-f*w)*F,t[4]=(h*S-a*L-u*R)*F,t[5]=(n*L-r*S+o*R)*F,t[6]=(v*b-p*_-g*y)*F,t[7]=(c*_-d*b+f*y)*F,t[8]=(a*C-s*S+u*A)*F,t[9]=(i*S-n*C-o*A)*F,t[10]=(p*T-m*b+g*x)*F,t[11]=(l*b-c*T-f*x)*F,t[12]=(s*R-a*E-h*A)*F,t[13]=(n*E-i*R+r*A)*F,t[14]=(m*y-p*w-v*x)*F,t[15]=(c*w-l*y+d*x)*F,t):null},u.adjoint=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],p=e[12],m=e[13],v=e[14],g=e[15];return t[0]=s*(d*g-f*v)-l*(h*g-u*v)+m*(h*f-u*d),t[1]=-(i*(d*g-f*v)-l*(r*g-o*v)+m*(r*f-o*d)),t[2]=i*(h*g-u*v)-s*(r*g-o*v)+m*(r*u-o*h),t[3]=-(i*(h*f-u*d)-s*(r*f-o*d)+l*(r*u-o*h)),t[4]=-(a*(d*g-f*v)-c*(h*g-u*v)+p*(h*f-u*d)),t[5]=n*(d*g-f*v)-c*(r*g-o*v)+p*(r*f-o*d),t[6]=-(n*(h*g-u*v)-a*(r*g-o*v)+p*(r*u-o*h)),t[7]=n*(h*f-u*d)-a*(r*f-o*d)+c*(r*u-o*h),t[8]=a*(l*g-f*m)-c*(s*g-u*m)+p*(s*f-u*l),t[9]=-(n*(l*g-f*m)-c*(i*g-o*m)+p*(i*f-o*l)),t[10]=n*(s*g-u*m)-a*(i*g-o*m)+p*(i*u-o*s),t[11]=-(n*(s*f-u*l)-a*(i*f-o*l)+c*(i*u-o*s)),t[12]=-(a*(l*v-d*m)-c*(s*v-h*m)+p*(s*d-h*l)),t[13]=n*(l*v-d*m)-c*(i*v-r*m)+p*(i*d-r*l),t[14]=-(n*(s*v-h*m)-a*(i*v-r*m)+p*(i*h-r*s)),t[15]=n*(s*d-h*l)-a*(i*d-r*l)+c*(i*h-r*s),t},u.determinant=function(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],h=t[7],u=t[8],c=t[9],l=t[10],d=t[11],f=t[12],p=t[13],m=t[14],v=t[15],g=e*a-n*o,x=e*s-i*o,y=e*h-r*o,b=n*s-i*a,w=n*h-r*a,T=i*h-r*s,_=u*p-c*f,A=u*m-l*f,R=u*v-d*f,S=c*m-l*p,E=c*v-d*p,C=l*v-d*m;return g*C-x*E+y*S+b*R-w*A+T*_},u.mul=u.multiply=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],f=e[10],p=e[11],m=e[12],v=e[13],g=e[14],x=e[15],y=n[0],b=n[1],w=n[2],T=n[3];return t[0]=y*i+b*s+w*l+T*m,t[1]=y*r+b*h+w*d+T*v,t[2]=y*o+b*u+w*f+T*g,t[3]=y*a+b*c+w*p+T*x,y=n[4],b=n[5],w=n[6],T=n[7],t[4]=y*i+b*s+w*l+T*m,t[5]=y*r+b*h+w*d+T*v,t[6]=y*o+b*u+w*f+T*g,t[7]=y*a+b*c+w*p+T*x,y=n[8],b=n[9],w=n[10],T=n[11],t[8]=y*i+b*s+w*l+T*m,t[9]=y*r+b*h+w*d+T*v,t[10]=y*o+b*u+w*f+T*g,t[11]=y*a+b*c+w*p+T*x,y=n[12],b=n[13],w=n[14],T=n[15],t[12]=y*i+b*s+w*l+T*m,t[13]=y*r+b*h+w*d+T*v,t[14]=y*o+b*u+w*f+T*g,t[15]=y*a+b*c+w*p+T*x,t},u.translate=function(t,e,n){var i,r,o,a,s,h,u,c,l,d,f,p,m=n[0],v=n[1],g=n[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*g+e[12],t[13]=e[1]*m+e[5]*v+e[9]*g+e[13],t[14]=e[2]*m+e[6]*v+e[10]*g+e[14],t[15]=e[3]*m+e[7]*v+e[11]*g+e[15]):(i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],f=e[10],p=e[11],t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=d,t[10]=f,t[11]=p,t[12]=i*m+s*v+l*g+e[12],t[13]=r*m+h*v+d*g+e[13],t[14]=o*m+u*v+f*g+e[14],t[15]=a*m+c*v+p*g+e[15]),t},u.scale=function(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.rotate=function(t,e,i,r){var o,a,s,h,u,c,l,d,f,p,m,v,g,x,y,b,w,T,_,A,R,S,E,C,L=r[0],F=r[1],M=r[2],B=Math.sqrt(L*L+F*F+M*M);return Math.abs(B)<n?null:(B=1/B,L*=B,F*=B,M*=B,o=Math.sin(i),a=Math.cos(i),s=1-a,h=e[0],u=e[1],c=e[2],l=e[3],d=e[4],f=e[5],p=e[6],m=e[7],v=e[8],g=e[9],x=e[10],y=e[11],b=L*L*s+a,w=F*L*s+M*o,T=M*L*s-F*o,_=L*F*s-M*o,A=F*F*s+a,R=M*F*s+L*o,S=L*M*s+F*o,E=F*M*s-L*o,C=M*M*s+a,t[0]=h*b+d*w+v*T,t[1]=u*b+f*w+g*T,t[2]=c*b+p*w+x*T,t[3]=l*b+m*w+y*T,t[4]=h*_+d*A+v*R,t[5]=u*_+f*A+g*R,t[6]=c*_+p*A+x*R,t[7]=l*_+m*A+y*R,t[8]=h*S+d*E+v*C,t[9]=u*S+f*E+g*C,t[10]=c*S+p*E+x*C,t[11]=l*S+m*E+y*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},u.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],a=e[5],s=e[6],h=e[7],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*i,t[5]=a*r+c*i,t[6]=s*r+l*i,t[7]=h*r+d*i,t[8]=u*r-o*i,t[9]=c*r-a*i,t[10]=l*r-s*i,t[11]=d*r-h*i,t},u.rotateY=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],h=e[3],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-u*i,t[1]=a*r-c*i,t[2]=s*r-l*i,t[3]=h*r-d*i,t[8]=o*i+u*r,t[9]=a*i+c*r,t[10]=s*i+l*r,t[11]=h*i+d*r,t},u.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],h=e[3],u=e[4],c=e[5],l=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*i,t[1]=a*r+c*i,t[2]=s*r+l*i,t[3]=h*r+d*i,t[4]=u*r-o*i,t[5]=c*r-a*i,t[6]=l*r-s*i,t[7]=d*r-h*i,t},u.fromRotationTranslation=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=i+i,h=r+r,u=o+o,c=i*s,l=i*h,d=i*u,f=r*h,p=r*u,m=o*u,v=a*s,g=a*h,x=a*u;return t[0]=1-(f+m),t[1]=l+x,t[2]=d-g,t[3]=0,t[4]=l-x,t[5]=1-(c+m),t[6]=p+v,t[7]=0,t[8]=d+g,t[9]=p-v,t[10]=1-(c+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},u.frustum=function(t,e,n,i,r,o,a){var s=1/(n-e),h=1/(r-i),u=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(r+i)*h,t[10]=(a+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*o*u,t[15]=0,t},u.perspective=function(t,e,n,i,r){var o=1/Math.tan(e/2),a=1/(i-r);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*a,t[15]=0,t},u.ortho=function(t,e,n,i,r,o,a){var s=1/(e-n),h=1/(i-r),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*h,t[14]=(a+o)*u,t[15]=1,t},u.lookAt=function(t,e,i,r){var o,a,s,h,c,l,d,f,p,m,v=e[0],g=e[1],x=e[2],y=r[0],b=r[1],w=r[2],T=i[0],_=i[1],A=i[2];return Math.abs(v-T)<n&&Math.abs(g-_)<n&&Math.abs(x-A)<n?u.identity(t):(d=v-T,f=g-_,p=x-A,m=1/Math.sqrt(d*d+f*f+p*p),d*=m,f*=m,p*=m,o=b*p-w*f,a=w*d-y*p,s=y*f-b*d,m=Math.sqrt(o*o+a*a+s*s),m?(m=1/m,o*=m,a*=m,s*=m):(o=0,a=0,s=0),h=f*s-p*a,c=p*o-d*s,l=d*a-f*o,m=Math.sqrt(h*h+c*c+l*l),m?(m=1/m,h*=m,c*=m,l*=m):(h=0,c=0,l=0),t[0]=o,t[1]=h,t[2]=d,t[3]=0,t[4]=a,t[5]=c,t[6]=f,t[7]=0,t[8]=s,t[9]=l,t[10]=p,t[11]=0,t[12]=-(o*v+a*g+s*x),t[13]=-(h*v+c*g+l*x),t[14]=-(d*v+f*g+p*x),t[15]=1,t)},u.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},"undefined"!=typeof t&&(t.mat4=u);var l={},d=new Float32Array([0,0,0,1]);if(!n)var n=1e-6;l.create=function(){return new Float32Array(d)},l.clone=r.clone,l.fromValues=r.fromValues,l.copy=r.copy,l.set=r.set,l.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},l.setAxisAngle=function(t,e,n){n=.5*n;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t},l.add=r.add,l.mul=l.multiply=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],h=n[1],u=n[2],c=n[3];return t[0]=i*c+a*s+r*u-o*h,t[1]=r*c+a*h+o*s-i*u,t[2]=o*c+a*u+i*h-r*s,t[3]=a*c-i*s-r*h-o*u,t},l.scale=r.scale,l.rotateX=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),h=Math.cos(n);return t[0]=i*h+a*s,t[1]=r*h+o*s,t[2]=o*h-r*s,t[3]=a*h-i*s,t},l.rotateY=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),h=Math.cos(n);return t[0]=i*h-o*s,t[1]=r*h+a*s,t[2]=o*h+i*s,t[3]=a*h-r*s,t},l.rotateZ=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),h=Math.cos(n);return t[0]=i*h+r*s,t[1]=r*h-i*s,t[2]=o*h+a*s,t[3]=a*h-o*s,t},l.calculateW=function(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=-Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t},l.dot=r.dot,l.lerp=r.lerp,l.slerp=function(t,e,n,i){var r,o,a,s,h=e[0],u=e[1],c=e[2],l=e[3],d=n[0],f=n[1],p=n[2],m=e[3],v=h*d+u*f+c*p+l*m;return Math.abs(v)>=1?(t!==e&&(t[0]=h,t[1]=u,t[2]=c,t[3]=l),t):(r=Math.acos(v),o=Math.sqrt(1-v*v),Math.abs(o)<.001?(t[0]=.5*h+.5*d,t[1]=.5*u+.5*f,t[2]=.5*c+.5*p,t[3]=.5*l+.5*m,t):(a=Math.sin((1-i)*r)/o,s=Math.sin(i*r)/o,t[0]=h*a+d*s,t[1]=u*a+f*s,t[2]=c*a+p*s,t[3]=l*a+m*s,t))},l.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n*n+i*i+r*r+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-i*s,t[2]=-r*s,t[3]=o*s,t},l.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},l.len=l.length=r.length,l.sqrLen=l.squaredLength=r.squaredLength,l.normalize=r.normalize,l.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=l)}(t.exports)}()}()},{}],20:[function(t,e,n){!function(){!function(){var t=this,i=t._,r={},o=Array.prototype,a=Object.prototype,s=Function.prototype,h=o.push,u=o.slice,c=o.concat,l=a.toString,d=a.hasOwnProperty,f=o.forEach,p=o.map,m=o.reduce,v=o.reduceRight,g=o.filter,x=o.every,y=o.some,b=o.indexOf,w=o.lastIndexOf,T=Array.isArray,_=Object.keys,A=s.bind,R=function(t){return t instanceof R?t:this instanceof R?(this._wrapped=t,void 0):new R(t)};"undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=R),n._=R):t._=R,R.VERSION="1.4.4";var S=R.each=R.forEach=function(t,e,n){if(null!=t)if(f&&t.forEach===f)t.forEach(e,n);else if(t.length===+t.length){for(var i=0,o=t.length;o>i;i++)if(e.call(n,t[i],i,t)===r)return}else for(var a in t)if(R.has(t,a)&&e.call(n,t[a],a,t)===r)return};R.map=R.collect=function(t,e,n){var i=[];return null==t?i:p&&t.map===p?t.map(e,n):(S(t,function(t,r,o){i[i.length]=e.call(n,t,r,o)}),i)};var E="Reduce of empty array with no initial value";R.reduce=R.foldl=R.inject=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),m&&t.reduce===m)return i&&(e=R.bind(e,i)),r?t.reduce(e,n):t.reduce(e);if(S(t,function(t,o,a){r?n=e.call(i,n,t,o,a):(n=t,r=!0)}),!r)throw new TypeError(E);return n},R.reduceRight=R.foldr=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),v&&t.reduceRight===v)return i&&(e=R.bind(e,i)),r?t.reduceRight(e,n):t.reduceRight(e);var o=t.length;if(o!==+o){var a=R.keys(t);o=a.length}if(S(t,function(s,h,u){h=a?a[--o]:--o,r?n=e.call(i,n,t[h],h,u):(n=t[h],r=!0)}),!r)throw new TypeError(E);return n},R.find=R.detect=function(t,e,n){var i;return C(t,function(t,r,o){return e.call(n,t,r,o)?(i=t,!0):void 0}),i},R.filter=R.select=function(t,e,n){var i=[];return null==t?i:g&&t.filter===g?t.filter(e,n):(S(t,function(t,r,o){e.call(n,t,r,o)&&(i[i.length]=t)}),i)},R.reject=function(t,e,n){return R.filter(t,function(t,i,r){return!e.call(n,t,i,r)},n)},R.every=R.all=function(t,e,n){e||(e=R.identity);var i=!0;return null==t?i:x&&t.every===x?t.every(e,n):(S(t,function(t,o,a){return(i=i&&e.call(n,t,o,a))?void 0:r}),!!i)};var C=R.some=R.any=function(t,e,n){e||(e=R.identity);var i=!1;return null==t?i:y&&t.some===y?t.some(e,n):(S(t,function(t,o,a){return i||(i=e.call(n,t,o,a))?r:void 0}),!!i)};R.contains=R.include=function(t,e){return null==t?!1:b&&t.indexOf===b?-1!=t.indexOf(e):C(t,function(t){return t===e})},R.invoke=function(t,e){var n=u.call(arguments,2),i=R.isFunction(e);return R.map(t,function(t){return(i?e:t[e]).apply(t,n)})},R.pluck=function(t,e){return R.map(t,function(t){return t[e]})},R.where=function(t,e,n){return R.isEmpty(e)?n?null:[]:R[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},R.findWhere=function(t,e){return R.where(t,e,!0)},R.max=function(t,e,n){if(!e&&R.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&R.isEmpty(t))return-1/0;var i={computed:-1/0,value:-1/0};return S(t,function(t,r,o){var a=e?e.call(n,t,r,o):t;a>=i.computed&&(i={value:t,computed:a})}),i.value},R.min=function(t,e,n){if(!e&&R.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&R.isEmpty(t))return 1/0;var i={computed:1/0,value:1/0};return S(t,function(t,r,o){var a=e?e.call(n,t,r,o):t;a<i.computed&&(i={value:t,computed:a})}),i.value},R.shuffle=function(t){var e,n=0,i=[];return S(t,function(t){e=R.random(n++),i[n-1]=i[e],i[e]=t}),i};var L=function(t){return R.isFunction(t)?t:function(e){return e[t]}};R.sortBy=function(t,e,n){var i=L(e);return R.pluck(R.map(t,function(t,e,r){return{value:t,index:e,criteria:i.call(n,t,e,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index<e.index?-1:1}),"value")};var F=function(t,e,n,i){var r={},o=L(e||R.identity);return S(t,function(e,a){var s=o.call(n,e,a,t);i(r,s,e)}),r};R.groupBy=function(t,e,n){return F(t,e,n,function(t,e,n){(R.has(t,e)?t[e]:t[e]=[]).push(n)})},R.countBy=function(t,e,n){return F(t,e,n,function(t,e){R.has(t,e)||(t[e]=0),t[e]++})},R.sortedIndex=function(t,e,n,i){n=null==n?R.identity:L(n);for(var r=n.call(i,e),o=0,a=t.length;a>o;){var s=o+a>>>1;n.call(i,t[s])<r?o=s+1:a=s}return o},R.toArray=function(t){return t?R.isArray(t)?u.call(t):t.length===+t.length?R.map(t,R.identity):R.values(t):[]},R.size=function(t){return null==t?0:t.length===+t.length?t.length:R.keys(t).length},R.first=R.head=R.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:u.call(t,0,e)},R.initial=function(t,e,n){return u.call(t,0,t.length-(null==e||n?1:e))},R.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:u.call(t,Math.max(t.length-e,0))},R.rest=R.tail=R.drop=function(t,e,n){return u.call(t,null==e||n?1:e)},R.compact=function(t){return R.filter(t,R.identity)};var M=function(t,e,n){return S(t,function(t){R.isArray(t)?e?h.apply(n,t):M(t,e,n):n.push(t)}),n};R.flatten=function(t,e){return M(t,e,[])},R.without=function(t){return R.difference(t,u.call(arguments,1))},R.uniq=R.unique=function(t,e,n,i){R.isFunction(e)&&(i=n,n=e,e=!1);var r=n?R.map(t,n,i):t,o=[],a=[];return S(r,function(n,i){(e?i&&a[a.length-1]===n:R.contains(a,n))||(a.push(n),o.push(t[i]))}),o},R.union=function(){return R.uniq(c.apply(o,arguments))},R.intersection=function(t){var e=u.call(arguments,1);return R.filter(R.uniq(t),function(t){return R.every(e,function(e){return R.indexOf(e,t)>=0})})},R.difference=function(t){var e=c.apply(o,u.call(arguments,1));return R.filter(t,function(t){return!R.contains(e,t)})},R.zip=function(){for(var t=u.call(arguments),e=R.max(R.pluck(t,"length")),n=new Array(e),i=0;e>i;i++)n[i]=R.pluck(t,""+i);return n},R.object=function(t,e){if(null==t)return{};for(var n={},i=0,r=t.length;r>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},R.indexOf=function(t,e,n){if(null==t)return-1;var i=0,r=t.length;if(n){if("number"!=typeof n)return i=R.sortedIndex(t,e),t[i]===e?i:-1;i=0>n?Math.max(0,r+n):n}if(b&&t.indexOf===b)return t.indexOf(e,n);for(;r>i;i++)if(t[i]===e)return i;return-1},R.lastIndexOf=function(t,e,n){if(null==t)return-1;var i=null!=n;if(w&&t.lastIndexOf===w)return i?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var r=i?n:t.length;r--;)if(t[r]===e)return r;return-1},R.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=0,o=new Array(i);i>r;)o[r++]=t,t+=n;return o},R.bind=function(t,e){if(t.bind===A&&A)return A.apply(t,u.call(arguments,1));var n=u.call(arguments,2);return function(){return t.apply(e,n.concat(u.call(arguments)))}},R.partial=function(t){var e=u.call(arguments,1);return function(){return t.apply(this,e.concat(u.call(arguments)))}},R.bindAll=function(t){var e=u.call(arguments,1);return 0===e.length&&(e=R.functions(t)),S(e,function(e){t[e]=R.bind(t[e],t)}),t},R.memoize=function(t,e){var n={};return e||(e=R.identity),function(){var i=e.apply(this,arguments);return R.has(n,i)?n[i]:n[i]=t.apply(this,arguments)}},R.delay=function(t,e){var n=u.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},R.defer=function(t){return R.delay.apply(R,[t,1].concat(u.call(arguments,1)))},R.throttle=function(t,e){var n,i,r,o,a=0,s=function(){a=new Date,r=null,o=t.apply(n,i)};return function(){var h=new Date,u=e-(h-a);return n=this,i=arguments,0>=u?(clearTimeout(r),r=null,a=h,o=t.apply(n,i)):r||(r=setTimeout(s,u)),o}},R.debounce=function(t,e,n){var i,r;return function(){var o=this,a=arguments,s=function(){i=null,n||(r=t.apply(o,a))},h=n&&!i;return clearTimeout(i),i=setTimeout(s,e),h&&(r=t.apply(o,a)),r}},R.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},R.wrap=function(t,e){return function(){var n=[t];return h.apply(n,arguments),e.apply(this,n)}},R.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},R.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},R.keys=_||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)R.has(t,n)&&(e[e.length]=n);return e},R.values=function(t){var e=[];for(var n in t)R.has(t,n)&&e.push(t[n]);return e},R.pairs=function(t){var e=[];for(var n in t)R.has(t,n)&&e.push([n,t[n]]);return e},R.invert=function(t){var e={};for(var n in t)R.has(t,n)&&(e[t[n]]=n);return e},R.functions=R.methods=function(t){var e=[];for(var n in t)R.isFunction(t[n])&&e.push(n);return e.sort()},R.extend=function(t){return S(u.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},R.pick=function(t){var e={},n=c.apply(o,u.call(arguments,1));return S(n,function(n){n in t&&(e[n]=t[n])}),e},R.omit=function(t){var e={},n=c.apply(o,u.call(arguments,1));for(var i in t)R.contains(n,i)||(e[i]=t[i]);return e},R.defaults=function(t){return S(u.call(arguments,1),function(e){if(e)for(var n in e)null==t[n]&&(t[n]=e[n])}),t},R.clone=function(t){return R.isObject(t)?R.isArray(t)?t.slice():R.extend({},t):t},R.tap=function(t,e){return e(t),t};var B=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof R&&(t=t._wrapped),e instanceof R&&(e=e._wrapped);var r=l.call(t);if(r!=l.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=n.length;o--;)if(n[o]==t)return i[o]==e;n.push(t),i.push(e);var a=0,s=!0;if("[object Array]"==r){if(a=t.length,s=a==e.length)for(;a--&&(s=B(t[a],e[a],n,i)););}else{var h=t.constructor,u=e.constructor;if(h!==u&&!(R.isFunction(h)&&h instanceof h&&R.isFunction(u)&&u instanceof u))return!1;for(var c in t)if(R.has(t,c)&&(a++,!(s=R.has(e,c)&&B(t[c],e[c],n,i))))break;if(s){for(c in e)if(R.has(e,c)&&!a--)break;s=!a}}return n.pop(),i.pop(),s};R.isEqual=function(t,e){return B(t,e,[],[])},R.isEmpty=function(t){if(null==t)return!0;if(R.isArray(t)||R.isString(t))return 0===t.length;for(var e in t)if(R.has(t,e))return!1;return!0},R.isElement=function(t){return!(!t||1!==t.nodeType)},R.isArray=T||function(t){return"[object Array]"==l.call(t)},R.isObject=function(t){return t===Object(t)},S(["Arguments","Function","String","Number","Date","RegExp"],function(t){R["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),R.isArguments(arguments)||(R.isArguments=function(t){return!(!t||!R.has(t,"callee"))}),"function"!=typeof/./&&(R.isFunction=function(t){return"function"==typeof t}),R.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},R.isNaN=function(t){return R.isNumber(t)&&t!=+t},R.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},R.isNull=function(t){return null===t},R.isUndefined=function(t){return void 0===t},R.has=function(t,e){return d.call(t,e)},R.noConflict=function(){return t._=i,this},R.identity=function(t){return t},R.times=function(t,e,n){for(var i=Array(t),r=0;t>r;r++)i[r]=e.call(n,r);return i},R.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};I.unescape=R.invert(I.escape);var k={escape:new RegExp("["+R.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+R.keys(I.unescape).join("|")+")","g")};
R.each(["escape","unescape"],function(t){R[t]=function(e){return null==e?"":(""+e).replace(k[t],function(e){return I[t][e]})}}),R.result=function(t,e){if(null==t)return null;var n=t[e];return R.isFunction(n)?n.call(t):n},R.mixin=function(t){S(R.functions(t),function(e){var n=R[e]=t[e];R.prototype[e]=function(){var t=[this._wrapped];return h.apply(t,arguments),U.call(this,n.apply(R,t))}})};var O=0;R.uniqueId=function(t){var e=++O+"";return t?t+e:e},R.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var D=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;R.template=function(t,e,n){var i;n=R.defaults({},n,R.templateSettings);var r=new RegExp([(n.escape||D).source,(n.interpolate||D).source,(n.evaluate||D).source].join("|")+"|$","g"),o=0,a="__p+='";t.replace(r,function(e,n,i,r,s){return a+=t.slice(o,s).replace(j,function(t){return"\\"+P[t]}),n&&(a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(a+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),r&&(a+="';\n"+r+"\n__p+='"),o=s+e.length,e}),a+="';\n",n.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{i=new Function(n.variable||"obj","_",a)}catch(s){throw s.source=a,s}if(e)return i(e,R);var h=function(t){return i.call(this,t,R)};return h.source="function("+(n.variable||"obj")+"){\n"+a+"}",h},R.chain=function(t){return R(t).chain()};var U=function(t){return this._chain?R(t).chain():t};R.mixin(R),S(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=o[t];R.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],U.call(this,n)}}),S(["concat","join","slice"],function(t){var e=o[t];R.prototype[t]=function(){return U.call(this,e.apply(this._wrapped,arguments))}}),R.extend(R.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this)}()},{}],21:[function(t){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),Leap=t("../lib/index")},{"../lib/index":8}]},{},[21]),define("leapController",["Leap","config","utils/eventPublisher"],function(t,e,n){var i=new t.Controller,r=0,o=!1,a=0,s=n(["handFrameNormalized","debugInfo"]),h=e.width,u=e.height;return i.on("frame",function(t){var e,n=0,i=0,c=0;for(void 0===t.hands?o=!1:(a=t.hands.length,o=a>0?!0:!1),handCount=a;n!=handCount;n+=1)e=t.hands[n],i=parseInt(e.palmPosition[0],10),c=parseInt(e.palmPosition[1],10),s.fire("handFrameNormalized",{position:{x:h/2+2.5*i,y:4*(u/3)-2*c}});r+=1}),setInterval(function(){var t=r/2,e="leap: received "+r+" frames @ "+t+"fps.";s.fire("debugInfo",e),r=0},2e3),console.log("leap: init"),i.connect(),{getHandsAvailable:function(){return o},getHandsLength:function(){return a},events:s}}),define("display/factory",["PIXI","config"],function(t,e){function n(t,e,n){t.position.x=e===!0?e:0,t.position.y=n===!0?n:0}function i(t,e,n){t.anchor.x=e===!0?e:.5,t.anchor.y=n===!0?n:.5}function r(t,n,i){t.width=n===!0?n:e.width,t.height=i===!0?i:e.height}function o(e,r,o,a,s){var h=new t.Sprite(e);return n(h,r,o),i(h,a,s),h}function a(e,n){var i=new t.DisplayObjectContainer;return r(i,e,n),i}var s=t.Texture.fromImage("assets/crosshair.png");return{makeCrosshair:function(t,e,n,i){var r=o(s,t,e,n,i);return r},makeLayer:function(t,e){return a(t,e)},makeScene:function(t,e){return a(t,e)}}}),define("layers/crosshair",["displayController","config","leapController","display/factory"],function(t,e,n,i){function r(){u||(l.addChild(c),t.events.on("renderFrame",a),t.events.on("renderFrame",s),n.events.on("handFrameNormalized",h),u=!0)}function o(){u&&(l.removeChild(c),t.events.remove("renderFrame",a),t.events.remove("renderFrame",s),n.events.remove("handFrameNormalized",h),u=!1)}function a(){c.rotation+=.1}function s(){n.getHandsAvailable()===!0?c.alpha<1&&(c.alpha+=.02):c.alpha>.2&&(c.alpha-=.01)}function h(t){c.position.x=t.position.x,c.position.y=t.position.y}var u=(e.width,e.height,!1),c=i.makeCrosshair(),l=i.makeLayer();return{activate:function(){r()},deactivate:function(){o()},getLayer:function(){return l},getRunning:function(){return u}}}),define("display/assets",["PIXI","utils/eventPublisher","config"],function(t,e,n){function i(){var e,i,o=0;for(o;175>o;o+=1)e=s[o%4],i=t.Sprite.fromFrame(e),i.position.x=parseInt(Math.random()*n.width,10),i.position.y=parseInt(Math.random()*n.height,10),i.targetX=parseInt(Math.random()*n.width,10),i.targetY=parseInt(Math.random()*n.height,10),i.anchor.x=.5,i.anchor.y=.5,i.scale.x=.2,i.scale.y=.2,i.hitted=!1,i.alpha=.5,i.speed=1,a.push(i);for(o=0;26>o;o+=1){var c=t.Texture.fromFrame("Explosion_Sequence_A "+(o+1)+".png");h.push(c)}u=!0,r.fire("assetsLoaded")}var r=e(["assetsLoaded"]),o=["assets/SpriteSheetAliens.json","assets/SpriteSheetExplosion.json"],a=[],s=["eggHead.png","flowerTop.png","helmlok.png","skully.png"],h=[],u=!1;return loader=new t.AssetLoader(o),loader.onComplete=i,loader.load(),{aliens:a,assetsLoaded:u,events:r,explosionTextures:h}}),define("utils/hittest",[],function(){return function(t,e){var n=0,i=0,r=0,o=0;return t.width=void 0===t.width?0:t.width,t.height=void 0===t.height?0:t.height,e.width=void 0===e.width?0:e.width,e.height=void 0===e.height?0:e.height,t.anchor=void 0===t.anchor?{x:0,y:0}:t.anchor,e.anchor=void 0===e.anchor?{x:0,y:0}:e.anchor,n=t.position.x-t.width*t.anchor.x,i=t.position.y-t.height*t.anchor.y,r=e.position.x-e.width*e.anchor.x,o=e.position.y-e.height*e.anchor.y,n+t.width>=r&&n<=r+e.width&&i+t.height>=o&&i<=o+e.height?!0:!1}}),define("utils/mixin",[],function(){return function(){var t,e,n={};for(t=0;t<arguments.length;t+=1)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&(n[e]=arguments[t][e]);return n}}),define("layers/aliens",["display/assets","display/factory","config","displayController","leapController","utils/hittest","utils/mixin"],function(t,e,n,i,r,o,a){function s(){var e=0,n=t.aliens.length;for(p=t.aliens,e;n>e;e+=1)f.addChild(p[e])}function h(){d||(i.events.on("renderFrame",c),r.events.on("handFrameNormalized",l),d=!0)}function u(){d&&(i.events.remove("renderFrame",c),r.events.remove("handFrameNormalized",l),d=!1)}function c(){var e,i=0,r=p.length;for(i;r>i;i+=1)if(e=p[i],e.visible===!0&&(e.position.x<e.targetX&&(e.position.x+=e.speed),e.position.x>e.targetX&&(e.position.x-=e.speed),e.position.y<e.targetY&&(e.position.y+=e.speed),e.position.y>e.targetY&&(e.position.y-=e.speed),e.position.x===e.targetX&&(e.targetX=parseInt(Math.random()*n.width,10)),e.position.y===e.targetY&&(e.targetY=parseInt(Math.random()*n.height,10)),e.hitted===!0?(e.scale.x<2&&(e.scale.x+=.02,e.scale.y+=.02),e.alpha<1&&(e.alpha+=.1),e.speed<6&&(e.speed+=1)):(e.scale.x>.15&&(e.scale.x>.6?(e.scale.x-=.02,e.scale.y-=.02):(e.scale.x-=.003,e.scale.y-=.003)),e.alpha>.5&&(e.alpha-=.01),e.speed>1&&(e.speed-=1)),e.scale.x>1.8)){e.visible=!1;var o=new PIXI.MovieClip(t.explosionTextures);o.position.x=p[i].position.x,o.position.y=p[i].position.y,o.anchor.x=.5,o.anchor.y=.5,o.rotation=Math.random()*Math.PI,o.scale.x=o.scale.y=.75+.5*Math.random(),o.loop=!1,o.gotoAndPlay(0),f.addChild(o)}}function l(t){var e=0,n=p.length,i=a(t,{width:20,height:20,anchor:{x:.5,y:.5}});for(e;n>e;e+=1)p[e].visible===!0&&(p[e].hitted=o(p[e],i))}var d=(n.width,n.height,!1),f=e.makeLayer(),p=[];return t.assetsLoaded===!0?s():t.events.on("assetsLoaded",s),{activate:function(){h()},deactivate:function(){u()},getLayer:function(){return f},getRunning:function(){return d}}}),define("scenes/mainScene",["layers/crosshair","layers/aliens","display/factory","display/assets"],function(t,e,n){var i=n.makeScene(),r=t.getLayer(),o=e.getLayer();return e.activate(),t.activate(),i.addChild(o),i.addChild(r),{getScene:function(){return i},toggleCrosshair:function(){t.getRunning()===!0?t.deactivate():t.activate()}}}),function(t){function e(t,e){for(var n=t.length;n--;)if(t[n]===e)return n;return-1}function n(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function i(t){for(y in w)w[y]=t[E[y]]}function r(t,n){var r,o,a,h,u;if(r=t.keyCode,-1==e(S,r)&&S.push(r),(93==r||224==r)&&(r=91),r in w){w[r]=!0;for(a in _)_[a]==r&&(s[a]=!0)}else if(i(t),s.filter.call(this,t)&&r in b)for(h=0;h<b[r].length;h++)if(o=b[r][h],o.scope==n||"all"==o.scope){u=o.mods.length>0;for(a in w)(!w[a]&&e(o.mods,+a)>-1||w[a]&&-1==e(o.mods,+a))&&(u=!1);(0==o.mods.length&&!w[16]&&!w[18]&&!w[17]&&!w[91]||u)&&o.method(t,o)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0))}}function o(t){var n,i=t.keyCode,r=e(S,i);if(r>=0&&S.splice(r,1),(93==i||224==i)&&(i=91),i in w){w[i]=!1;for(n in _)_[n]==i&&(s[n]=!1)}}function a(){for(y in w)w[y]=!1;for(y in _)s[y]=!1}function s(t,e,n){var i,r,o;for(i=m(t),void 0===n&&(n=e,e="all"),o=0;o<i.length;o++)r=[],t=i[o].split("+"),t.length>1&&(r=v(t),t=[t[t.length-1]]),t=t[0],t=R(t),t in b||(b[t]=[]),b[t].push({shortcut:i[o],scope:e,method:n,key:i[o],mods:r})}function h(t,e){var i,r,o=t.split("+"),a=[];if(o.length>1&&(a=v(o),t=o[o.length-1]),t=R(t),void 0===e&&(e=f()),b[t])for(i in b[t])r=b[t][i],r.scope===e&&n(r.mods,a)&&(b[t][i]={})}function u(t){return"string"==typeof t&&(t=R(t)),-1!=e(S,t)}function c(){return S.slice(0)}function l(t){var e=(t.target||t.srcElement).tagName;return"INPUT"!=e&&"SELECT"!=e&&"TEXTAREA"!=e}function d(t){T=t||"all"}function f(){return T||"all"}function p(t){var e,n,i;for(e in b)for(n=b[e],i=0;i<n.length;)n[i].scope===t?n.splice(i,1):i++}function m(t){var e;return t=t.replace(/\s/g,""),e=t.split(","),""==e[e.length-1]&&(e[e.length-2]+=","),e}function v(t){var e=t.slice(0,t.length-1);for(mi=0;mi<e.length;mi++)e[mi]=_[e[mi]];return e}function g(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,function(){n(window.event)})}function x(){var e=t.key;return t.key=C,e}var y,b={},w={16:!1,18:!1,17:!1,91:!1},T="all",_={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},A={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},R=function(t){return A[t]||t.toUpperCase().charCodeAt(0)},S=[];for(y=1;20>y;y++)A["f"+y]=111+y;var E={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(y in _)s[y]=!1;g(document,"keydown",function(t){r(t,T)}),g(document,"keyup",o),g(window,"focus",a);var C=t.key;t.key=s,t.key.setScope=d,t.key.getScope=f,t.key.deleteScope=p,t.key.filter=l,t.key.isPressed=u,t.key.getPressedKeyCodes=c,t.key.noConflict=x,t.key.unbind=h,"undefined"!=typeof module&&(module.exports=key)}(this),define("key",function(t){return function(){var e;return e||t.key}}(this)),define("gameController",["scenes/mainScene","displayController","leapController","key"],function(t,e,n,i){function r(){a===!0?(e.events.remove("debugInfo",o),n.events.remove("debugInfo",o),console.log("hiding debug info"),a=!1):(e.events.on("debugInfo",o),n.events.on("debugInfo",o),console.log("showing debug info"),a=!0)}function o(t){console.log(t)}var a=!1;return e.stage.addChild(t.getScene()),i("enter",function(){r()}),{}}),require(["gameController"]);